<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <title>OpenClaw Command Center</title>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700&family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    :root{--bg:#09090b;--surface:#0f0f12;--surface2:#18181b;--border:#27272a;--border2:#3f3f46;--text:#e4e4e7;--dim:#71717a;--muted:#52525b;--accent:#e4e4e7;--accent-d:rgba(228,228,231,.08);--green:#4ade80;--green-d:rgba(74,222,128,.1);--red:#f87171;--red-d:rgba(248,113,113,.1);--amber:#fbbf24;--amber-d:rgba(251,191,36,.1);--purple:#c4b5fd;--purple-d:rgba(196,181,253,.1);--blue:#93c5fd;--blue-d:rgba(147,197,253,.1)}
    html,body{height:100%;overflow:hidden}body{font-family:'Outfit',sans-serif;background:var(--bg);color:var(--text);font-size:14px;overflow-x:hidden}
    ::-webkit-scrollbar{width:5px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px}
    button{cursor:pointer;font-family:inherit}button:hover{filter:brightness(1.12)}
    input,textarea,select{font-family:'JetBrains Mono',monospace;min-width:0;max-width:100%}input:focus,textarea:focus,select:focus{border-color:var(--accent)!important;outline:none}
    .app{display:flex;height:100vh}
    .sidebar{width:220px;min-height:100vh;background:var(--surface);border-right:1px solid var(--border);display:flex;flex-direction:column;flex-shrink:0;overflow-y:auto}
    .main{flex:1;display:flex;flex-direction:column;min-width:0;overflow:hidden}
    .content{padding:24px 28px;overflow-y:auto;overflow-x:hidden;flex:1}
    .mobile-header{display:none;align-items:center;padding:0;border-bottom:1px solid var(--border);background:var(--surface);gap:0}
    .top-nav{display:flex;align-items:center;overflow-x:auto;flex:1;gap:2px;padding:8px 8px 8px 0;-webkit-overflow-scrolling:touch;scrollbar-width:none}.top-nav::-webkit-scrollbar{display:none}
    .top-nav-btn{flex:0 0 auto;padding:6px 12px;border:none;border-radius:6px;font-size:11px;font-family:'JetBrains Mono',monospace;white-space:nowrap;cursor:pointer;background:transparent;color:var(--dim);display:flex;align-items:center;gap:5px;transition:all .15s}
    .top-nav-btn.active{background:var(--accent-d);color:var(--accent);font-weight:600}.top-nav-btn:hover{background:var(--surface2)}
    .news-sticky{position:sticky;top:0;z-index:5;background:var(--bg);padding:12px 28px 8px;margin:0 -28px 8px}
    .mobile-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:99}
    .mobile-header{display:flex!important}@media(max-width:768px){.sidebar{display:none;position:fixed;z-index:100;height:100vh}.sidebar.open{display:flex}.mobile-overlay.open{display:block}.content{padding:16px}}
    @media(max-width:600px){.form-2col{grid-template-columns:1fr!important}}
    .card{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:20px;transition:all .15s;overflow:hidden;max-width:100%;word-break:break-word}
    .card-click{cursor:pointer}.card-click:hover{border-color:var(--border2);background:var(--surface2)}
    .badge{display:inline-flex;align-items:center;gap:4px;padding:2px 8px;border-radius:6px;font-size:11px;font-weight:600;font-family:'JetBrains Mono',monospace}
    .btn{padding:8px 16px;border-radius:8px;font-size:13px;font-family:'JetBrains Mono',monospace;display:inline-flex;align-items:center;gap:6px;transition:all .15s;border:none;white-space:nowrap}
    .btn-sm{padding:5px 10px;font-size:12px}.btn-xs{padding:3px 7px;font-size:11px}
    .btn-default{background:var(--surface);color:var(--text);border:1px solid var(--border)}
    .btn-primary{background:var(--accent);color:var(--bg);font-weight:600}
    .btn-danger{background:transparent;color:var(--red);border:1px solid rgba(248,113,113,.2)}
    .btn-ghost{background:transparent;color:var(--dim);border:none;padding:4px 6px}
    .btn-green{background:var(--green);color:var(--bg);font-weight:600}
    .input{width:100%;padding:8px 12px;background:var(--bg);color:var(--text);border:1px solid var(--border);border-radius:6px;font-size:13px;min-width:0;max-width:100%;overflow:hidden;text-overflow:ellipsis}
    .section-title{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;flex-wrap:wrap;gap:8px}
    .section-title h3{display:flex;align-items:center;gap:8px;font-size:14px;font-weight:600;text-transform:uppercase;letter-spacing:.06em}
    .toggle{width:44px;height:24px;border-radius:24px;border:none;position:relative;transition:all .2s;cursor:pointer;flex-shrink:0}
    .toggle.on{background:var(--accent)}.toggle.off{background:var(--border)}
    .toggle-dot{width:18px;height:18px;border-radius:50%;position:absolute;top:3px;transition:all .2s}
    .toggle.on .toggle-dot{left:23px;background:var(--bg)}.toggle.off .toggle-dot{left:3px;background:var(--dim)}
    .stat-val{font-size:22px;font-weight:700;font-family:'JetBrains Mono',monospace;text-align:center}
    .stat-lbl{font-size:11px;color:var(--dim);text-transform:uppercase;letter-spacing:.05em;text-align:center;margin-top:2px}
    .mono{font-family:'JetBrains Mono',monospace}
    .toast{position:fixed;bottom:24px;right:24px;background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:12px 20px;z-index:200;font-size:13px;display:flex;align-items:center;gap:8px;animation:slideUp .3s;box-shadow:0 8px 32px rgba(0,0,0,.4)}
    @keyframes slideUp{from{transform:translateY(20px);opacity:0}to{transform:translateY(0);opacity:1}}
    .spinner{display:inline-block;width:14px;height:14px;border:2px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin .6s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
    .log-area{background:var(--bg);border:1px solid var(--border);border-radius:8px;padding:12px;font-family:'JetBrains Mono',monospace;font-size:11px;line-height:1.6;color:var(--green);max-height:400px;overflow-y:auto;white-space:pre-wrap;word-break:break-all}
    .nav-btn{width:100%;padding:9px 12px;display:flex;align-items:center;gap:10px;background:transparent;border:none;border-radius:8px;color:var(--dim);font-size:13px;transition:all .15s;margin-bottom:2px}
    .nav-btn.active{background:var(--accent-d);color:var(--accent);font-weight:600}.nav-btn:hover{background:var(--surface2)}
    .env-row{display:flex;align-items:center;justify-content:space-between;padding:10px 14px;border-bottom:1px solid var(--border);gap:8px;overflow:hidden}.env-row:last-child{border-bottom:none}
    .sticky-bar{position:sticky;bottom:0;left:0;right:0;padding:12px 16px;background:var(--surface);border-top:1px solid var(--border);z-index:10;display:flex;justify-content:center;gap:8px}
    .fixed-restart{position:fixed;bottom:20px;right:28px;z-index:50;animation:slideUp .3s}
    .search-wrap{position:relative;margin-bottom:12px}.search-wrap input{padding-right:32px}.search-wrap .clear-x{position:absolute;right:8px;top:50%;transform:translateY(-50%);background:none;border:none;color:var(--dim);cursor:pointer;font-size:16px;padding:2px 4px;line-height:1}.search-wrap .clear-x:hover{color:var(--text)}
    .trunc{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
    .modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.7);z-index:150;display:flex;align-items:center;justify-content:center;padding:20px}
    .modal{background:var(--surface);border:1px solid var(--border);border-radius:16px;padding:24px;max-width:620px;width:100%;max-height:85vh;overflow-y:auto}
    .bar{height:6px;border-radius:3px;transition:width .3s}.bar-wrap{background:var(--border);border-radius:3px;height:6px;flex:1}
    .tab-bar{display:flex;gap:2px;background:var(--bg);border-radius:8px;padding:3px;overflow-x:auto;margin-bottom:20px}
    .tab-btn{flex:0 0 auto;padding:7px 14px;border:none;border-radius:6px;font-size:12px;font-family:'JetBrains Mono',monospace;white-space:nowrap;cursor:pointer}
    .tab-btn.active{background:var(--surface);color:var(--accent);font-weight:600}.tab-btn:not(.active){background:transparent;color:var(--dim)}
    .mem-file{padding:12px 14px;border-bottom:1px solid var(--border);cursor:pointer;transition:background .15s}.mem-file:hover{background:var(--surface2)}.mem-file:last-child{border-bottom:none}
    .alert-bar{padding:8px 16px;display:flex;align-items:center;gap:8px;font-size:12px;border-bottom:1px solid var(--border);animation:slideDown .3s}
    .alert-bar.error{background:rgba(248,113,113,.08);color:var(--red)}.alert-bar.warn{background:rgba(251,191,36,.06);color:var(--amber)}
    @keyframes slideDown{from{transform:translateY(-10px);opacity:0}to{transform:translateY(0);opacity:1}}
    .feed-item{display:flex;gap:10px;padding:10px 14px;border-bottom:1px solid var(--border);font-size:12px;align-items:flex-start}.feed-item:last-child{border-bottom:none}
    .feed-icon{width:28px;height:28px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:13px;flex-shrink:0}
    .kbd{display:inline-flex;align-items:center;justify-content:center;min-width:20px;height:18px;padding:0 5px;border-radius:3px;background:var(--border);color:var(--dim);font-size:10px;font-family:'JetBrains Mono',monospace}
    .file-item{display:flex;align-items:center;gap:10px;padding:10px 14px;border-bottom:1px solid var(--border);cursor:pointer;transition:background .12s;font-size:13px}.file-item:hover{background:var(--surface2)}.file-item:last-child{border-bottom:none}
.check-item{display:flex;align-items:center;gap:10px;padding:8px 12px;border-radius:8px;cursor:pointer;font-size:13px}.check-item:hover{background:var(--surface2)}.check-item input{width:16px;height:16px;accent-color:var(--accent)}
.wizard-stepper{display:flex;gap:4px;margin-bottom:20px}.wizard-dot{flex:1;height:4px;border-radius:2px;background:var(--border)}.wizard-dot.active{background:var(--accent)}.wizard-dot.done{background:var(--green)}
.score-ring{width:100px;height:100px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:28px;font-weight:800;font-family:'JetBrains Mono',monospace}
  </style>
<script>window.addEventListener("error",function(e){var d=document.createElement('div');d.style.cssText='position:fixed;z-index:99999;left:10px;right:10px;bottom:10px;background:#2b0000;color:#ffb4b4;border:1px solid #ff5555;padding:10px;font:12px monospace;white-space:pre-wrap;max-height:45vh;overflow:auto';d.textContent='Dashboard JS error: '+(e.message||'unknown')+'\n'+(e.filename||'')+':'+(e.lineno||'')+':'+(e.colno||'');document.body.appendChild(d);});</script>
</head>
<body>
<div id="root"></div>
<script src="/vendor/react.production.min.js"></script>
<script src="/vendor/react-dom.production.min.js"></script>
<script src="/vendor/babel.min.js"></script>
<script>
window.ICONS={home:'<path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/>',refresh:'<polyline points="23 4 23 10 17 10"/><polyline points="1 20 1 14 7 14"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>',shield:'<path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>',grid:'<rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/>',folder:'<path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/>',code:'<polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/>',clock:'<circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/>',info:'<circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/>',activity:'<polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>',calendar:'<rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/>',barChart:'<line x1="12" y1="20" x2="12" y2="10"/><line x1="18" y1="20" x2="18" y2="4"/><line x1="6" y1="20" x2="6" y2="16"/>',send:'<line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/>',database:'<ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/>',key:'<path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"/>',cpu:'<rect x="4" y="4" width="16" height="16" rx="2"/><rect x="9" y="9" width="6" height="6"/><line x1="9" y1="1" x2="9" y2="4"/><line x1="15" y1="1" x2="15" y2="4"/><line x1="9" y1="20" x2="9" y2="23"/><line x1="15" y1="20" x2="15" y2="23"/><line x1="20" y1="9" x2="23" y2="9"/><line x1="20" y1="14" x2="23" y2="14"/><line x1="1" y1="9" x2="4" y2="9"/><line x1="1" y1="14" x2="4" y2="14"/>',heart:'<path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>',tool:'<path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/>',fileText:'<path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/>',globe:'<circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/>',hardDrive:'<line x1="22" y1="12" x2="2" y2="12"/><path d="M5.45 5.11L2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z"/><line x1="6" y1="16" x2="6.01" y2="16"/><line x1="10" y1="16" x2="10.01" y2="16"/>',settings:'<circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/>',zap:'<polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>',dollarSign:'<line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>',smartphone:'<rect x="5" y="2" width="14" height="20" rx="2" ry="2"/><line x1="12" y1="18" x2="12.01" y2="18"/>',file:'<path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"/><polyline points="13 2 13 9 20 9"/>',monitor:'<rect x="2" y="3" width="20" height="14" rx="2" ry="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/>',layers:'<polygon points="12 2 2 7 12 12 22 7 12 2"/><polyline points="2 17 12 22 22 17"/><polyline points="2 12 12 17 22 12"/>',menu:'<line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/>',mail:'<path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/>',rss:'<path d="M4 11a9 9 0 0 1 9 9"/><path d="M4 4a16 16 0 0 1 16 16"/><circle cx="5" cy="19" r="1"/>',messageCircle:'<path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/>',lock:'<rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/>',check:'<polyline points="20 6 9 17 4 12"/>',x:'<line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>',users:'<path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/>',link:'<path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/>',share2:'<circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/>',arrowRight:'<line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/>',clipboard:'<path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><rect x="8" y="2" width="8" height="4" rx="1" ry="1"/>',refreshCw:'<polyline points="23 4 23 10 17 10"/><polyline points="1 20 1 14 7 14"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>',
bookmark:'<path d="m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z"/>',
thumbsUp:'<path d="M7 10v12"/><path d="M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2h0a3.13 3.13 0 0 1 3 3.88Z"/>',
thumbsDown:'<path d="M17 14V2"/><path d="M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22h0a3.13 3.13 0 0 1-3-3.88Z"/>',
upload:'<path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/>',
alertTriangle:'<path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/>',
star:'<polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>',
filter:'<polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/>',
share:'<circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/>',
trash2:'<polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/>',downloadCloud:'<polyline points="8 17 12 21 16 17"/><line x1="12" y1="12" x2="12" y2="21"/><path d="M20.88 18.09A5 5 0 0 0 18 9h-1.26A8 8 0 1 0 3 16.29"/>',gitBranch:'<line x1="6" y1="3" x2="6" y2="15"/><circle cx="18" cy="6" r="3"/><circle cx="6" cy="18" r="3"/><path d="M18 9a9 9 0 0 1-9 9"/>'};
window.icon=function(n,s,c){var d=window.ICONS[n];if(!d)return '';return '<svg xmlns="http://www.w3.org/2000/svg" width="'+(s||16)+'" height="'+(s||16)+'" viewBox="0 0 24 24" fill="none" stroke="'+(c||'currentColor')+'" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">'+d+'</svg>';};
window.IC=function(n,s,c,st){return React.createElement('span',{dangerouslySetInnerHTML:{__html:window.icon(n,s||16,c)},style:Object.assign({display:'inline-flex',alignItems:'center',flexShrink:0},st||{})});};
</script>
<script type="text/babel">
const{useState,useEffect,useCallback,useRef}=React;
const TOKEN=new URLSearchParams(window.location.search).get('token')||'';
async function api(ep,opts={}){const sep=ep.includes('?')?'&':'?';const cfg={headers:{'Content-Type':'application/json'},...opts};if(opts.body&&typeof opts.body==='object')cfg.body=JSON.stringify(opts.body);const res=await fetch('/api'+ep+sep+'token='+TOKEN,cfg);if(res.status===401)throw new Error('Unauthorized');return res.json();}
function dlUrl(ep){return '/api'+ep+(ep.includes('?')?'&':'?')+'token='+TOKEN;}
function fmtTokens(n){if(!n)return'0';if(n>=1e6)return(n/1e6).toFixed(1)+'M';if(n>=1e3)return(n/1e3).toFixed(1)+'K';return String(n);}
function fmtCost(n){if(!n)return'$0.00';return'$'+n.toFixed(4);}
function cn(){var r='';for(var i=0;i<arguments.length;i++)if(arguments[i])r+=(r?' ':'')+arguments[i];return r;}
function Toast({message,type}){if(!message)return null;var c=type==='error'?'var(--red)':type==='success'?'var(--green)':'var(--accent)';return React.createElement('div',{className:'toast'},React.createElement('span',{style:{color:c}},'‚óè'),message);}

function AlertBanner(){
  var[alerts,setAlerts]=useState([]);var[dismissed,setDismissed]=useState({});
  useEffect(function(){api('/alerts').then(function(d){setAlerts(d.alerts||[]);}).catch(function(){});var i=setInterval(function(){api('/alerts').then(function(d){setAlerts(d.alerts||[]);}).catch(function(){});},60000);return function(){clearInterval(i);};},[]);
  var visible=alerts.filter(function(_,i){return !dismissed[i];});
  if(!visible.length)return null;
  return React.createElement('div',null,visible.map(function(a,i){
    return React.createElement('div',{key:i,className:'alert-bar '+a.type},
      React.createElement('span',null,a.icon),
      React.createElement('span',{style:{flex:1}},a.message),
      React.createElement('button',{className:'btn-ghost',onClick:function(){var d=Object.assign({},dismissed);d[i]=true;setDismissed(d);},style:{color:'inherit',fontSize:16,border:'none',background:'none',cursor:'pointer'}},'‚úï')
    );
  }));
}

function CopySkillModal({skill,profileId,profiles,onClose,toast}){
  var others=profiles.filter(function(p){return p.id!==profileId;});
  var[sel,setSel]=useState({});var[busy,setBusy]=useState(false);
  return React.createElement('div',{className:'modal-overlay',onClick:onClose},
    React.createElement('div',{className:'modal',onClick:function(e){e.stopPropagation();}},
      React.createElement('h3',{style:{marginBottom:16}},'Copy "'+skill+'" to:'),
      others.map(function(p){return React.createElement('label',{key:p.id,style:{display:'flex',alignItems:'center',gap:10,padding:'8px 0',cursor:'pointer',fontSize:13}},
        React.createElement('input',{type:'checkbox',checked:!!sel[p.id],onChange:function(e){var s=Object.assign({},sel);s[p.id]=e.target.checked;setSel(s);}}),
        React.createElement('b',null,p.id),
        React.createElement('span',{className:'mono',style:{color:'var(--dim)',fontSize:11}},':'+p.port)
      );}),
      React.createElement('div',{style:{display:'flex',gap:8,marginTop:16,justifyContent:'flex-end'}},
        React.createElement('button',{className:'btn btn-sm btn-default',onClick:onClose},'Cancel'),
        React.createElement('button',{className:'btn btn-sm btn-primary',disabled:busy,onClick:async function(){setBusy(true);var t=Object.entries(sel).filter(function(x){return x[1];}).map(function(x){return x[0];});if(t.length){await api('/profiles/'+profileId+'/skills/'+skill+'/copy',{method:'POST',body:{targets:t}});toast('Copied!','success');onClose();}setBusy(false);}},busy?React.createElement('span',{className:'spinner'}):null,' Copy')
      )
    )
  );
}

function CreateProfileModal({profiles,onClose,toast,onCreated}){
  var[id,setId]=useState('');var[name,setName]=useState('');var[port,setPort]=useState('');var[copyFrom,setCopyFrom]=useState('');var[busy,setBusy]=useState(false);
  useEffect(function(){var p=18802;while(profiles.some(function(x){return x.port===p;}))p++;setPort(String(p));},[]);
  return React.createElement('div',{className:'modal-overlay',onClick:onClose},
    React.createElement('div',{className:'modal',onClick:function(e){e.stopPropagation();}},
      React.createElement('h3',{style:{marginBottom:16,fontSize:18}},'Create New Profile'),
      React.createElement('div',{style:{display:'flex',flexDirection:'column',gap:12}},
        React.createElement('div',null,React.createElement('label',{className:'mono',style:{fontSize:11,color:'var(--dim)',display:'block',marginBottom:4}},'Profile ID'),React.createElement('input',{className:'input',value:id,onChange:function(e){setId(e.target.value.toLowerCase().replace(/[^a-z0-9-]/g,''));},placeholder:'e.g. research-bot'})),
        React.createElement('div',null,React.createElement('label',{className:'mono',style:{fontSize:11,color:'var(--dim)',display:'block',marginBottom:4}},'Display Name'),React.createElement('input',{className:'input',value:name,onChange:function(e){setName(e.target.value);},placeholder:'e.g. Research Agent'})),
        React.createElement('div',null,React.createElement('label',{className:'mono',style:{fontSize:11,color:'var(--dim)',display:'block',marginBottom:4}},'Port'),React.createElement('input',{className:'input',type:'number',value:port,onChange:function(e){setPort(e.target.value);}})),
        React.createElement('div',null,React.createElement('label',{className:'mono',style:{fontSize:11,color:'var(--dim)',display:'block',marginBottom:4}},'Copy from'),
          React.createElement('select',{value:copyFrom,onChange:function(e){setCopyFrom(e.target.value);},className:'input',style:{fontFamily:'inherit'}},
            React.createElement('option',{value:''},'Start fresh'),
            profiles.map(function(p){return React.createElement('option',{key:p.id,value:p.id},p.id);})
          )),
        React.createElement('div',{style:{display:'flex',gap:8,justifyContent:'flex-end',marginTop:8}},
          React.createElement('button',{className:'btn btn-sm btn-default',onClick:onClose},'Cancel'),
          React.createElement('button',{className:'btn btn-sm btn-primary',disabled:busy,onClick:async function(){if(!id||!port)return;setBusy(true);try{await api('/profiles',{method:'POST',body:{id:id,name:name||id,port:parseInt(port),copyFrom:copyFrom||undefined}});toast('Created!','success');onCreated();onClose();}catch(e){toast(e.message,'error');}setBusy(false);}},busy?React.createElement('span',{className:'spinner'}):null,' Create')
        )
      )
    )
  );
}

function ResetProfileModal({profileId,onClose,toast}){
  var[soul,setSoul]=useState(true);var[mem,setMem]=useState(true);var[sess,setSess]=useState(false);
  var[busy,setBusy]=useState(false);var[result,setResult]=useState(null);
  function mkOpt(label,desc,val,set){
    return React.createElement('label',{key:label,style:{display:'flex',alignItems:'flex-start',gap:10,cursor:'pointer',padding:'10px 14px',background:'var(--bg)',borderRadius:8,border:'1px solid var(--border)'}},
      React.createElement('input',{type:'checkbox',checked:val,onChange:function(e){set(e.target.checked);},style:{marginTop:3}}),
      React.createElement('div',null,React.createElement('div',{style:{fontWeight:600,fontSize:13}},label),React.createElement('div',{style:{color:'var(--dim)',fontSize:11,marginTop:2}},desc)));
  }
  return React.createElement('div',{className:'modal-overlay',onClick:onClose},
    React.createElement('div',{className:'modal',onClick:function(e){e.stopPropagation();}},
      React.createElement('h3',{style:{marginBottom:4,fontSize:18}},'üîÑ Reset Profile: '+profileId),
      React.createElement('p',{style:{color:'var(--dim)',fontSize:12,marginBottom:16}},'Backup is created automatically. API keys, skills, and service config are preserved.'),
      !result ? React.createElement('div',null,
        React.createElement('div',{style:{display:'flex',flexDirection:'column',gap:12}},
          mkOpt('Reset Soul','Revert personality to default template',soul,setSoul),
          mkOpt('Clear Memory','Remove all memory/*.md files and MEMORY.md',mem,setMem),
          mkOpt('Clear Sessions','Wipe session history (fresh conversation start)',sess,setSess)),
        React.createElement('div',{style:{display:'flex',gap:8,justifyContent:'flex-end',marginTop:16}},
          React.createElement('button',{className:'btn btn-sm btn-default',onClick:onClose},'Cancel'),
          React.createElement('button',{className:'btn btn-sm btn-danger',style:{background:'rgba(248,113,113,.1)'},disabled:busy,onClick:async function(){if(!soul&&!mem&&!sess)return;setBusy(true);try{var r=await api('/profiles/'+profileId+'/reset',{method:'POST',body:{resetSoul:soul,resetMemory:mem,resetSessions:sess}});setResult(r);toast('Reset complete','success');}catch(e){toast(e.message,'error');}setBusy(false);}},busy?React.createElement('span',{className:'spinner'}):null,' Reset'))
      ) : React.createElement('div',null,
        React.createElement('div',{style:{padding:16,background:'var(--green-d)',borderRadius:8,marginBottom:12}},
          React.createElement('div',{style:{fontWeight:600,color:'var(--green)',marginBottom:8}},'‚úì Reset Complete'),
          (result.actions||[]).map(function(a,i){return React.createElement('div',{key:i,className:'mono',style:{fontSize:12,color:'var(--text)',padding:'2px 0'}},'‚Ä¢ '+a);}),
          React.createElement('div',{className:'mono',style:{fontSize:11,color:'var(--dim)',marginTop:8}},'Backup: '+result.backupDir)),
        React.createElement('div',{style:{textAlign:'right'}},React.createElement('button',{className:'btn btn-sm btn-primary',onClick:onClose},'Done')))
    )
  );
}

function MemoryFileModal({profileId,file,onClose,toast}){
  var[content,setContent]=useState(null);var[editing,setEditing]=useState(false);var[editContent,setEditContent]=useState('');
  useEffect(function(){api('/profiles/'+profileId+'/memory/'+file.name).then(function(d){setContent(d.content);setEditContent(d.content);}).catch(function(){setContent('Failed to load');});},[]);
  return React.createElement('div',{className:'modal-overlay',onClick:onClose},
    React.createElement('div',{className:'modal',onClick:function(e){e.stopPropagation();},style:{maxWidth:700}},
      React.createElement('div',{style:{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:12}},
        React.createElement('h3',null,file.name),
        React.createElement('div',{style:{display:'flex',gap:6}},
          !editing&&content!==null?React.createElement('button',{className:'btn btn-xs btn-default',onClick:function(){setEditing(true);}},'‚úé Edit'):null,
          editing?React.createElement('button',{className:'btn btn-xs btn-primary',onClick:async function(){await api('/profiles/'+profileId+'/memory/'+file.name,{method:'PUT',body:{content:editContent}});setContent(editContent);setEditing(false);toast('Saved','success');}},'üíæ Save'):null,
          !editing&&file.location!=='workspace'?React.createElement('button',{className:'btn btn-xs btn-danger',onClick:async function(){if(!confirm('Archive '+file.name+'?'))return;await api('/profiles/'+profileId+'/memory/'+file.name,{method:'DELETE'});toast('Archived','success');onClose();}},'üóë'):null,
          React.createElement('button',{className:'btn btn-ghost',onClick:onClose,style:{fontSize:18}},'‚úï')
        )
      ),
      content===null?React.createElement('div',{style:{textAlign:'center',padding:20}},React.createElement('span',{className:'spinner'})):
      editing?React.createElement('textarea',{value:editContent,onChange:function(e){setEditContent(e.target.value);},className:'mono',style:{width:'100%',minHeight:400,padding:14,background:'var(--bg)',color:'var(--text)',border:'1px solid var(--border)',borderRadius:8,fontSize:12,lineHeight:1.7,resize:'vertical'}}):
      React.createElement('pre',{style:{background:'var(--bg)',border:'1px solid var(--border)',borderRadius:8,padding:14,fontSize:12,lineHeight:1.7,maxHeight:'60vh',overflowY:'auto',whiteSpace:'pre-wrap',wordBreak:'break-word',fontFamily:"'JetBrains Mono',monospace",color:'var(--text)'}},content)
    )
  );
}

function CronAddModal({profileId,onClose,toast,onAdded}){
  var[name,setName]=useState('');var[schedType,setSchedType]=useState('cron');var[schedule,setSchedule]=useState('');
  var[tz,setTz]=useState('Pacific/Honolulu');var[session,setSession]=useState('isolated');var[message,setMessage]=useState('');
  var[busy,setBusy]=useState(false);
  var presets=[{l:'Every hour',s:'0 * * * *'},{l:'Morning 7am',s:'0 7 * * *'},{l:'Evening 6pm',s:'0 18 * * *'},{l:'Weekdays 9am',s:'0 9 * * 1-5'},{l:'Every 30min',s:'*/30 * * * *'},{l:'Monday 8am',s:'0 8 * * 1'}];
  return React.createElement('div',{className:'modal-overlay',onClick:onClose},
    React.createElement('div',{className:'modal',onClick:function(e){e.stopPropagation();},style:{maxWidth:600}},
      React.createElement('h3',{style:{marginBottom:16}},'‚è∞ Add Cron Job'),
      React.createElement('div',{style:{display:'flex',flexDirection:'column',gap:12}},
        React.createElement('div',null,React.createElement('label',{className:'mono',style:{fontSize:11,color:'var(--dim)',display:'block',marginBottom:4}},'Name'),React.createElement('input',{className:'input',value:name,onChange:function(e){setName(e.target.value);},placeholder:'e.g. Morning Briefing'})),
        React.createElement('div',null,
          React.createElement('label',{className:'mono',style:{fontSize:11,color:'var(--dim)',display:'block',marginBottom:4}},'Schedule Type'),
          React.createElement('div',{style:{display:'flex',gap:6}},
            ['cron','at','every'].map(function(v){var labels={cron:'Cron',at:'One-time',every:'Interval'};return React.createElement('button',{key:v,className:'btn btn-sm '+(schedType===v?'btn-primary':'btn-default'),onClick:function(){setSchedType(v);}},labels[v]);}))),
        schedType==='cron'?React.createElement('div',null,
          React.createElement('label',{className:'mono',style:{fontSize:11,color:'var(--dim)',display:'block',marginBottom:4}},'Cron Expression'),
          React.createElement('input',{className:'input',value:schedule,onChange:function(e){setSchedule(e.target.value);},placeholder:'0 7 * * * (min hour day month weekday)'}),
          React.createElement('div',{style:{display:'flex',gap:4,marginTop:6,flexWrap:'wrap'}},presets.map(function(p){return React.createElement('button',{key:p.l,className:'btn btn-xs btn-default',onClick:function(){setSchedule(p.s);}},p.l);}))
        ):schedType==='at'?React.createElement('div',null,React.createElement('label',{className:'mono',style:{fontSize:11,color:'var(--dim)',display:'block',marginBottom:4}},'When'),React.createElement('input',{className:'input',value:schedule,onChange:function(e){setSchedule(e.target.value);},placeholder:'2026-02-17T10:00:00Z or 20m'})):
        React.createElement('div',null,React.createElement('label',{className:'mono',style:{fontSize:11,color:'var(--dim)',display:'block',marginBottom:4}},'Interval'),React.createElement('input',{className:'input',value:schedule,onChange:function(e){setSchedule(e.target.value);},placeholder:'30m, 1h, 6h'})),
        React.createElement('div',null,React.createElement('label',{className:'mono',style:{fontSize:11,color:'var(--dim)',display:'block',marginBottom:4}},'Timezone'),React.createElement('input',{className:'input',value:tz,onChange:function(e){setTz(e.target.value);}})),
        React.createElement('div',null,
          React.createElement('label',{className:'mono',style:{fontSize:11,color:'var(--dim)',display:'block',marginBottom:4}},'Session'),
          React.createElement('div',{style:{display:'flex',gap:6}},
            React.createElement('button',{className:'btn btn-sm '+(session==='isolated'?'btn-primary':'btn-default'),onClick:function(){setSession('isolated');}},'Isolated (background)'),
            React.createElement('button',{className:'btn btn-sm '+(session==='main'?'btn-primary':'btn-default'),onClick:function(){setSession('main');}},'Main (alert)')),
          React.createElement('div',{className:'mono',style:{fontSize:10,color:'var(--dim)',marginTop:4}},session==='isolated'?"Runs independently, won't clutter your chat":'Runs in main conversation as a system event')),
        React.createElement('div',null,React.createElement('label',{className:'mono',style:{fontSize:11,color:'var(--dim)',display:'block',marginBottom:4}},'Task / Message'),
          React.createElement('textarea',{className:'input mono',value:message,onChange:function(e){setMessage(e.target.value);},placeholder:'What should the agent do?',style:{minHeight:80,resize:'vertical',lineHeight:1.5}})),
        React.createElement('div',{style:{display:'flex',gap:8,justifyContent:'flex-end',marginTop:8}},
          React.createElement('button',{className:'btn btn-sm btn-default',onClick:onClose},'Cancel'),
          React.createElement('button',{className:'btn btn-sm btn-primary',disabled:busy,onClick:async function(){if(!name||!schedule||!message)return;setBusy(true);try{var r=await api('/profiles/'+profileId+'/cron/add',{method:'POST',body:{name:name,schedule:schedule,scheduleType:schedType,timezone:tz,session:session,message:message}});toast(r.ok?'Cron job added!':'Failed: '+(r.output||''),'success');onAdded();onClose();}catch(e){toast(e.message,'error');}setBusy(false);}},busy?React.createElement('span',{className:'spinner'}):null,' Create Job'))
      )
    )
  );
}

function StatCard({value,label,color,size}){return React.createElement('div',{className:'card',style:{padding:12,textAlign:'center'}},React.createElement('div',{className:'stat-val',style:{color:color,fontSize:size||22}},value),React.createElement('div',{className:'stat-lbl'},label));}




function ProfileWizard({profiles,onClose,toast,onCreated}){
  var[step,setStep]=useState(0);
  var[id,setId]=useState('');var[name,setName]=useState('');var[port,setPort]=useState('');
  var[importFrom,setImportFrom]=useState('');
  var[doSkills,setDoSkills]=useState(true);var[doSoul,setDoSoul]=useState(true);var[doEnv,setDoEnv]=useState(true);
  var[availSkills,setAvailSkills]=useState([]);var[selSkills,setSelSkills]=useState({});
  var[availKeys,setAvailKeys]=useState([]);var[selKeys,setSelKeys]=useState({});
  var[tgToken,setTgToken]=useState('');var[tgAuto,setTgAuto]=useState(true);
  var[busy,setBusy]=useState(false);var[result,setResult]=useState(null);
  useEffect(function(){var p=18802;while(profiles.some(function(x){return x.port===p;}))p++;setPort(String(p));},[]);
  useEffect(function(){
    if(!importFrom)return;
    api('/profiles/'+importFrom+'/skills/list').then(function(d){
      setAvailSkills(d.skills||[]);var s={};(d.skills||[]).forEach(function(sk){s[sk]=true;});setSelSkills(s);
    }).catch(function(){});
    api('/profiles/'+importFrom+'/env/keys').then(function(d){
      setAvailKeys(d.keys||[]);var s={};(d.keys||[]).forEach(function(k){s[k.key]=true;});setSelKeys(s);
    }).catch(function(){});
  },[importFrom]);
  function doCreate(){setBusy(true);
    var body={id:id,name:name||id,port:parseInt(port),importFrom:importFrom||undefined,
      importSkills:doSkills&&importFrom?Object.keys(selSkills).filter(function(k){return selSkills[k];}):undefined,
      importSoul:doSoul&&!!importFrom,importEnv:doEnv&&!!importFrom,
      importEnvKeys:doEnv&&importFrom?Object.keys(selKeys).filter(function(k){return selKeys[k];}):undefined,
      telegramBotToken:tgToken||undefined,telegramAutoApprove:tgAuto,autoApproveUserId:tgAuto?'6741444182':undefined};
    api('/profiles/wizard',{method:'POST',body:body}).then(function(r){setResult(r);toast('Profile created!','success');onCreated();setBusy(false);}).catch(function(e){toast(e.message,'error');setBusy(false);});}
  var steps=['Identity','Import','Telegram','Create'];
  function chk(label,val,set){return React.createElement('label',{className:'check-item'},React.createElement('input',{type:'checkbox',checked:val,onChange:function(e){set(e.target.checked);}}),label);}
  function rs(){
    if(result){return React.createElement('div',null,
      React.createElement('div',{style:{padding:20,background:'var(--green-d)',borderRadius:10,marginBottom:16}},
        React.createElement('div',{style:{fontSize:18,fontWeight:700,color:'var(--green)',marginBottom:10}},'‚úì Profile Created!'),
        (result.actions||[]).map(function(a,i){return React.createElement('div',{key:i,style:{fontSize:12,color:'var(--text)',padding:'2px 0'}},'‚Ä¢ '+a);})),
      React.createElement('div',{style:{display:'flex',gap:8,justifyContent:'flex-end'}},
        React.createElement('button',{className:'btn btn-sm btn-primary',onClick:onClose},'Done')));}
    if(step===0){return React.createElement('div',{style:{padding:16,background:'var(--bg)',borderRadius:10,border:'1px solid var(--border)'}},
      React.createElement('div',{style:{fontSize:16,fontWeight:700,marginBottom:16}},'‚ë† Profile Identity'),
      React.createElement('div',{style:{display:'flex',flexDirection:'column',gap:12}},
        React.createElement('div',null,React.createElement('label',{className:'mono',style:{fontSize:11,color:'var(--dim)',display:'block',marginBottom:4}},'Profile ID (lowercase, dashes ok)'),
          React.createElement('input',{className:'input',value:id,onChange:function(e){setId(e.target.value.toLowerCase().replace(/[^a-z0-9-]/g,''));},placeholder:'e.g. research-bot'})),
        React.createElement('div',null,React.createElement('label',{className:'mono',style:{fontSize:11,color:'var(--dim)',display:'block',marginBottom:4}},'Display Name'),
          React.createElement('input',{className:'input',value:name,onChange:function(e){setName(e.target.value);},placeholder:'e.g. Research Agent'})),
        React.createElement('div',null,React.createElement('label',{className:'mono',style:{fontSize:11,color:'var(--dim)',display:'block',marginBottom:4}},'Gateway Port'),
          React.createElement('input',{className:'input',type:'number',value:port,onChange:function(e){setPort(e.target.value);}}))));}
    if(step===1){return React.createElement('div',{style:{padding:16,background:'var(--bg)',borderRadius:10,border:'1px solid var(--border)'}},
      React.createElement('div',{style:{fontSize:16,fontWeight:700,marginBottom:6}},'‚ë° Import from Existing'),
      React.createElement('div',{style:{fontSize:12,color:'var(--dim)',marginBottom:16}},'Cherry-pick what to bring over, or start fresh.'),
      React.createElement('select',{className:'input',value:importFrom,onChange:function(e){setImportFrom(e.target.value);},style:{fontFamily:'inherit',marginBottom:12}},
        React.createElement('option',{value:''},'‚Äî Start fresh (no import) ‚Äî'),
        profiles.map(function(p){return React.createElement('option',{key:p.id,value:p.id},'Import from: '+p.id+' (:'+p.port+')');})),
      importFrom?React.createElement('div',{style:{display:'flex',flexDirection:'column',gap:8}},
        React.createElement('label',{className:'check-item',style:{background:'var(--surface)',border:'1px solid var(--border)',borderRadius:8}},
          React.createElement('input',{type:'checkbox',checked:doSkills,onChange:function(e){setDoSkills(e.target.checked);}}),
          React.createElement('div',null,React.createElement('div',{style:{fontWeight:600}},'üõ† Skills'),React.createElement('div',{style:{fontSize:11,color:'var(--dim)'}},availSkills.length+' available'))),
        doSkills&&availSkills.length>0?React.createElement('div',{style:{marginLeft:36,display:'flex',flexDirection:'column',gap:2}},
          availSkills.map(function(sk){return React.createElement('label',{key:sk,className:'check-item',style:{padding:'4px 8px'}},
            React.createElement('input',{type:'checkbox',checked:!!selSkills[sk],onChange:function(e){var s=Object.assign({},selSkills);s[sk]=e.target.checked;setSelSkills(s);}}),sk);})):null,
        React.createElement('label',{className:'check-item',style:{background:'var(--surface)',border:'1px solid var(--border)',borderRadius:8}},
          React.createElement('input',{type:'checkbox',checked:doSoul,onChange:function(e){setDoSoul(e.target.checked);}}),
          React.createElement('div',null,React.createElement('div',{style:{fontWeight:600}},'üëª Soul / Personality'),React.createElement('div',{style:{fontSize:11,color:'var(--dim)'}},'Copy soul.md'))),
        React.createElement('label',{className:'check-item',style:{background:'var(--surface)',border:'1px solid var(--border)',borderRadius:8}},
          React.createElement('input',{type:'checkbox',checked:doEnv,onChange:function(e){setDoEnv(e.target.checked);}}),
          React.createElement('div',null,React.createElement('div',{style:{fontWeight:600}},'üîë API Keys (.env)'),React.createElement('div',{style:{fontSize:11,color:'var(--dim)'}},availKeys.length+' keys'))),
        doEnv&&availKeys.length>0?React.createElement('div',{style:{marginLeft:36,display:'flex',flexDirection:'column',gap:2}},
          availKeys.map(function(k){return React.createElement('label',{key:k.key,className:'check-item',style:{padding:'4px 8px'}},
            React.createElement('input',{type:'checkbox',checked:!!selKeys[k.key],onChange:function(e){var s=Object.assign({},selKeys);s[k.key]=e.target.checked;setSelKeys(s);}}),
            React.createElement('span',{className:'mono',style:{fontSize:12}},k.key),
            k.sensitive?React.createElement('span',{className:'badge',style:{fontSize:9,color:'var(--amber)',background:'var(--amber-d)'}},'secret'):null);})):null
      ):React.createElement('div',{style:{padding:20,textAlign:'center',color:'var(--dim)',fontSize:13}},'Clean slate ‚Äî add skills & keys later.'));}
    if(step===2){return React.createElement('div',{style:{padding:16,background:'var(--bg)',borderRadius:10,border:'1px solid var(--border)'}},
      React.createElement('div',{style:{fontSize:16,fontWeight:700,marginBottom:6}},'‚ë¢ Telegram Bot (Optional)'),
      React.createElement('div',{style:{fontSize:12,color:'var(--dim)',marginBottom:16}},'Skip if you don\'t need Telegram for this agent.'),
      React.createElement('div',{style:{marginBottom:12}},
        React.createElement('label',{className:'mono',style:{fontSize:11,color:'var(--dim)',display:'block',marginBottom:4}},'Bot Token from @BotFather'),
        React.createElement('input',{className:'input mono',value:tgToken,onChange:function(e){setTgToken(e.target.value);},placeholder:'Leave empty to skip'})),
      tgToken?React.createElement('label',{className:'check-item',style:{background:'var(--surface)',borderRadius:8,border:'1px solid var(--border)'}},
        React.createElement('input',{type:'checkbox',checked:tgAuto,onChange:function(e){setTgAuto(e.target.checked);}}),
        React.createElement('div',null,React.createElement('div',{style:{fontWeight:600}},'Auto-approve my account'),
          React.createElement('div',{style:{fontSize:11,color:'var(--dim)'}},'Pre-authorizes 6741444182 (skip pairing)'))):null,
      !tgToken?React.createElement('div',{style:{padding:14,background:'var(--surface)',borderRadius:8,border:'1px solid var(--border)',marginTop:8,fontSize:12,color:'var(--dim)',lineHeight:1.6}},
        'To create: Telegram ‚Üí @BotFather ‚Üí /newbot ‚Üí copy token'):null);}
    if(step===3){
      var sum=[];sum.push('Profile: '+id+' ('+(name||id)+') port '+port);
      if(importFrom){sum.push('Import from: '+importFrom);
        if(doSkills)sum.push('  Skills: '+Object.keys(selSkills).filter(function(k){return selSkills[k];}).length);
        if(doSoul)sum.push('  Soul: yes');
        if(doEnv)sum.push('  Keys: '+Object.keys(selKeys).filter(function(k){return selKeys[k];}).length);
      }else sum.push('Fresh start');
      sum.push(tgToken?'Telegram: yes'+(tgAuto?' (auto-approved)':''):'Telegram: skip');
      return React.createElement('div',{style:{padding:16,background:'var(--bg)',borderRadius:10,border:'1px solid var(--border)'}},
        React.createElement('div',{style:{fontSize:16,fontWeight:700,marginBottom:12}},'‚ë£ Review & Create'),
        React.createElement('pre',{className:'mono',style:{fontSize:12,lineHeight:1.8,color:'var(--text)',padding:14,background:'var(--surface)',borderRadius:8,border:'1px solid var(--border)'}},sum.join('\n')));}
  }
  return React.createElement('div',{className:'modal-overlay',onClick:onClose},
    React.createElement('div',{className:'modal',onClick:function(e){e.stopPropagation();},style:{maxWidth:580}},
      React.createElement('div',{style:{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:16}},
        React.createElement('h3',{style:{fontSize:18}},'‚ö° New Profile Wizard'),
        React.createElement('button',{className:'btn-ghost',onClick:onClose,style:{fontSize:18}},'‚úï')),
      React.createElement('div',{className:'wizard-stepper'},steps.map(function(s,i){return React.createElement('div',{key:i,className:'wizard-dot'+(i===step?' active':'')+(i<step?' done':'')});})),
      React.createElement('div',{style:{fontSize:11,color:'var(--dim)',textAlign:'center',marginBottom:12,marginTop:-8}},steps[step]),
      rs(),
      !result?React.createElement('div',{style:{display:'flex',gap:8,justifyContent:'space-between',marginTop:12}},
        React.createElement('button',{className:'btn btn-sm btn-default',onClick:step>0?function(){setStep(step-1);}:onClose},step>0?'‚Üê Back':'Cancel'),
        step<3?React.createElement('button',{className:'btn btn-sm btn-primary',disabled:step===0&&(!id||!port),onClick:function(){setStep(step+1);}},'Next ‚Üí'):
          React.createElement('button',{className:'btn btn-sm btn-green',disabled:busy,onClick:doCreate},busy?React.createElement('span',{className:'spinner'}):null,' Create Profile')):null));
}

function SystemBrowser({toast}){
  var[roots,setRoots]=useState(null);var[dir,setDir]=useState(null);var[items,setItems]=useState([]);
  var[parent,setParent]=useState(null);var[loading,setLoading]=useState(false);
  var[viewing,setViewing]=useState(null);var[fileContent,setFileContent]=useState(null);
  var[editing,setEditing]=useState(false);var[editContent,setEditContent]=useState('');
  var extIcons={'.json':'üìã','.md':'üìù','.txt':'üìÑ','.js':'üü®','.sh':'üîß','.env':'üîë','.py':'üêç','.html':'üåê','.yml':'‚öô','.yaml':'‚öô','.log':'üìä','.conf':'‚öô','.service':'‚öô','.ini':'‚öô'};
  function fi(item){if(item.isDir)return 'üìÅ';return extIcons[item.ext]||'üìÑ';}
  function fmtSz(b){if(!b)return'0B';if(b>=1048576)return(b/1048576).toFixed(1)+'MB';if(b>=1024)return(b/1024).toFixed(1)+'KB';return b+'B';}
  useEffect(function(){loadRoots();},[]);
  function loadRoots(){setLoading(true);setDir(null);setViewing(null);
    api('/system/browse').then(function(d){setRoots(d.roots||[]);setItems([]);setLoading(false);}).catch(function(){setLoading(false);});}
  function browse(d){setLoading(true);setViewing(null);setEditing(false);
    api('/system/browse?dir='+encodeURIComponent(d)).then(function(r){
      setDir(d);setItems(r.items||[]);setParent(r.parent);setLoading(false);
    }).catch(function(e){toast('Browse error','error');setLoading(false);});}
  function openFile(fp){setLoading(true);setEditing(false);
    api('/system/readfile?path='+encodeURIComponent(fp)).then(function(r){
      if(r.binary){toast('Binary file','info');setLoading(false);return;}
      setViewing(fp);setFileContent(r.content);setEditContent(r.content||'');setLoading(false);
    }).catch(function(e){toast('Read error','error');setLoading(false);});}
  function saveFile(){
    api('/system/writefile',{method:'PUT',body:{filePath:viewing,content:editContent}}).then(function(){
      toast('Saved!','success');setFileContent(editContent);setEditing(false);
    }).catch(function(e){toast(e.message,'error');});}
  if(viewing&&fileContent!==null){
    var fname=viewing.split('/').pop();var canWrite=viewing.startsWith('/home/');
    return React.createElement('div',null,
      React.createElement('div',{style:{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:12,flexWrap:'wrap',gap:8}},
        React.createElement('div',{style:{display:'flex',alignItems:'center',gap:8}},
          React.createElement('button',{className:'btn btn-xs btn-default',onClick:function(){setViewing(null);if(dir)browse(dir);}},'‚Üê Back'),
          React.createElement('span',{style:{fontWeight:700,fontSize:14}},fname),
          !canWrite?React.createElement('span',{className:'badge',style:{color:'var(--amber)',background:'var(--amber-d)',fontSize:9}},'READ-ONLY'):null),
        React.createElement('div',{style:{display:'flex',gap:6}},
          canWrite&&!editing?React.createElement('button',{className:'btn btn-xs btn-default',onClick:function(){setEditing(true);setEditContent(fileContent);}},'‚úèÔ∏è Edit'):null,
          editing?React.createElement('button',{className:'btn btn-xs btn-primary',onClick:saveFile},'üíæ Save'):null,
          editing?React.createElement('button',{className:'btn btn-xs btn-default',onClick:function(){setEditing(false);}},'Cancel'):null)),
      editing?React.createElement('textarea',{value:editContent,onChange:function(e){setEditContent(e.target.value);},className:'mono',style:{width:'100%',minHeight:450,padding:14,background:'var(--bg)',color:'var(--text)',border:'1px solid var(--border)',borderRadius:8,fontSize:12,lineHeight:1.7,resize:'vertical'}}):
      React.createElement('pre',{className:'mono',style:{background:'var(--bg)',border:'1px solid var(--border)',borderRadius:8,padding:14,fontSize:12,lineHeight:1.7,maxHeight:'65vh',overflowY:'auto',whiteSpace:'pre-wrap',wordBreak:'break-word',color:'var(--text)'}},fileContent));}
  return React.createElement('div',null,
    React.createElement('div',{className:'section-title'},
      React.createElement('h3',null,'üóÇ System Files'),
      React.createElement('button',{className:'btn btn-sm btn-default',onClick:dir?function(){browse(dir);}:loadRoots},loading?React.createElement('span',{className:'spinner'}):'‚Üª')),
    loading&&!items.length&&!roots?React.createElement('div',{style:{textAlign:'center',padding:30}},React.createElement('span',{className:'spinner'})):null,
    !dir&&roots?React.createElement('div',{style:{display:'grid',gridTemplateColumns:'repeat(auto-fit,minmax(180px,1fr))',gap:10}},
      roots.map(function(r){return React.createElement('div',{key:r.label,className:'card card-click',style:{padding:16},onClick:function(){browse(r.path);}},
        React.createElement('div',{style:{fontSize:24,marginBottom:8}},r.label.includes('Home')?'üè†':r.label.includes('Nginx')?'üåê':r.label.includes('SSL')?'üîí':'üìÅ'),
        React.createElement('div',{style:{fontWeight:700,fontSize:14,marginBottom:4}},r.label),
        React.createElement('div',{className:'mono',style:{fontSize:10,color:'var(--dim)',wordBreak:'break-all'}},r.path));})):null,
    dir?React.createElement('div',null,
      React.createElement('div',{style:{fontSize:12,color:'var(--dim)',marginBottom:8}},
        React.createElement('span',{style:{cursor:'pointer',color:'var(--accent)'},onClick:loadRoots},'üè†'),
        ' / ',dir.split('/').filter(Boolean).slice(-3).join(' / ')),
      React.createElement('div',{className:'card',style:{padding:0,overflow:'hidden'}},
        parent?React.createElement('div',{className:'file-item',style:{color:'var(--accent)'},onClick:function(){browse(parent);}},'üìÅ ..'):null,
        items.length===0?React.createElement('div',{style:{padding:20,textAlign:'center',color:'var(--dim)'}},'Empty'):
        items.map(function(item){return React.createElement('div',{key:item.name,className:'file-item',onClick:function(){if(item.isDir)browse(item.path);else openFile(item.path);}},
          React.createElement('span',{style:{fontSize:16,width:24,textAlign:'center'}},fi(item)),
          React.createElement('span',{style:{flex:1,minWidth:0,overflow:'hidden',textOverflow:'ellipsis',fontWeight:item.isDir?600:400,color:item.isDir?'var(--accent)':'var(--text)'}},item.name),
          !item.isDir?React.createElement('span',{className:'mono',style:{fontSize:10,color:'var(--dim)',flexShrink:0}},fmtSz(item.size)):null);}))):null);
}

function FileBrowser({profileId,toast}){
  var[roots,setRoots]=useState(null);var[dir,setDir]=useState(null);var[items,setItems]=useState([]);
  var[parent,setParent]=useState(null);var[loading,setLoading]=useState(false);
  var[viewing,setViewing]=useState(null);var[fileContent,setFileContent]=useState(null);
  var[editing,setEditing]=useState(false);var[editContent,setEditContent]=useState('');
  var extIcons={'.json':'üìã','.md':'üìù','.txt':'üìÑ','.js':'üü®','.sh':'üîß','.env':'üîë','.py':'üêç','.html':'üåê','.yml':'‚öô','.yaml':'‚öô','.log':'üìä'};
  function fileIcon(item){if(item.isDir)return 'üìÅ';return extIcons[item.ext]||'üìÑ';}
  function fmtSize(b){if(!b)return'0B';if(b>=1048576)return(b/1048576).toFixed(1)+'MB';if(b>=1024)return(b/1024).toFixed(1)+'KB';return b+'B';}
  useEffect(function(){loadRoots();},[profileId]);
  function loadRoots(){setLoading(true);setDir(null);setViewing(null);
    api('/profiles/'+profileId+'/browse').then(function(d){setRoots(d.roots||[]);setItems([]);setLoading(false);}).catch(function(){setLoading(false);});}
  function browse(d){setLoading(true);setViewing(null);setEditing(false);
    api('/profiles/'+profileId+'/browse?dir='+encodeURIComponent(d)).then(function(r){
      setDir(d);setItems(r.items||[]);setParent(r.parent);setLoading(false);
    }).catch(function(e){toast('Browse error','error');setLoading(false);});}
  function openFile(fp){setLoading(true);setEditing(false);
    api('/profiles/'+profileId+'/readfile?path='+encodeURIComponent(fp)).then(function(r){
      if(r.binary){toast('Binary file ('+r.ext+')','info');setLoading(false);return;}
      setViewing(fp);setFileContent(r.content);setEditContent(r.content||'');setLoading(false);
    }).catch(function(e){toast('Read error','error');setLoading(false);});}
  function saveFile(){
    api('/profiles/'+profileId+'/writefile',{method:'PUT',body:{filePath:viewing,content:editContent}}).then(function(){
      toast('Saved!','success');setFileContent(editContent);setEditing(false);
    }).catch(function(e){toast(e.message,'error');});}
  function deleteItem(fp,isDir){
    if(!confirm('Delete '+(isDir?'folder':'file')+': '+fp.split('/').pop()+'?'))return;
    api('/profiles/'+profileId+'/deletefile?path='+encodeURIComponent(fp),{method:'DELETE'}).then(function(){
      toast('Moved to trash','success');if(viewing===fp)setViewing(null);if(dir)browse(dir);
    }).catch(function(e){toast(e.message,'error');});}
  if(viewing&&fileContent!==null){
    var fname=viewing.split('/').pop();
    return React.createElement('div',null,
      React.createElement('div',{style:{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:12,flexWrap:'wrap',gap:8}},
        React.createElement('div',{style:{display:'flex',alignItems:'center',gap:8}},
          React.createElement('button',{className:'btn btn-xs btn-default',onClick:function(){setViewing(null);if(dir)browse(dir);}},'‚Üê Back'),
          React.createElement('span',{style:{fontWeight:700,fontSize:14}},fname)),
        React.createElement('div',{style:{display:'flex',gap:6}},
          !editing?React.createElement('button',{className:'btn btn-xs btn-default',onClick:function(){setEditing(true);setEditContent(fileContent);}},'‚úèÔ∏è Edit'):null,
          editing?React.createElement('button',{className:'btn btn-xs btn-primary',onClick:saveFile},'üíæ Save'):null,
          editing?React.createElement('button',{className:'btn btn-xs btn-default',onClick:function(){setEditing(false);}},'Cancel'):null,
          React.createElement('button',{className:'btn btn-xs btn-danger',onClick:function(){deleteItem(viewing,false);}},'üóë'))),
      editing?React.createElement('textarea',{value:editContent,onChange:function(e){setEditContent(e.target.value);},className:'mono',style:{width:'100%',minHeight:450,padding:14,background:'var(--bg)',color:'var(--text)',border:'1px solid var(--border)',borderRadius:8,fontSize:12,lineHeight:1.7,resize:'vertical'}}):
      React.createElement('pre',{className:'mono',style:{background:'var(--bg)',border:'1px solid var(--border)',borderRadius:8,padding:14,fontSize:12,lineHeight:1.7,maxHeight:'65vh',overflowY:'auto',whiteSpace:'pre-wrap',wordBreak:'break-word',color:'var(--text)'}},fileContent));}
  return React.createElement('div',null,
    React.createElement('div',{className:'section-title'},
      React.createElement('h3',null,'üìÅ File Browser'),
      React.createElement('button',{className:'btn btn-sm btn-default',onClick:dir?function(){browse(dir);}:loadRoots},loading?React.createElement('span',{className:'spinner'}):'‚Üª')),
    loading&&!items.length&&!roots?React.createElement('div',{style:{textAlign:'center',padding:30}},React.createElement('span',{className:'spinner'})):null,
    !dir&&roots?React.createElement('div',{style:{display:'grid',gridTemplateColumns:'repeat(auto-fit,minmax(180px,1fr))',gap:10}},
      roots.map(function(r){return React.createElement('div',{key:r.label,className:'card card-click',style:{padding:16},onClick:function(){browse(r.path);}},
        React.createElement('div',{style:{fontSize:24,marginBottom:8}},r.label==='config'?'‚öô':r.label==='workspace'?'üíº':'ü¶û'),
        React.createElement('div',{style:{fontWeight:700,fontSize:14,marginBottom:4}},r.label),
        React.createElement('div',{className:'mono',style:{fontSize:10,color:'var(--dim)',wordBreak:'break-all'}},r.path));})):null,
    dir?React.createElement('div',null,
      React.createElement('div',{style:{fontSize:12,color:'var(--dim)',marginBottom:8}},
        React.createElement('span',{style:{cursor:'pointer',color:'var(--accent)'},onClick:loadRoots},'üè†'),
        ' / ',dir.split('/').filter(Boolean).slice(-3).join(' / ')),
      React.createElement('div',{className:'card',style:{padding:0,overflow:'hidden'}},
        parent&&dir!==parent?React.createElement('div',{className:'file-item',style:{color:'var(--accent)'},onClick:function(){browse(parent);}},'üìÅ ..'):null,
        items.length===0?React.createElement('div',{style:{padding:20,textAlign:'center',color:'var(--dim)'}},'Empty directory'):
        items.map(function(item){return React.createElement('div',{key:item.name,className:'file-item',onClick:function(){if(item.isDir)browse(item.path);else openFile(item.path);}},
          React.createElement('span',{style:{fontSize:16,width:24,textAlign:'center'}},fileIcon(item)),
          React.createElement('span',{style:{flex:1,minWidth:0,overflow:'hidden',textOverflow:'ellipsis',fontWeight:item.isDir?600:400,color:item.isDir?'var(--accent)':'var(--text)'}},item.name),
          !item.isDir?React.createElement('span',{className:'mono',style:{fontSize:10,color:'var(--dim)',flexShrink:0}},fmtSize(item.size)):null,
          React.createElement('button',{className:'btn-ghost',style:{color:'var(--red)',fontSize:12},onClick:function(e){e.stopPropagation();deleteItem(item.path,item.isDir);}},'‚úï'));}))):null);
}

function PanelDashboard({profiles,system,loading,onRefresh,onNav,toast}){
  var[showCreate,setShowCreate]=useState(false);var[usageData,setUsageData]=useState(null);
  useEffect(function(){api('/usage/all').then(setUsageData).catch(function(){});},[profiles]);
  var running=profiles.filter(function(p){return p.status==='running';}).length;
  var totalCrons=profiles.reduce(function(s,p){return s+(p.cronCount||0);},0);
  return React.createElement('div',null,
    showCreate?React.createElement(ProfileWizard,{profiles:profiles,onClose:function(){setShowCreate(false);},toast:toast,onCreated:onRefresh}):null,
    React.createElement('div',{style:{display:'grid',gridTemplateColumns:'repeat(auto-fit,minmax(110px,1fr))',gap:10,marginBottom:24}},
      React.createElement(StatCard,{value:profiles.length,label:'Profiles',color:'var(--accent)'}),
      React.createElement(StatCard,{value:running+'/'+profiles.length,label:'Running',color:'var(--green)'}),
      React.createElement(StatCard,{value:usageData?fmtCost(usageData.totals.cost):'...',label:'Total Cost',color:'var(--amber)',size:16}),
      React.createElement(StatCard,{value:usageData?fmtTokens(usageData.totals.inputTokens+usageData.totals.outputTokens):'...',label:'Tokens',color:'var(--purple)',size:14}),
      React.createElement(StatCard,{value:totalCrons,label:'Cron Jobs',color:'var(--blue)'}),
      React.createElement(StatCard,{value:system.memInfo||'...',label:'Memory',color:'var(--dim)',size:12}),
      React.createElement(StatCard,{value:system.swapInfo||'...',label:'Swap',color:'var(--dim)',size:12})
    ),
    usageData&&usageData.totals.cost>0?React.createElement('div',{className:'card',style:{padding:16,marginBottom:20}},
      React.createElement('div',{style:{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:12}},
        React.createElement('div',{style:{fontSize:13,fontWeight:600}},'üí∞ Cost by Profile'),
        React.createElement('div',{className:'mono',style:{fontSize:11,color:'var(--amber)'}},'~'+fmtCost(usageData.projected30d)+'/mo')),
      Object.entries(usageData.profiles).map(function(entry){var id=entry[0],u=entry[1];var pct=usageData.totals.cost>0?(u.cost/usageData.totals.cost*100):0;
        return React.createElement('div',{key:id,style:{marginBottom:10}},
          React.createElement('div',{style:{display:'flex',justifyContent:'space-between',fontSize:12,marginBottom:4}},React.createElement('span',{style:{fontWeight:600}},id),React.createElement('span',{className:'mono',style:{color:'var(--amber)'}},fmtCost(u.cost))),
          React.createElement('div',{className:'bar-wrap'},React.createElement('div',{className:'bar',style:{width:Math.max(pct,1)+'%',background:'var(--accent)'}})));})
    ):null,
    React.createElement('div',{className:'section-title'},
      React.createElement('h3',null,'‚ö° Profiles'),
      React.createElement('div',{style:{display:'flex',gap:6}},
        React.createElement('button',{className:'btn btn-sm btn-primary',onClick:function(){setShowCreate(true);}},'+ New'),
        React.createElement('a',{href:dlUrl('/backup/all'),className:'btn btn-sm btn-default',style:{textDecoration:'none'}},'‚¨á Backup'),
        React.createElement('button',{className:'btn btn-sm btn-default',onClick:onRefresh,disabled:loading},loading?React.createElement('span',{className:'spinner'}):'‚Üª'))),
    React.createElement('div',{style:{display:'flex',flexDirection:'column',gap:8}},
      profiles.map(function(p){return React.createElement('div',{key:p.id,className:'card card-click',style:{padding:14,display:'flex',alignItems:'center',justifyContent:'space-between',borderLeft:'3px solid '+(p.status==='running'?'var(--green)':'var(--dim)')},onClick:function(){onNav('profile',p.id);}},
        React.createElement('div',null,
          React.createElement('div',{style:{fontSize:14,fontWeight:600}},p.name||p.id,
            React.createElement('span',{className:'mono',style:{fontSize:11,color:'var(--dim)',marginLeft:6}},':'+p.port),
            p.telegramEnabled?React.createElement('span',{style:{marginLeft:6,fontSize:11}},'üì±'):null,
            p.cronCount>0?React.createElement('span',{style:{marginLeft:4,fontSize:11}},'‚è∞'+p.cronCount):null),
          React.createElement('div',{className:'mono',style:{fontSize:11,color:'var(--dim)',marginTop:2}},p.skillCount+' skills ¬∑ '+(p.uptime||'down'),p.totalCost>0?React.createElement('span',{style:{color:'var(--amber)',marginLeft:6}},fmtCost(p.totalCost)):null)),
        React.createElement('span',{className:'badge',style:{color:p.status==='running'?'var(--green)':'var(--red)',background:p.status==='running'?'var(--green-d)':'var(--red-d)'}},p.status==='running'?'‚óè LIVE':'‚óã '+p.status.toUpperCase()));})),
    React.createElement('div',{style:{marginTop:24}},
      React.createElement('div',{className:'section-title'},React.createElement('h3',null,'üñ• Server')),
      React.createElement('div',{className:'card',style:{padding:14}},
        React.createElement('div',{className:'mono',style:{fontSize:12,lineHeight:1.8,color:'var(--dim)'}},
          ['hostname','uptime','memInfo','swapInfo','loadAvg','nodeVersion','openclawVersion','diskUsage'].map(function(k){return React.createElement('div',{key:k},k+': ',React.createElement('span',{style:{color:'var(--text)'}},system[k]||'...'));}))))
  );
}

function PanelProfile({profileId,profiles,toast,onNav}){
  var p=profiles.find(function(x){return x.id===profileId;});
  var[tab,setTab]=useState('overview');var[envVars,setEnvVars]=useState(null);var[envRevealed,setEnvRevealed]=useState(false);
  var[config,setConfig]=useState(null);var[soul,setSoul]=useState(null);var[skills,setSkills]=useState(null);
  var[logs,setLogs]=useState('');var[models,setModels]=useState(null);var[loading,setLoading]=useState(false);
  var[addingEnv,setAddingEnv]=useState(false);var[newEnvKey,setNewEnvKey]=useState('');var[newEnvVal,setNewEnvVal]=useState('');
  var[copyModal,setCopyModal]=useState(null);var[resetModal,setResetModal]=useState(false);
  var[usage,setUsage]=useState(null);var[channels,setChannels]=useState(null);var[tgUsers,setTgUsers]=useState(null);
  var[pairing,setPairing]=useState(null);var[sessions,setSessions]=useState(null);var[memModal,setMemModal]=useState(null);
  var[cronData,setCronData]=useState(null);var[cronAddModal,setCronAddModal]=useState(false);
  var[tgEditing,setTgEditing]=useState(false);var[tgToken,setTgToken]=useState('');var[tgBusy,setTgBusy]=useState(false);var[addUserId,setAddUserId]=useState('');var[showAddUser,setShowAddUser]=useState(false);var[apiKeyProv,setApiKeyProv]=useState(null);var[apiKeyIn,setApiKeyIn]=useState('');
  var[activity,setActivity]=useState(null);var[commsChannel,setCommsChannel]=useState('telegram');
  var[discordData,setDiscordData]=useState(null);var[discordEditing,setDiscordEditing]=useState(false);var[discordForm,setDiscordForm]=useState({botToken:'',applicationId:'',guildId:''});
  var[whatsappData,setWhatsappData]=useState(null);var[whatsappEditing,setWhatsappEditing]=useState(false);var[whatsappForm,setWhatsappForm]=useState({phoneNumber:'',apiKey:'',bridgeType:'baileys'});
  var[imessageData,setImessageData]=useState(null);var[imessageEditing,setImessageEditing]=useState(false);var[imessageForm,setImessageForm]=useState({serverUrl:'',password:''});
  var[termInput,setTermInput]=useState('');
  var[oauthStep,setOauthStep]=useState(0);var[discoveredId,setDiscoveredId]=useState(null);var[customClientId,setCustomClientId]=useState('');var[authUrlState,setAuthUrlState]=useState('');var[manualMode,setManualMode]=useState(false);var[manualToken,setManualToken]=useState('');var[manualRefresh,setManualRefresh]=useState('');
  var[ftpData,setFtpData]=useState(null);var[ftpEditing,setFtpEditing]=useState(false);var[ftpForm,setFtpForm]=useState({host:'',user:'',pass:'',port:'21'});var[ftpTesting,setFtpTesting]=useState(false);var[ftpTestResult,setFtpTestResult]=useState(null);
  var[smtpData,setSmtpData]=useState(null);var[smtpEditing,setSmtpEditing]=useState(false);var[smtpForm,setSmtpForm]=useState({host:'',port:'587',user:'',pass:'',from:'',secure:true});var[smtpTesting,setSmtpTesting]=useState(false);var[smtpTestResult,setSmtpTestResult]=useState(null);
  var[authData,setAuthData]=useState(null);var[oauthFlow,setOauthFlow]=useState(null);var[oauthCallbackUrl,setOauthCallbackUrl]=useState('');var[oauthPolling,setOauthPolling]=useState(false);var[oauthMsg,setOauthMsg]=useState(null);
  var[memFilter,setMemFilter]=useState('');var[cronExpanded,setCronExpanded]=useState(null);
  if(!p)return React.createElement('div',{style:{color:'var(--dim)'}},'Not found');

  var loadTab=useCallback(async function(t){setLoading(true);try{
    if(t==='env')setEnvVars((await api('/profiles/'+profileId+'/env'+(envRevealed?'?reveal=true':''))).vars);
    else if(t==='config')setConfig(JSON.stringify((await api('/profiles/'+profileId+'/config')).config,null,2));
    else if(t==='soul')setSoul((await api('/profiles/'+profileId+'/soul')).content);
    else if(t==='skills')setSkills((await api('/profiles/'+profileId+'/skills')).skills);
    else if(t==='logs')setLogs((await api('/profiles/'+profileId+'/logs?lines=150')).logs);
    else if(t==='models'){setModels((await api('/profiles/'+profileId+'/models')).models);try{setEnvVars((await api('/profiles/'+profileId+'/env')).vars);}catch(ex){}}
    else if(t==='usage')setUsage(await api('/profiles/'+profileId+'/usage'));
    else if(t==='comms'){setChannels((await api('/profiles/'+profileId+'/channels')).channels);setTgUsers(await api('/profiles/'+profileId+'/telegram/info'));setPairing(await api('/profiles/'+profileId+'/pairing'));try{setDiscordData(await api('/profiles/'+profileId+'/channel/discord'));}catch(e){setDiscordData({enabled:false});}try{setWhatsappData(await api('/profiles/'+profileId+'/channel/whatsapp'));}catch(e){setWhatsappData({enabled:false});}try{setImessageData(await api('/profiles/'+profileId+'/channel/bluebubbles'));}catch(e){setImessageData({enabled:false});}}
    else if(t==='history')setSessions(await api('/profiles/'+profileId+'/sessions'));
    else if(t==='cron')setCronData(await api('/profiles/'+profileId+'/cron'));
    else if(t==='activity')setActivity(await api('/profiles/'+profileId+'/activity'));
    else if(t==='ftp'){var fd=await api('/profiles/'+profileId+'/ftp');setFtpData(fd);setFtpForm({host:fd.host||'',user:fd.user||'',pass:'',port:fd.port||'21'});setFtpEditing(!fd.hasCredentials);}
    else if(t==='smtp'){var sd=await api('/profiles/'+profileId+'/smtp');setSmtpData(sd);setSmtpForm({host:sd.host||'',port:sd.port||'587',user:sd.user||'',pass:'',from:sd.from||'',secure:sd.secure!==false});setSmtpEditing(!sd.hasCredentials);}
    else if(t==='auth'){var ad=await api('/profiles/'+profileId+'/auth');setAuthData(ad);setOauthMsg(null);setOauthCallbackUrl('');}
  }catch(e){toast('Load failed','error');}setLoading(false);},[profileId,envRevealed]);
  useEffect(function(){if(tab!=='overview')loadTab(tab);},[tab]);

  var doAction=async function(a){setLoading(true);try{await api('/profiles/'+profileId+'/'+a,{method:'POST'});toast(a+' ‚Üí '+profileId,'success');onNav('refresh');}catch(e){toast(e.message,'error');}setLoading(false);};

  var tabs=[{id:'overview',l:'Overview'},{id:'files',l:'Files',ic:'folder'},{id:'activity',l:'Live',ic:'activity'},{id:'cron',l:'Cron',ic:'calendar'},{id:'usage',l:'Usage',ic:'dollarSign'},{id:'comms',l:'Comms',ic:'messageCircle'},{id:'history',l:'Memory',ic:'database'},{id:'env',l:'Keys',ic:'key'},{id:'auth',l:'Auth',ic:'lock'},{id:'models',l:'Models',ic:'cpu'},{id:'config',l:'Config',ic:'settings'},{id:'soul',l:'Soul',ic:'heart'},{id:'skills',l:'Skills',ic:'tool'},{id:'logs',l:'Logs',ic:'fileText'},{id:'ftp',l:'FTP',ic:'globe'},{id:'smtp',l:'Email',ic:'mail'}];

  function renderTabContent(){
    if(tab==='overview'){
      return React.createElement('div',{style:{display:'grid',gridTemplateColumns:'repeat(auto-fit,minmax(120px,1fr))',gap:10}},
        [{l:'Port',v:p.port,c:'var(--accent)'},{l:'Skills',v:p.skillCount,c:'var(--purple)'},{l:'Cost',v:fmtCost(p.totalCost),c:'var(--amber)',s:16},{l:'Tokens',v:fmtTokens(p.totalInput+p.totalOutput),c:'var(--blue)',s:14},{l:'Crons',v:p.cronCount||0,c:'var(--green)'},{l:'Uptime',v:p.uptime||'down',c:'var(--dim)',s:12}].map(function(s,i){return React.createElement(StatCard,{key:i,value:s.v,label:s.l,color:s.c,size:s.s});}));
    }
    if(tab==='files'){return React.createElement(FileBrowser,{profileId:profileId,toast:toast});}
    if(tab==='activity'){
      return React.createElement('div',null,
        React.createElement('div',{className:'section-title'},React.createElement('h3',null,'üì° Activity Feed'),React.createElement('button',{className:'btn btn-sm btn-default',onClick:function(){loadTab('activity');}},'‚Üª')),
        activity&&activity.events&&activity.events.length>0?React.createElement('div',{className:'card',style:{padding:0,overflow:'hidden',maxHeight:500,overflowY:'auto'}},
          activity.events.map(function(ev,i){var bgMap={error:'var(--red-d)',message:'var(--accent-d)',tool:'var(--purple-d)',cron:'var(--amber-d)',status:'var(--green-d)',system:'var(--border)'};
            return React.createElement('div',{key:i,className:'feed-item'},
              React.createElement('div',{className:'feed-icon',style:{background:bgMap[ev.type]||'var(--border)'}},ev.icon),
              React.createElement('div',{style:{flex:1,minWidth:0}},React.createElement('div',{className:'mono',style:{fontSize:11,color:'var(--dim)'}},ev.time),React.createElement('div',{style:{fontSize:12,marginTop:2,wordBreak:'break-word'}},ev.message)));})):
        React.createElement('div',{className:'card',style:{padding:30,textAlign:'center',color:'var(--dim)'}},'No recent activity.'),
        activity&&activity.channelLogs?React.createElement('div',{style:{marginTop:16}},React.createElement('div',{style:{fontSize:13,fontWeight:600,marginBottom:8}},'üì± Channel Logs'),React.createElement('div',{className:'log-area',style:{maxHeight:200}},activity.channelLogs||'No channel activity')):null);
    }
    if(tab==='cron'){
      var hasJobs=cronData&&((cronData.output&&!cronData.output.includes('No cron'))||(cronData.jobs&&cronData.jobs.length>0)||cronData.heartbeat);
      return React.createElement('div',null,
        React.createElement('div',{className:'section-title'},React.createElement('h3',null,'‚è∞ Cron Jobs'),React.createElement('div',{style:{display:'flex',gap:6}},
          React.createElement('button',{className:'btn btn-sm btn-primary',onClick:function(){setCronAddModal(true);}},'+ Add Job'),
          React.createElement('button',{className:'btn btn-sm btn-default',onClick:function(){loadTab('cron');}},'‚Üª'))),
        cronData&&cronData.heartbeat?React.createElement('div',{className:'card card-click',style:{padding:16,marginBottom:12,borderColor:'rgba(74,222,128,.15)'},onClick:function(){setCronExpanded(cronExpanded==='hb'?null:'hb');}},
          React.createElement('div',{style:{display:'flex',justifyContent:'space-between',alignItems:'center'}},
            React.createElement('div',{style:{display:'flex',alignItems:'center',gap:10}},
              React.createElement('span',{style:{color:'var(--dim)',fontSize:11,transition:'transform .2s',transform:cronExpanded==='hb'?'rotate(90deg)':'rotate(0)'}},'‚ñ∂'),
              React.createElement('span',{style:{fontSize:18}},'üíì'),
              React.createElement('div',null,
                React.createElement('div',{style:{fontSize:14,fontWeight:600}},'Heartbeat'),
                React.createElement('div',{className:'mono',style:{fontSize:11,color:'var(--dim)'}},'Schedule: '+(cronData.heartbeat.schedule||cronData.heartbeat.config?.every||'?')))),
            React.createElement('span',{className:'badge',style:{color:'var(--green)',background:'var(--green-d)'}},'Active')),
          cronExpanded==='hb'?React.createElement('div',{style:{marginTop:12,padding:12,background:'var(--bg)',borderRadius:8,border:'1px solid var(--border)'},onClick:function(e){e.stopPropagation();}},
            React.createElement('div',{style:{fontSize:12,color:'var(--dim)',lineHeight:1.6}},
              'The heartbeat is an automatic periodic check-in that keeps your bot alive and responsive. It runs on a timer and ensures the bot gateway stays connected and processes queued messages.'),
            cronData.heartbeat.config?React.createElement('div',{style:{marginTop:8}},
              React.createElement('div',{style:{fontSize:10,color:'var(--dim)',textTransform:'uppercase',marginBottom:4}},'Configuration'),
              React.createElement('pre',{className:'mono',style:{fontSize:11,color:'var(--text)',padding:8,background:'var(--surface)',borderRadius:6,whiteSpace:'pre-wrap'}},JSON.stringify(cronData.heartbeat.config,null,2))):null):null):null,
        cronData&&cronData.output?React.createElement('div',{className:'card',style:{padding:0,overflow:'hidden',marginBottom:16}},
          React.createElement('pre',{className:'mono',style:{padding:14,fontSize:11,lineHeight:1.7,color:'var(--text)',whiteSpace:'pre-wrap',wordBreak:'break-word',margin:0}},cronData.output)):null,
        cronData&&cronData.jobs&&cronData.jobs.length>0?React.createElement('div',{style:{marginBottom:16}},
          cronData.jobs.map(function(j,i){var isExp=cronExpanded===i;return React.createElement('div',{key:i,className:'card card-click',style:{padding:14,marginBottom:6},onClick:function(){setCronExpanded(isExp?null:i);}},
            React.createElement('div',{style:{display:'flex',justifyContent:'space-between',alignItems:'center'}},
              React.createElement('div',{style:{display:'flex',alignItems:'center',gap:8}},
                React.createElement('span',{style:{color:'var(--dim)',fontSize:11,transition:'transform .2s',transform:isExp?'rotate(90deg)':'rotate(0)'}},'‚ñ∂'),
                React.createElement('div',null,React.createElement('div',{style:{fontSize:13,fontWeight:600}},j.name||j.id||'Job '+(i+1)),React.createElement('div',{className:'mono',style:{fontSize:11,color:'var(--dim)'}},j.schedule||j.cron||j.every||j.scheduleType||''))),
              React.createElement('span',{className:'badge',style:{color:j.enabled!==false?'var(--green)':'var(--dim)',background:j.enabled!==false?'var(--green-d)':'var(--border)'}},j.enabled!==false?'Active':'Paused'),
              j.isSystem?React.createElement('span',{className:'badge',style:{color:'var(--purple)',background:'var(--purple-d)',fontSize:9,marginLeft:4}},'System'):null),
            isExp?React.createElement('div',{style:{marginTop:12,padding:12,background:'var(--bg)',borderRadius:8,border:'1px solid var(--border)'},onClick:function(e){e.stopPropagation();}},
              j.message?React.createElement('div',{style:{marginBottom:8}},React.createElement('div',{style:{fontSize:10,color:'var(--dim)',textTransform:'uppercase',marginBottom:4}},j.isSystem?'Description':'Message'),React.createElement('div',{style:{fontSize:12,color:'var(--text)',lineHeight:1.5}},j.message)):null,
              j.script?React.createElement('div',{style:{marginBottom:8}},React.createElement('div',{style:{fontSize:10,color:'var(--dim)',textTransform:'uppercase',marginBottom:4}},'Script'),React.createElement('div',{className:'mono',style:{fontSize:11,color:'var(--accent)',padding:'6px 10px',background:'var(--surface)',borderRadius:6}},j.script)):null,
              j.services&&j.services.length>0?React.createElement('div',{style:{marginBottom:8}},React.createElement('div',{style:{fontSize:10,color:'var(--dim)',textTransform:'uppercase',marginBottom:4}},'Monitored Services'),React.createElement('div',{style:{display:'flex',gap:4,flexWrap:'wrap'}},j.services.map(function(s){return React.createElement('span',{key:s,className:'badge',style:{fontSize:10,color:'var(--green)',background:'var(--green-d)'}},s);}))):null,
              j.timezone?React.createElement('div',{style:{fontSize:11,color:'var(--dim)',marginBottom:4}},'Timezone: '+j.timezone):null,
              j.session?React.createElement('div',{style:{fontSize:11,color:'var(--dim)',marginBottom:8}},'Session: '+j.session):null,
              j.lastRun?React.createElement('div',{style:{fontSize:11,color:'var(--dim)',marginBottom:8}},'Last run: '+new Date(j.lastRun).toLocaleString()):null,
              !j.isSystem?React.createElement('div',{style:{display:'flex',gap:6}},
                React.createElement('button',{className:'btn btn-xs '+(j.enabled!==false?'btn-default':'btn-green'),onClick:async function(){try{await api('/profiles/'+profileId+'/cron/'+(j.id||j.name)+'/toggle',{method:'POST',body:{enabled:j.enabled===false}});toast(j.enabled===false?'Resumed':'Paused','success');loadTab('cron');}catch(er){toast('Not supported yet','error');}}},j.enabled!==false?'‚è∏ Pause':'‚ñ∂ Resume'),
                React.createElement('button',{className:'btn btn-xs btn-danger',onClick:async function(){if(!confirm('Delete cron job "'+(j.name||j.id)+'"?'))return;try{await api('/profiles/'+profileId+'/cron/'+(j.id||j.name),{method:'DELETE'});toast('Deleted','success');loadTab('cron');}catch(er){toast('Not supported yet','error');}}},IC('trash2',12))):null):null);})):null,
        !hasJobs?React.createElement('div',{className:'card',style:{padding:30,textAlign:'center'}},
          React.createElement('div',{style:{fontSize:32,marginBottom:8}},'‚è∞'),
          React.createElement('div',{style:{color:'var(--dim)',marginBottom:16}},'No cron jobs yet. Schedule automated tasks for this profile.'),
          React.createElement('div',{style:{fontSize:12,color:'var(--muted)',maxWidth:400,margin:'0 auto',lineHeight:1.6}},'Examples: Morning briefing, inbox check, weekly report, nightly backup')):null);
    }
    if(tab==='usage'&&usage){
      return React.createElement('div',null,
        React.createElement('div',{className:'section-title'},
          React.createElement('h3',null,'Usage & Cost'),
          React.createElement('div',{style:{display:'flex',gap:6,alignItems:'center'}},
            usage.lastModified?React.createElement('span',{className:'mono',style:{fontSize:10,color:'var(--dim)'}},'Updated: '+new Date(usage.lastModified).toLocaleTimeString()):null,
            usage.sources&&usage.sources.length>0?React.createElement('span',{className:'badge',style:{fontSize:9,color:'var(--green)',background:'var(--green-d)'}},usage.sources.length+' source'+(usage.sources.length>1?'s':'')):null,
            React.createElement('button',{className:'btn btn-xs btn-default',onClick:function(){loadTab('usage');}},'‚Üª'))),
        usage.noData?React.createElement('div',{className:'card',style:{padding:24,textAlign:'center'}},
          React.createElement('div',{style:{fontSize:32,marginBottom:8}},'üìä'),
          React.createElement('div',{style:{color:'var(--dim)',marginBottom:8}},'No usage data found'),
          React.createElement('div',{className:'mono',style:{fontSize:11,color:'var(--muted)',lineHeight:1.6}},usage.hint||'Ensure the profile is on the latest OpenClaw version.')):null,
        !usage.noData?React.createElement('div',{style:{display:'grid',gridTemplateColumns:'repeat(auto-fit,minmax(110px,1fr))',gap:10,marginBottom:20}},
          [{v:fmtCost(usage.totals.estimatedCostUsd),l:'Total Cost',c:'var(--amber)'},{v:fmtTokens(usage.totals.inputTokens),l:'Tokens In',c:'var(--accent)'},{v:fmtTokens(usage.totals.outputTokens),l:'Tokens Out',c:'var(--green)'},{v:usage.daysTracked,l:'Days',c:'var(--purple)'},{v:fmtCost(usage.avgDailyCost),l:'Avg/Day',c:'var(--blue)'},{v:fmtCost(usage.projected30d),l:'~30d Est',c:'var(--amber)'}].map(function(s,i){return React.createElement(StatCard,{key:i,value:s.v,label:s.l,color:s.c,size:16});})):null,
        !usage.noData&&Object.keys(usage.byModel).length>0?React.createElement('div',{className:'card',style:{padding:16,marginBottom:16}},
          React.createElement('div',{style:{fontSize:13,fontWeight:600,marginBottom:12}},'By Model'),
          Object.entries(usage.byModel).sort(function(a,b){return b[1].cost-a[1].cost;}).map(function(entry){var model=entry[0],data=entry[1];var pct=usage.totals.estimatedCostUsd>0?(data.cost/usage.totals.estimatedCostUsd*100):0;
            return React.createElement('div',{key:model,style:{marginBottom:12}},
              React.createElement('div',{style:{display:'flex',justifyContent:'space-between',fontSize:12,marginBottom:4}},
                React.createElement('span',null,React.createElement('b',{style:{color:'var(--accent)'}},model),React.createElement('span',{style:{color:'var(--dim)',marginLeft:8}},data.sessions+' sess')),
                React.createElement('span',{className:'mono',style:{color:'var(--amber)'}},fmtCost(data.cost))),
              React.createElement('div',{className:'bar-wrap'},React.createElement('div',{className:'bar',style:{width:Math.max(pct,2)+'%',background:'var(--purple)'}})));})):null,
        !usage.noData&&usage.recentSessions&&usage.recentSessions.length>0?React.createElement('div',{className:'card',style:{padding:16,marginBottom:16}},
          React.createElement('div',{style:{fontSize:13,fontWeight:600,marginBottom:12}},'Recent Sessions'),
          React.createElement('div',{style:{maxHeight:200,overflowY:'auto'}},
            usage.recentSessions.map(function(s,i){return React.createElement('div',{key:i,style:{display:'flex',justifyContent:'space-between',alignItems:'center',padding:'6px 0',borderBottom:i<usage.recentSessions.length-1?'1px solid var(--border)':'none',fontSize:12}},
              React.createElement('div',null,
                React.createElement('span',{style:{color:'var(--accent)',fontWeight:600}},s.model),
                React.createElement('span',{className:'mono',style:{color:'var(--dim)',marginLeft:8,fontSize:11}},fmtTokens(s.tokens)+' tok')),
              React.createElement('div',{style:{display:'flex',gap:8,alignItems:'center'}},
                React.createElement('span',{className:'mono',style:{color:'var(--amber)',fontSize:11}},fmtCost(s.cost)),
                s.timestamp?React.createElement('span',{className:'mono',style:{color:'var(--dim)',fontSize:10}},s.timestamp.slice(0,10)):null));}))):null,
        !usage.noData&&usage.byDay.length>0?React.createElement('div',{className:'card',style:{padding:16}},
          React.createElement('div',{style:{fontSize:13,fontWeight:600,marginBottom:12}},'Daily Cost (last 30d)'),
          React.createElement('div',{style:{display:'flex',alignItems:'flex-end',gap:2,height:80}},
            usage.byDay.map(function(d,i){var max=Math.max.apply(null,usage.byDay.map(function(x){return x.cost;}).concat([0.001]));var h=Math.max((d.cost/max)*70,2);
              return React.createElement('div',{key:i,title:d.date+': '+fmtCost(d.cost),style:{flex:1,minWidth:3,height:h,background:'var(--accent)',borderRadius:'2px 2px 0 0',opacity:.8}});})),
          React.createElement('div',{style:{display:'flex',justifyContent:'space-between',marginTop:4}},
            React.createElement('span',{className:'mono',style:{fontSize:9,color:'var(--dim)'}},usage.byDay[0]&&usage.byDay[0].date),
            React.createElement('span',{className:'mono',style:{fontSize:9,color:'var(--dim)'}},usage.byDay[usage.byDay.length-1]&&usage.byDay[usage.byDay.length-1].date))):null);
    }
    if(tab==='comms'){
      var channels_list=[
        {id:'telegram',l:'Telegram',ic:'smartphone',color:'#26a5e4',desc:'Real-time messaging via Telegram bots'},
        {id:'discord',l:'Discord',ic:'globe',color:'#5865f2',desc:'Chat through Discord bot integration'},
        {id:'whatsapp',l:'WhatsApp',ic:'smartphone',color:'#25d366',desc:'Connect via WhatsApp Business API'},
        {id:'imessage',l:'iMessage',ic:'messageCircle',color:'#34c759',desc:'Apple iMessage via BlueBubbles bridge'}
      ];
      var cc=commsChannel;
      var tgEnabled=tgUsers&&tgUsers.enabled;var tgHasToken=tgUsers&&tgUsers.hasToken;
      var chStatus={telegram:tgEnabled,discord:discordData&&discordData.enabled,whatsapp:whatsappData&&whatsappData.enabled,imessage:imessageData&&imessageData.enabled};
      return React.createElement('div',null,
        React.createElement('div',{style:{display:'flex',gap:8,marginBottom:20,flexWrap:'wrap'}},
          channels_list.map(function(ch){var active=chStatus[ch.id];return React.createElement('button',{key:ch.id,className:'btn btn-sm '+(cc===ch.id?'btn-primary':'btn-default'),style:cc===ch.id?{background:ch.color,borderColor:ch.color,color:'#fff'}:{},onClick:function(){setCommsChannel(ch.id);}},IC(ch.ic,13),' ',ch.l,active?React.createElement('span',{style:{marginLeft:4,fontSize:8,color:cc===ch.id?'#fff':'var(--green)'}},'‚óè'):null);})),

        cc==='telegram'?React.createElement('div',null,
          React.createElement('div',{className:'card',style:{padding:16,marginBottom:16,background:'var(--surface)',border:'1px solid rgba(38,165,228,.15)'}},
            React.createElement('div',{style:{fontSize:14,fontWeight:700,marginBottom:10}},IC('smartphone',15),' Telegram Setup Guide'),
            React.createElement('div',{style:{fontSize:12,color:'var(--dim)',lineHeight:1.8}},
              React.createElement('div',{style:{marginBottom:8,fontWeight:600,color:'var(--text)'}},'How to connect Telegram:'),
              [{n:'1',t:'Open Telegram and search for @BotFather.'},{n:'2',t:'Send /newbot and follow the prompts to name your bot.'},{n:'3',t:'BotFather will give you a Bot Token (looks like 123456789:ABCdef...). Copy it.'},{n:'4',t:'Paste the token below in Bot Configuration and click Save & Restart.'},{n:'5',t:'To find your Telegram User ID: message @userinfobot on Telegram ‚Äî it replies with your numeric ID.'},{n:'6',t:'Add your user ID to Approved Users below so the bot will respond to you.'},{n:'7',t:'Open a chat with your bot in Telegram and send /start, then send any message. If you see a pairing code, enter it in the Pairing section below and click Approve.'}].map(function(s){
                return React.createElement('div',{key:s.n,style:{display:'flex',gap:10,alignItems:'flex-start',marginBottom:6}},
                  React.createElement('span',{style:{width:20,height:20,borderRadius:'50%',background:'rgba(38,165,228,.15)',color:'#26a5e4',display:'inline-flex',alignItems:'center',justifyContent:'center',fontSize:11,fontWeight:700,flexShrink:0}},s.n),
                  React.createElement('span',null,s.t));}))),
          React.createElement('div',{className:'card',style:{padding:16,marginBottom:16,borderColor:tgEnabled?'rgba(52,211,153,.15)':'var(--border)'}},
            React.createElement('div',{style:{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:14}},
              React.createElement('div',{style:{display:'flex',alignItems:'center',gap:10}},
                React.createElement('div',{style:{fontSize:16,fontWeight:700}},IC('settings',15),' Bot Configuration'),
                tgUsers?React.createElement('span',{className:'badge',style:{color:tgEnabled?'var(--green)':'var(--red)',background:tgEnabled?'var(--green-d)':'var(--red-d)'}},tgEnabled?'‚óè Enabled':'‚óã Disabled'):null),
              tgHasToken&&!tgEditing?React.createElement('button',{className:'btn btn-xs btn-default',onClick:function(){setTgEditing(true);setTgToken('');}},'Change Token'):null),
            tgUsers&&tgUsers.botToken&&!tgEditing?React.createElement('div',{style:{padding:'10px 14px',background:'var(--bg)',borderRadius:8,border:'1px solid var(--border)',marginBottom:8}},
              React.createElement('div',{style:{fontSize:11,color:'var(--dim)',marginBottom:4}},'Bot Token'),
              React.createElement('div',{className:'mono',style:{fontSize:13,color:'var(--accent)'}},tgUsers.botToken)):null,
            !tgHasToken&&!tgEditing?React.createElement('div',{style:{padding:16,textAlign:'center',background:'var(--bg)',borderRadius:8,border:'1px dashed var(--border)',marginBottom:8}},
              React.createElement('div',{style:{fontSize:13,color:'var(--dim)',marginBottom:10}},'No bot token configured'),
              React.createElement('button',{className:'btn btn-sm btn-primary',onClick:function(){setTgEditing(true);setTgToken('');}},'+ Add Bot Token')):null,
            tgEditing?React.createElement('div',{style:{padding:14,background:'var(--bg)',borderRadius:8,border:'1px solid var(--border)',marginTop:8,marginBottom:8}},
              React.createElement('div',{style:{fontSize:12,fontWeight:600,marginBottom:8}},'Bot Token from @BotFather'),
              React.createElement('input',{className:'input mono',placeholder:'123456789:ABCdef...',value:tgToken,onChange:function(e){setTgToken(e.target.value);},style:{marginBottom:10,fontSize:13}}),
              React.createElement('div',{style:{display:'flex',gap:8}},
                React.createElement('button',{className:'btn btn-sm btn-primary',disabled:tgBusy||!tgToken.includes(':'),onClick:async function(){setTgBusy(true);try{
                  await api('/profiles/'+profileId+'/telegram/setup',{method:'PUT',body:{botToken:tgToken,enabled:true,autoApproveUserId:'6741444182'}});
                  toast('Saved! Restarting gateway...','success');setTgEditing(false);
                  await api('/profiles/'+profileId+'/restart',{method:'POST'});
                  setTimeout(function(){loadTab('comms');},2000);
                }catch(e){toast(e.message,'error');}setTgBusy(false);}},tgBusy?'Saving‚Ä¶':'Save & Restart'),
                React.createElement('button',{className:'btn btn-sm btn-default',onClick:function(){setTgEditing(false);}},'Cancel'))):null),
          tgUsers?React.createElement('div',{className:'card',style:{padding:16,marginBottom:16}},
            React.createElement('div',{style:{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:12}},
              React.createElement('div',{style:{fontSize:14,fontWeight:600}},IC('users',14),' Approved Users ('+(tgUsers.users?tgUsers.users.length:0)+')'),
              React.createElement('button',{className:'btn btn-xs '+(showAddUser?'btn-default':'btn-primary'),onClick:function(){setShowAddUser(!showAddUser);}},showAddUser?'‚úï':'+ Add')),
            React.createElement('div',{style:{fontSize:11,color:'var(--dim)',marginBottom:10}},'Your Telegram user ID is needed here. Message @userinfobot on Telegram to get it.'),
            showAddUser?React.createElement('div',{style:{display:'flex',gap:8,marginBottom:12}},
              React.createElement('input',{className:'input mono',placeholder:'Telegram user ID (numeric)',value:addUserId,onChange:function(e){setAddUserId(e.target.value);},style:{flex:1}}),
              React.createElement('button',{className:'btn btn-sm btn-primary',disabled:!addUserId,onClick:async function(){try{await api('/profiles/'+profileId+'/telegram/users/add',{method:'POST',body:{userId:addUserId}});toast('Added','success');setAddUserId('');setShowAddUser(false);loadTab('comms');}catch(e){toast(e.message,'error');}}},'Add')):null,
            tgUsers.users&&tgUsers.users.length>0?React.createElement('div',{style:{border:'1px solid var(--border)',borderRadius:8,overflow:'hidden'}},
              tgUsers.users.map(function(u,i){var uid=String(u);return React.createElement('div',{key:i,style:{display:'flex',justifyContent:'space-between',alignItems:'center',padding:'10px 14px',borderBottom:i<tgUsers.users.length-1?'1px solid var(--border)':'none'}},
                React.createElement('span',{className:'mono',style:{fontSize:13,color:'var(--accent)'}},uid),
                React.createElement('button',{className:'btn btn-xs btn-default',style:{color:'var(--red)'},onClick:async function(){if(!confirm('Remove?'))return;try{await api('/profiles/'+profileId+'/telegram/users/'+i,{method:'DELETE'});toast('Removed','success');loadTab('comms');}catch(e){toast(e.message,'error');}}},'‚úï'));})):
            React.createElement('div',{style:{padding:16,textAlign:'center',color:'var(--dim)',fontSize:12}},'No approved users yet.')):null,
          pairing?React.createElement('div',{className:'card',style:{padding:16}},
            React.createElement('div',{style:{fontSize:14,fontWeight:600,marginBottom:8}},IC('link',14),' Pairing'),
            React.createElement('div',{style:{fontSize:11,color:'var(--dim)',marginBottom:8}},'When you first message your bot, it sends a pairing code. Enter it below and click Approve to authorize your Telegram account.'),
            React.createElement('div',{className:'mono',style:{fontSize:12,color:'var(--dim)',whiteSpace:'pre-wrap',padding:'10px 14px',background:'var(--bg)',borderRadius:8,marginBottom:12}},pairing.output||'No pending requests'),
            React.createElement('div',{style:{display:'flex',gap:8}},
              React.createElement('input',{id:'pairCode',className:'input mono',placeholder:'Pairing code...',style:{flex:1}}),
              React.createElement('button',{className:'btn btn-sm btn-primary',onClick:async function(){var code=document.getElementById('pairCode').value;if(!code)return;var r=await api('/profiles/'+profileId+'/pairing/approve',{method:'POST',body:{code:code}});toast(r.output||'Approved','success');loadTab('comms');}},'Approve'))):null
        ):null,

        cc==='discord'?React.createElement('div',null,
          React.createElement('details',{style:{marginBottom:16}},
            React.createElement('summary',{className:'card',style:{padding:14,cursor:'pointer',listStyle:'none',display:'flex',alignItems:'center',gap:8,fontSize:13,fontWeight:600}},IC('info',14),' Discord Setup Guide'),
            React.createElement('div',{style:{padding:16,border:'1px solid var(--border)',borderTop:'none',borderRadius:'0 0 10px 10px',fontSize:12,color:'var(--dim)',lineHeight:1.8}},
              [{n:'1',t:'Go to discord.com/developers/applications and click "New Application".'},{n:'2',t:'Give it a name, go to the Bot tab, click "Add Bot", then copy the Bot Token.'},{n:'3',t:'Under Privileged Gateway Intents, enable "Message Content Intent" and "Server Members Intent".'},{n:'4',t:'Go to OAuth2 ‚Üí URL Generator. Select "bot" scope and "Send Messages", "Read Message History" permissions.'},{n:'5',t:'Copy the generated invite URL and open it to add the bot to your Discord server.'},{n:'6',t:'Enter the Bot Token and Application ID below, then Save & Restart.'}].map(function(s){
                return React.createElement('div',{key:s.n,style:{display:'flex',gap:10,alignItems:'flex-start',marginBottom:6}},
                  React.createElement('span',{style:{width:20,height:20,borderRadius:'50%',background:'rgba(88,101,242,.15)',color:'#5865f2',display:'inline-flex',alignItems:'center',justifyContent:'center',fontSize:11,fontWeight:700,flexShrink:0}},s.n),
                  React.createElement('span',null,s.t));}))),
          discordData?React.createElement('div',{className:'card',style:{padding:16,marginBottom:16,borderColor:discordData.enabled?'rgba(88,101,242,.2)':'var(--border)'}},
            React.createElement('div',{style:{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:14}},
              React.createElement('div',{style:{display:'flex',alignItems:'center',gap:10}},
                React.createElement('div',{style:{fontSize:16,fontWeight:700}},IC('settings',15),' Discord Configuration'),
                React.createElement('span',{className:'badge',style:{color:discordData.enabled?'var(--green)':'var(--red)',background:discordData.enabled?'var(--green-d)':'var(--red-d)'}},discordData.enabled?'‚óè Enabled':'‚óã Disabled')),
              !discordEditing?React.createElement('button',{className:'btn btn-xs btn-default',onClick:function(){setDiscordEditing(true);setDiscordForm({botToken:'',applicationId:discordData.applicationId||'',guildId:discordData.guildId||''});}},discordData.hasToken?'Edit':'+ Setup'):null),
            discordData.hasToken&&!discordEditing?React.createElement('div',{style:{padding:'10px 14px',background:'var(--bg)',borderRadius:8,border:'1px solid var(--border)',marginBottom:8}},
              React.createElement('div',{style:{fontSize:11,color:'var(--dim)',marginBottom:4}},'Bot Token'),
              React.createElement('div',{className:'mono',style:{fontSize:13,color:'var(--accent)'}},discordData.botToken),
              discordData.applicationId?React.createElement('div',{style:{marginTop:8}},React.createElement('div',{style:{fontSize:11,color:'var(--dim)',marginBottom:2}},'Application ID'),React.createElement('div',{className:'mono',style:{fontSize:12}},discordData.applicationId)):null):null,
            discordEditing?React.createElement('div',{style:{padding:14,background:'var(--bg)',borderRadius:8,border:'1px solid var(--border)'}},
              React.createElement('div',{style:{fontSize:12,fontWeight:600,marginBottom:10}},'Discord Bot Credentials'),
              React.createElement('div',{style:{marginBottom:8}},React.createElement('div',{style:{fontSize:11,color:'var(--dim)',marginBottom:4}},'Bot Token *'),React.createElement('input',{className:'input mono',type:'password',placeholder:'Paste Discord bot token...',value:discordForm.botToken,onChange:function(e){setDiscordForm(Object.assign({},discordForm,{botToken:e.target.value}));},style:{fontSize:12}})),
              React.createElement('div',{style:{marginBottom:8}},React.createElement('div',{style:{fontSize:11,color:'var(--dim)',marginBottom:4}},'Application ID'),React.createElement('input',{className:'input mono',placeholder:'Optional ‚Äî from Developer Portal',value:discordForm.applicationId,onChange:function(e){setDiscordForm(Object.assign({},discordForm,{applicationId:e.target.value}));},style:{fontSize:12}})),
              React.createElement('div',{style:{marginBottom:12}},React.createElement('div',{style:{fontSize:11,color:'var(--dim)',marginBottom:4}},'Guild / Server ID'),React.createElement('input',{className:'input mono',placeholder:'Optional ‚Äî right-click server ‚Üí Copy ID',value:discordForm.guildId,onChange:function(e){setDiscordForm(Object.assign({},discordForm,{guildId:e.target.value}));},style:{fontSize:12}})),
              React.createElement('div',{style:{display:'flex',gap:8}},
                React.createElement('button',{className:'btn btn-sm btn-primary',disabled:loading||(!discordForm.botToken&&!discordData.hasToken),onClick:async function(){setLoading(true);try{
                  await api('/profiles/'+profileId+'/channel/discord/setup',{method:'PUT',body:{enabled:true,botToken:discordForm.botToken||undefined,applicationId:discordForm.applicationId,guildId:discordForm.guildId}});
                  toast('Discord saved! Restarting...','success');setDiscordEditing(false);
                  await api('/profiles/'+profileId+'/restart',{method:'POST'});setTimeout(function(){loadTab('comms');},2000);
                }catch(e){toast(e.message,'error');}setLoading(false);}},loading?'Saving...':'Save & Restart'),
                React.createElement('button',{className:'btn btn-sm btn-default',onClick:function(){setDiscordEditing(false);}},'Cancel'))):null,
            discordData.hasToken?React.createElement('div',{style:{marginTop:12,display:'flex',justifyContent:'space-between',alignItems:'center'}},
              React.createElement('div',{style:{fontSize:12,fontWeight:600}},'Discord Enabled'),
              React.createElement('button',{className:'toggle '+(discordData.enabled?'on':'off'),onClick:async function(){var ns=!discordData.enabled;await api('/profiles/'+profileId+'/channel/discord/setup',{method:'PUT',body:{enabled:ns}});toast(ns?'Discord enabled':'Discord disabled','success');await api('/profiles/'+profileId+'/restart',{method:'POST'});loadTab('comms');}},React.createElement('div',{className:'toggle-dot'}))):null
          ):React.createElement('div',{style:{textAlign:'center',padding:20}},React.createElement('span',{className:'spinner'}))
        ):null,

        cc==='whatsapp'?React.createElement('div',null,
          React.createElement('details',{style:{marginBottom:16}},
            React.createElement('summary',{className:'card',style:{padding:14,cursor:'pointer',listStyle:'none',display:'flex',alignItems:'center',gap:8,fontSize:13,fontWeight:600}},IC('info',14),' WhatsApp Setup Guide'),
            React.createElement('div',{style:{padding:16,border:'1px solid var(--border)',borderTop:'none',borderRadius:'0 0 10px 10px',fontSize:12,color:'var(--dim)',lineHeight:1.8}},
              [{n:'1',t:'WhatsApp uses the Baileys bridge (open-source WA Web connector) or the official Business API.'},{n:'2',t:'For Baileys: run "openclaw onboard" via SSH and select WhatsApp when prompted. A QR code will appear.'},{n:'3',t:'Scan the QR with WhatsApp on your phone (Settings ‚Üí Linked Devices ‚Üí Link a Device).'},{n:'4',t:'For Business API: get credentials from Meta Business Suite and enter them below.'},{n:'5',t:'Enter your phone number and any required API key below, then Save & Restart.'},{n:'6',t:'Note: Baileys sessions can disconnect. If that happens, re-run the QR pairing via SSH.'}].map(function(s){
                return React.createElement('div',{key:s.n,style:{display:'flex',gap:10,alignItems:'flex-start',marginBottom:6}},
                  React.createElement('span',{style:{width:20,height:20,borderRadius:'50%',background:'rgba(37,211,102,.15)',color:'#25d366',display:'inline-flex',alignItems:'center',justifyContent:'center',fontSize:11,fontWeight:700,flexShrink:0}},s.n),
                  React.createElement('span',null,s.t));}))),
          whatsappData?React.createElement('div',{className:'card',style:{padding:16,marginBottom:16,borderColor:whatsappData.enabled?'rgba(37,211,102,.2)':'var(--border)'}},
            React.createElement('div',{style:{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:14}},
              React.createElement('div',{style:{display:'flex',alignItems:'center',gap:10}},
                React.createElement('div',{style:{fontSize:16,fontWeight:700}},IC('settings',15),' WhatsApp Configuration'),
                React.createElement('span',{className:'badge',style:{color:whatsappData.enabled?'var(--green)':'var(--red)',background:whatsappData.enabled?'var(--green-d)':'var(--red-d)'}},whatsappData.enabled?'‚óè Enabled':'‚óã Disabled')),
              !whatsappEditing?React.createElement('button',{className:'btn btn-xs btn-default',onClick:function(){setWhatsappEditing(true);setWhatsappForm({phoneNumber:whatsappData.phoneNumber||'',apiKey:'',bridgeType:whatsappData.bridgeType||'baileys'});}},whatsappData.hasApiKey||whatsappData.sessionExists?'Edit':'+ Setup'):null),
            whatsappData.sessionExists?React.createElement('div',{style:{padding:10,background:'var(--green-d)',borderRadius:8,marginBottom:8,fontSize:12,color:'var(--green)'}},IC('check',12),' WhatsApp session found on server'):null,
            whatsappEditing?React.createElement('div',{style:{padding:14,background:'var(--bg)',borderRadius:8,border:'1px solid var(--border)'}},
              React.createElement('div',{style:{fontSize:12,fontWeight:600,marginBottom:10}},'WhatsApp Credentials'),
              React.createElement('div',{style:{marginBottom:8}},React.createElement('div',{style:{fontSize:11,color:'var(--dim)',marginBottom:4}},'Bridge Type'),
                React.createElement('div',{style:{display:'flex',gap:8}},
                  ['baileys','business-api'].map(function(bt){return React.createElement('button',{key:bt,className:'btn btn-xs '+(whatsappForm.bridgeType===bt?'btn-primary':'btn-default'),onClick:function(){setWhatsappForm(Object.assign({},whatsappForm,{bridgeType:bt}));}},bt);}))),
              React.createElement('div',{style:{marginBottom:8}},React.createElement('div',{style:{fontSize:11,color:'var(--dim)',marginBottom:4}},'Phone Number'),React.createElement('input',{className:'input mono',placeholder:'+1234567890',value:whatsappForm.phoneNumber,onChange:function(e){setWhatsappForm(Object.assign({},whatsappForm,{phoneNumber:e.target.value}));},style:{fontSize:12}})),
              whatsappForm.bridgeType==='business-api'?React.createElement('div',{style:{marginBottom:8}},React.createElement('div',{style:{fontSize:11,color:'var(--dim)',marginBottom:4}},'API Key / Access Token'),React.createElement('input',{className:'input mono',type:'password',placeholder:'From Meta Business Suite...',value:whatsappForm.apiKey,onChange:function(e){setWhatsappForm(Object.assign({},whatsappForm,{apiKey:e.target.value}));},style:{fontSize:12}})):null,
              React.createElement('div',{style:{display:'flex',gap:8,marginTop:12}},
                React.createElement('button',{className:'btn btn-sm btn-primary',disabled:loading,onClick:async function(){setLoading(true);try{
                  await api('/profiles/'+profileId+'/channel/whatsapp/setup',{method:'PUT',body:{enabled:true,phoneNumber:whatsappForm.phoneNumber,apiKey:whatsappForm.apiKey||undefined,bridgeType:whatsappForm.bridgeType}});
                  toast('WhatsApp saved! Restarting...','success');setWhatsappEditing(false);
                  await api('/profiles/'+profileId+'/restart',{method:'POST'});setTimeout(function(){loadTab('comms');},2000);
                }catch(e){toast(e.message,'error');}setLoading(false);}},loading?'Saving...':'Save & Restart'),
                React.createElement('button',{className:'btn btn-sm btn-default',onClick:function(){setWhatsappEditing(false);}},'Cancel'))):null,
            (whatsappData.hasApiKey||whatsappData.sessionExists)?React.createElement('div',{style:{marginTop:12,display:'flex',justifyContent:'space-between',alignItems:'center'}},
              React.createElement('div',{style:{fontSize:12,fontWeight:600}},'WhatsApp Enabled'),
              React.createElement('button',{className:'toggle '+(whatsappData.enabled?'on':'off'),onClick:async function(){var ns=!whatsappData.enabled;await api('/profiles/'+profileId+'/channel/whatsapp/setup',{method:'PUT',body:{enabled:ns}});toast(ns?'WhatsApp enabled':'WhatsApp disabled','success');await api('/profiles/'+profileId+'/restart',{method:'POST'});loadTab('comms');}},React.createElement('div',{className:'toggle-dot'}))):null
          ):React.createElement('div',{style:{textAlign:'center',padding:20}},React.createElement('span',{className:'spinner'}))
        ):null,

        cc==='imessage'?React.createElement('div',null,
          React.createElement('details',{style:{marginBottom:16}},
            React.createElement('summary',{className:'card',style:{padding:14,cursor:'pointer',listStyle:'none',display:'flex',alignItems:'center',gap:8,fontSize:13,fontWeight:600}},IC('info',14),' iMessage Setup Guide'),
            React.createElement('div',{style:{padding:16,border:'1px solid var(--border)',borderTop:'none',borderRadius:'0 0 10px 10px',fontSize:12,color:'var(--dim)',lineHeight:1.8}},
              [{n:'1',t:'iMessage requires BlueBubbles ‚Äî a self-hosted bridge running on a Mac with iMessage signed in.'},{n:'2',t:'Install BlueBubbles on a Mac (can be a Mac Mini or old MacBook): bluebubbles.app'},{n:'3',t:'In BlueBubbles, enable the API server and note the Server URL and Password.'},{n:'4',t:'Enter the Server URL and Password below, then Save & Restart.'},{n:'5',t:'The Mac running BlueBubbles must stay online. If it sleeps, the bridge stops.'},{n:'6',t:'Tip: Set the Mac to never sleep (System Settings ‚Üí Energy) and enable "Wake for network access".'}].map(function(s){
                return React.createElement('div',{key:s.n,style:{display:'flex',gap:10,alignItems:'flex-start',marginBottom:6}},
                  React.createElement('span',{style:{width:20,height:20,borderRadius:'50%',background:'rgba(52,199,89,.15)',color:'#34c759',display:'inline-flex',alignItems:'center',justifyContent:'center',fontSize:11,fontWeight:700,flexShrink:0}},s.n),
                  React.createElement('span',null,s.t));}))),
          imessageData?React.createElement('div',{className:'card',style:{padding:16,marginBottom:16,borderColor:imessageData.enabled?'rgba(52,199,89,.2)':'var(--border)'}},
            React.createElement('div',{style:{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:14}},
              React.createElement('div',{style:{display:'flex',alignItems:'center',gap:10}},
                React.createElement('div',{style:{fontSize:16,fontWeight:700}},IC('settings',15),' iMessage / BlueBubbles Configuration'),
                React.createElement('span',{className:'badge',style:{color:imessageData.enabled?'var(--green)':'var(--red)',background:imessageData.enabled?'var(--green-d)':'var(--red-d)'}},imessageData.enabled?'‚óè Enabled':'‚óã Disabled')),
              !imessageEditing?React.createElement('button',{className:'btn btn-xs btn-default',onClick:function(){setImessageEditing(true);setImessageForm({serverUrl:imessageData.serverUrl||'',password:''});}},imessageData.hasPassword?'Edit':'+ Setup'):null),
            imessageData.serverUrl&&!imessageEditing?React.createElement('div',{style:{padding:'10px 14px',background:'var(--bg)',borderRadius:8,border:'1px solid var(--border)',marginBottom:8}},
              React.createElement('div',{style:{fontSize:11,color:'var(--dim)',marginBottom:4}},'Server URL'),
              React.createElement('div',{className:'mono',style:{fontSize:13,color:'var(--accent)'}},imessageData.serverUrl),
              React.createElement('div',{style:{marginTop:6}},React.createElement('div',{style:{fontSize:11,color:'var(--dim)',marginBottom:2}},'Password'),React.createElement('div',{className:'mono',style:{fontSize:12}},imessageData.password||'‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢'))):null,
            imessageEditing?React.createElement('div',{style:{padding:14,background:'var(--bg)',borderRadius:8,border:'1px solid var(--border)'}},
              React.createElement('div',{style:{fontSize:12,fontWeight:600,marginBottom:10}},'BlueBubbles Credentials'),
              React.createElement('div',{style:{marginBottom:8}},React.createElement('div',{style:{fontSize:11,color:'var(--dim)',marginBottom:4}},'Server URL *'),React.createElement('input',{className:'input mono',placeholder:'https://your-mac-ip:1234',value:imessageForm.serverUrl,onChange:function(e){setImessageForm(Object.assign({},imessageForm,{serverUrl:e.target.value}));},style:{fontSize:12}})),
              React.createElement('div',{style:{marginBottom:12}},React.createElement('div',{style:{fontSize:11,color:'var(--dim)',marginBottom:4}},'Password *'),React.createElement('input',{className:'input mono',type:'password',placeholder:'BlueBubbles API password',value:imessageForm.password,onChange:function(e){setImessageForm(Object.assign({},imessageForm,{password:e.target.value}));},style:{fontSize:12}})),
              React.createElement('div',{style:{display:'flex',gap:8}},
                React.createElement('button',{className:'btn btn-sm btn-primary',disabled:loading||(!imessageForm.serverUrl&&!imessageData.serverUrl),onClick:async function(){setLoading(true);try{
                  await api('/profiles/'+profileId+'/channel/bluebubbles/setup',{method:'PUT',body:{enabled:true,serverUrl:imessageForm.serverUrl,password:imessageForm.password||undefined}});
                  toast('iMessage saved! Restarting...','success');setImessageEditing(false);
                  await api('/profiles/'+profileId+'/restart',{method:'POST'});setTimeout(function(){loadTab('comms');},2000);
                }catch(e){toast(e.message,'error');}setLoading(false);}},loading?'Saving...':'Save & Restart'),
                React.createElement('button',{className:'btn btn-sm btn-default',onClick:function(){setImessageEditing(false);}},'Cancel'))):null,
            imessageData.hasPassword?React.createElement('div',{style:{marginTop:12,display:'flex',justifyContent:'space-between',alignItems:'center'}},
              React.createElement('div',{style:{fontSize:12,fontWeight:600}},'iMessage Enabled'),
              React.createElement('button',{className:'toggle '+(imessageData.enabled?'on':'off'),onClick:async function(){var ns=!imessageData.enabled;await api('/profiles/'+profileId+'/channel/bluebubbles/setup',{method:'PUT',body:{enabled:ns}});toast(ns?'iMessage enabled':'iMessage disabled','success');await api('/profiles/'+profileId+'/restart',{method:'POST'});loadTab('comms');}},React.createElement('div',{className:'toggle-dot'}))):null
          ):React.createElement('div',{style:{textAlign:'center',padding:20}},React.createElement('span',{className:'spinner'}))
        ):null);
    }
    if(tab==='history'&&sessions){
      return React.createElement('div',null,
        sessions.specialFiles&&sessions.specialFiles.length>0?React.createElement('div',{style:{marginBottom:20}},
          React.createElement('div',{className:'section-title'},React.createElement('h3',null,'üìå Special Files')),
          React.createElement('div',{style:{display:'grid',gridTemplateColumns:'repeat(auto-fit,minmax(200px,1fr))',gap:8}},
            sessions.specialFiles.map(function(f){return React.createElement('div',{key:f.name,className:'card card-click',style:{padding:12},onClick:function(){setMemModal(f);}},
              React.createElement('div',{style:{fontWeight:600,fontSize:13,color:'var(--accent)'}},f.name),
              React.createElement('div',{className:'mono',style:{fontSize:10,color:'var(--dim)',marginTop:4,maxHeight:40,overflow:'hidden'}},f.preview&&f.preview.slice(0,100)));}))):null,
        sessions.memoryFiles&&sessions.memoryFiles.length>0?React.createElement('div',null,
          React.createElement('div',{className:'section-title'},React.createElement('h3',null,'üí¨ Memory Log Files'),React.createElement('span',{className:'badge',style:{color:'var(--accent)',background:'var(--accent-d)'}},sessions.memoryFiles.length+' files')),
          React.createElement('div',{className:'search-wrap',style:{marginBottom:8}},
            React.createElement('input',{className:'input',placeholder:'Search memory files‚Ä¶',value:memFilter,onChange:function(e){setMemFilter(e.target.value);},style:{fontSize:12}}),
            memFilter?React.createElement('button',{className:'clear-x',onClick:function(){setMemFilter('');}},'‚úï'):null),
          React.createElement('div',{className:'card',style:{padding:0,overflow:'hidden',maxHeight:500,overflowY:'auto'}},
            sessions.memoryFiles.filter(function(f){if(!memFilter)return true;var q=memFilter.toLowerCase();return(f.name||'').toLowerCase().includes(q)||(f.preview||'').toLowerCase().includes(q);}).map(function(f){return React.createElement('div',{key:f.name,className:'mem-file',onClick:function(){setMemModal(f);}},
              React.createElement('div',{style:{display:'flex',justifyContent:'space-between',alignItems:'center'}},
                React.createElement('span',{style:{fontWeight:600,fontSize:13}},f.name),
                React.createElement('div',{style:{display:'flex',alignItems:'center',gap:6}},
                  React.createElement('span',{className:'badge',style:{fontSize:9,color:f.type==='json'?'var(--amber)':'var(--accent)',background:f.type==='json'?'var(--amber-d)':'var(--accent-d)'}},f.type),
                  React.createElement('span',{className:'mono',style:{fontSize:11,color:'var(--dim)'}},(f.size/1024).toFixed(1)+'KB'),
                  React.createElement('button',{className:'btn btn-ghost',style:{padding:'1px 4px',fontSize:10},title:'Backup this file',onClick:function(ev){ev.stopPropagation();api('/profiles/'+profileId+'/memory/'+f.name+'/backup',{method:'POST'}).then(function(){toast('Backed up '+f.name,'success');}).catch(function(e){toast(e.message,'error');});}},IC('downloadCloud',11)),
                  React.createElement('button',{className:'btn btn-ghost',style:{padding:'1px 4px',fontSize:10},title:'Restore from backup',onClick:function(ev){ev.stopPropagation();if(!confirm('Restore '+f.name+' from backup?'))return;api('/profiles/'+profileId+'/memory/'+f.name+'/restore',{method:'POST'}).then(function(r){toast(r.message||'Restored','success');loadTab('history');}).catch(function(e){toast(e.message,'error');});}},IC('clock',11)))),
              React.createElement('div',{className:'mono',style:{fontSize:11,color:'var(--dim)',marginTop:4,maxHeight:36,overflow:'hidden'}},f.preview));}))):
        React.createElement('div',{className:'card',style:{padding:20,textAlign:'center',color:'var(--dim)'}},'No memory files found.'));
    }
    if(tab==='env'&&envVars){
      return React.createElement('div',null,
        React.createElement('div',{style:{display:'flex',justifyContent:'space-between',marginBottom:12,flexWrap:'wrap',gap:6}},
          React.createElement('div',{style:{display:'flex',gap:6,flexWrap:'wrap'}},
            React.createElement('button',{className:'btn btn-sm btn-default',onClick:function(){setEnvRevealed(!envRevealed);setTimeout(function(){loadTab('env');},50);}},envRevealed?'üîí Mask':'üëÅ Reveal'),
            React.createElement('a',{href:dlUrl('/profiles/'+profileId+'/env/download'),className:'btn btn-sm btn-default',style:{textDecoration:'none'}},IC('downloadCloud',12),' ‚¨á .env'),
            React.createElement('button',{className:'btn btn-sm btn-default',onClick:function(){var inp=document.createElement('input');inp.type='file';inp.accept='.env,.txt';inp.onchange=async function(e){var file=e.target.files[0];if(!file)return;var txt=await file.text();if(!confirm('Upload and merge '+file.name+'? Existing keys will be kept, new/updated keys will be added.'))return;try{var r=await api('/profiles/'+profileId+'/env/upload',{method:'POST',body:{content:txt,merge:true}});toast('Uploaded! '+r.keysAdded+' keys merged','success');loadTab('env');}catch(er){toast(er.message,'error');}};inp.click();}},IC('upload',12),' ‚¨Ü Upload .env'),
            React.createElement('button',{className:'btn btn-sm btn-primary',onClick:function(){setAddingEnv(!addingEnv);}},addingEnv?'‚úï':'+ Add')),
          React.createElement('button',{className:'btn btn-sm btn-danger',onClick:async function(){if(!confirm('‚ö†Ô∏è EMERGENCY PURGE: This will remove ALL keys, secrets, tokens, and passwords from this profile .env file. A backup will be saved. Continue?'))return;if(!confirm('Are you absolutely sure? Type OK in next prompt to confirm.'))return;try{var r=await api('/profiles/'+profileId+'/env/purge',{method:'POST'});toast('Purged '+r.purged.length+' keys. Backup saved.','success');loadTab('env');}catch(er){toast(er.message,'error');}},style:{gap:4}},IC('alertTriangle',12),' Emergency Purge')),
        addingEnv?React.createElement('div',{className:'card',style:{padding:14,marginBottom:12}},
          React.createElement('div',{style:{display:'grid',gridTemplateColumns:'1fr 2fr',gap:8,marginBottom:8}},
            React.createElement('input',{className:'input',placeholder:'KEY',value:newEnvKey,onChange:function(e){setNewEnvKey(e.target.value.toUpperCase());}}),
            React.createElement('input',{className:'input',placeholder:'value',value:newEnvVal,onChange:function(e){setNewEnvVal(e.target.value);},type:envRevealed?'text':'password'})),
          React.createElement('button',{className:'btn btn-sm btn-primary',onClick:async function(){if(!newEnvKey)return;await api('/profiles/'+profileId+'/env/set',{method:'POST',body:{key:newEnvKey,value:newEnvVal}});toast('Saved','success');setNewEnvKey('');setNewEnvVal('');setAddingEnv(false);loadTab('env');}},'Save')):null,
        React.createElement('div',{className:'card',style:{padding:0,overflow:'hidden'}},
          Object.entries(envVars).length===0?React.createElement('div',{style:{padding:20,textAlign:'center',color:'var(--dim)'}},'No vars'):
          Object.entries(envVars).map(function(entry){var k=entry[0],v=entry[1];var isDisabled=!!envVars[k+'_DISABLED'];var isDisabledKey=k.endsWith('_DISABLED');if(isDisabledKey)return null;return React.createElement('div',{key:k,className:'env-row',style:{opacity:isDisabled?.5:1}},
            React.createElement('div',{style:{flex:1,minWidth:0,overflow:'hidden'}},React.createElement('div',{className:'mono trunc',style:{fontSize:12,fontWeight:600,color:isDisabled?'var(--dim)':'var(--accent)'}},k),React.createElement('div',{className:'mono trunc',style:{fontSize:11,color:'var(--dim)',marginTop:2}},v)),
            React.createElement('div',{style:{display:'flex',gap:4,alignItems:'center',flexShrink:0}},
              /key|secret|token|api/i.test(k)?React.createElement('button',{className:'toggle '+(isDisabled?'off':'on'),style:{transform:'scale(.7)'},onClick:async function(){await api('/profiles/'+profileId+'/env/'+k+'/toggle',{method:'POST',body:{enabled:isDisabled}});toast(isDisabled?k+' enabled':k+' disabled','success');loadTab('env');}},React.createElement('div',{className:'toggle-dot'})):null,
              React.createElement('button',{className:'btn btn-ghost',style:{color:'var(--red)'},onClick:async function(){if(!confirm('Delete '+k+'?'))return;await api('/profiles/'+profileId+'/env/'+k,{method:'DELETE'});loadTab('env');}},'‚úï')));})));
    }
    if(tab==='models'&&models){
      var provs=[
        {id:'anthropic',n:'Anthropic',i:'üß†',ek:'ANTHROPIC_API_KEY',ms:['anthropic/claude-opus-4-6','anthropic/claude-sonnet-4-6','anthropic/claude-sonnet-4-5','anthropic/claude-haiku-3','anthropic/claude-opus-4-5'],lb:['Opus 4.6','Sonnet 4.6','Sonnet 4.5','Haiku 3','Opus 4.5']},
        {id:'openai',n:'OpenAI',i:'üíö',ek:'OPENAI_API_KEY',ms:['openai/gpt-5-mini','openai/gpt-4o','openai/gpt-4o-mini','openai/o3-mini'],lb:['GPT-5 Mini','GPT-4o','4o Mini','o3 Mini']},
        {id:'google',n:'Google',i:'üîµ',ek:'GOOGLE_API_KEY',ms:['google/gemini-2.5-pro','google/gemini-2.5-flash'],lb:['2.5 Pro','2.5 Flash']},
        {id:'xai',n:'xAI',i:'‚ö°',ek:'XAI_API_KEY',ms:['xai/grok-3','xai/grok-3-mini'],lb:['Grok 3','Grok 3 Mini']},
        {id:'deepseek',n:'DeepSeek',i:'üåä',ek:'DEEPSEEK_API_KEY',ms:['deepseek/deepseek-chat','deepseek/deepseek-reasoner'],lb:['Chat','Reasoner']}];
      var curModel=models.agentModel||null;
      return React.createElement('div',null,
        React.createElement('div',{className:'card',style:{padding:16,marginBottom:16,borderColor:'rgba(34,211,238,.2)'}},
          React.createElement('div',{style:{fontSize:11,color:'var(--dim)',textTransform:'uppercase',letterSpacing:1,marginBottom:6}},'Active Agent Model'),
          React.createElement('div',{style:{fontSize:20,fontWeight:700,color:'var(--accent)'}},curModel||'Not set'),
          models.agentModelPath?React.createElement('div',{className:'mono',style:{fontSize:10,color:'var(--dim)',marginTop:4}},'Config: '+models.agentModelPath):null),
        React.createElement('div',{style:{padding:'10px 14px',marginBottom:16,background:'var(--surface2)',borderRadius:8,border:'1px solid var(--border)',fontSize:12,color:'var(--dim)'}},'‚ë† Add API key ‚Üí ‚ë° Click model to activate ‚Üí ‚ë¢ Restart gateway to apply'),
        provs.map(function(pv){
          var hasKey=envVars&&Object.keys(envVars).some(function(k){return k===pv.ek;});
          var isOpen=apiKeyProv===pv.id;
          return React.createElement('div',{key:pv.id,className:'card',style:{padding:16,marginBottom:10,borderColor:hasKey?'rgba(52,211,153,.12)':'var(--border)'}},
            React.createElement('div',{style:{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:hasKey?10:0}},
              React.createElement('div',{style:{display:'flex',alignItems:'center',gap:10}},React.createElement('span',{style:{fontSize:20}},pv.i),React.createElement('b',{style:{fontSize:14}},pv.n)),
              React.createElement('div',{style:{display:'flex',gap:6,alignItems:'center'}},
                hasKey?React.createElement('span',{className:'badge',style:{color:'var(--green)',background:'var(--green-d)',fontSize:10}},'‚úì Key'):null,
                hasKey?React.createElement('button',{className:'toggle '+(!envVars[pv.ek+'_DISABLED']?'on':'off'),style:{transform:'scale(.65)'},title:'Enable/disable this provider for this profile',onClick:async function(){var isDis=!!envVars[pv.ek+'_DISABLED'];await api('/profiles/'+profileId+'/env/'+pv.ek+'/toggle',{method:'POST',body:{enabled:isDis}});toast(isDis?pv.n+' enabled':pv.n+' disabled','success');loadTab('models');}},React.createElement('div',{className:'toggle-dot'})):null,
                React.createElement('button',{className:'btn btn-xs '+(isOpen?'btn-default':'btn-primary'),onClick:function(){setApiKeyProv(isOpen?null:pv.id);setApiKeyIn('');}},isOpen?'‚úï':hasKey?'üîë Change':'+ Key'))),
            isOpen?React.createElement('div',{style:{padding:12,background:'var(--bg)',borderRadius:8,border:'1px solid var(--border)',marginTop:8,marginBottom:8}},
              React.createElement('div',{className:'mono',style:{fontSize:11,color:'var(--accent)',marginBottom:6}},pv.ek),
              React.createElement('div',{style:{display:'flex',gap:8}},
                React.createElement('input',{className:'input mono',type:'password',placeholder:'Paste API key‚Ä¶',value:apiKeyIn,onChange:function(e){setApiKeyIn(e.target.value);},style:{flex:1,fontSize:12}}),
                React.createElement('button',{className:'btn btn-sm btn-primary',disabled:!apiKeyIn,onClick:async function(){await api('/profiles/'+profileId+'/env/set',{method:'POST',body:{key:pv.ek,value:apiKeyIn}});toast(pv.n+' key saved!','success');setApiKeyProv(null);setApiKeyIn('');loadTab('models');}},'Save'))):null,
            hasKey?React.createElement('div',{style:{display:'flex',gap:6,flexWrap:'wrap',marginTop:isOpen?0:0}},
              pv.ms.map(function(m,mi){var isActive=curModel===m;return React.createElement('button',{key:m,className:'btn btn-sm '+(isActive?'btn-primary':'btn-default'),style:{fontSize:11},onClick:async function(){
                await api('/profiles/'+profileId+'/models',{method:'PUT',body:{model:m}});
                toast('Model ‚Üí '+pv.lb[mi]+' (restart to apply)','success');loadTab('models');}},pv.lb[mi]);})):null);}),
        React.createElement('div',{className:'fixed-restart'},
          React.createElement('button',{className:'btn btn-green',style:{padding:'12px 28px',fontSize:14,boxShadow:'0 4px 24px rgba(0,0,0,.5)',borderRadius:12},onClick:async function(){await api('/profiles/'+profileId+'/restart',{method:'POST'});toast('Restarting gateway‚Ä¶','success');}},'‚Üª Restart Gateway')),
        models.availableModels&&models.availableModels.length>0?React.createElement('details',{style:{marginTop:16}},
          React.createElement('summary',{style:{fontSize:12,color:'var(--dim)',cursor:'pointer'}},'üìã Configured model slots ('+models.availableModels.length+')'),
          React.createElement('div',{style:{marginTop:8,display:'flex',flexWrap:'wrap',gap:4}},
            models.availableModels.map(function(m){return React.createElement('span',{key:m,className:'badge',style:{color:m===curModel?'var(--accent)':'var(--dim)',background:m===curModel?'var(--accent-d)':'var(--border)',fontSize:11,padding:'4px 8px'}},m);}))):null,
        Object.keys(models.rawConfig||{}).length>0?React.createElement('details',{style:{marginTop:8}},
          React.createElement('summary',{style:{fontSize:12,color:'var(--dim)',cursor:'pointer'}},'‚öô Raw config'),
          React.createElement('div',{style:{marginTop:8}},Object.entries(models.rawConfig).map(function(e){return React.createElement('div',{key:e[0],className:'mono',style:{fontSize:11,padding:'4px 0',color:'var(--dim)'}},e[0]+': '+JSON.stringify(e[1]));}))):null);
    }
    if(tab==='config'&&config!==null){
      return React.createElement('div',null,
        React.createElement('div',{style:{display:'flex',justifyContent:'flex-end',marginBottom:8}},
          React.createElement('button',{className:'btn btn-sm btn-primary',onClick:async function(){try{await api('/profiles/'+profileId+'/config',{method:'PUT',body:{config:JSON.parse(config)}});toast('Saved','success');}catch(e){toast(e.message,'error');}}},'üíæ Save')),
        React.createElement('textarea',{value:config,onChange:function(e){setConfig(e.target.value);},className:'mono',style:{width:'100%',minHeight:400,padding:16,background:'var(--bg)',color:'var(--text)',border:'1px solid var(--border)',borderRadius:8,fontSize:12,lineHeight:1.7,resize:'vertical'}}));
    }
    if(tab==='soul'&&soul!==null){
      return React.createElement('div',null,
        React.createElement('div',{style:{display:'flex',justifyContent:'space-between',alignItems:'center',gap:6,marginBottom:8,flexWrap:'wrap'}},
          React.createElement('div',{style:{display:'flex',gap:6,alignItems:'center'}},
            React.createElement('div',{style:{fontSize:14,fontWeight:600}},'Soul Configuration'),
            React.createElement('span',{className:'badge',style:{color:'var(--green)',background:'var(--green-d)',fontSize:10}},'soul.md')),
          React.createElement('div',{style:{display:'flex',gap:6,flexWrap:'wrap'}},
            React.createElement('button',{className:'btn btn-sm btn-default',title:'Create timestamped backup',onClick:async function(){try{await api('/profiles/'+profileId+'/soul/backup',{method:'POST'});toast('Soul backup created','success');}catch(e){toast(e.message,'error');}}},'üì∏ Backup'),
            React.createElement('button',{className:'btn btn-sm btn-default',title:'Restore from most recent backup',onClick:async function(){if(!confirm('Restore soul from last backup? Current soul will be backed up first.'))return;try{var r=await api('/profiles/'+profileId+'/soul/restore',{method:'POST'});toast(r.message||'Restored','success');loadTab('soul');}catch(e){toast(e.message,'error');}}},'‚è™ Restore'),
            React.createElement('button',{className:'btn btn-sm btn-default',title:'Upload a soul.md file',onClick:function(){var inp=document.createElement('input');inp.type='file';inp.accept='.md,.txt';inp.onchange=async function(ev){var f=ev.target.files[0];if(!f)return;var txt=await f.text();setSoul(txt);toast('File loaded ‚Äî click Save to apply','success');};inp.click();}},IC('upload',12),' Upload'),
            React.createElement('a',{href:dlUrl('/profiles/'+profileId+'/soul/download'),className:'btn btn-sm btn-default',style:{textDecoration:'none'}},IC('downloadCloud',12),' ‚¨á'),
            React.createElement('button',{className:'btn btn-sm btn-primary',onClick:async function(){await api('/profiles/'+profileId+'/soul',{method:'PUT',body:{content:soul}});toast('Saved','success');}},'üíæ Save'))),
        React.createElement('textarea',{value:soul,onChange:function(e){setSoul(e.target.value);},className:'mono',style:{width:'100%',minHeight:400,padding:16,background:'var(--bg)',color:'var(--text)',border:'1px solid var(--border)',borderRadius:8,fontSize:12,lineHeight:1.7,resize:'vertical'}}));
    }
    if(tab==='skills'&&skills!==null){
      return React.createElement('div',{style:{display:'flex',flexDirection:'column',gap:6}},
        skills.length===0?React.createElement('div',{className:'card',style:{padding:20,textAlign:'center',color:'var(--dim)'}},'No skills'):
        skills.map(function(s){return React.createElement('div',{key:s.name,className:'card',style:{padding:'12px 14px',display:'flex',alignItems:'center',justifyContent:'space-between',gap:8,opacity:s.enabled?1:.5}},
          React.createElement('div',{style:{flex:1,minWidth:0}},
            React.createElement('b',{style:{fontSize:13}},s.name),
            !s.enabled?React.createElement('span',{className:'badge',style:{color:'var(--amber)',background:'var(--amber-d)',fontSize:10,marginLeft:6}},'OFF'):null,
            s.description?React.createElement('div',{style:{fontSize:12,color:'var(--dim)',marginTop:2}},s.description):null),
          React.createElement('div',{style:{display:'flex',gap:4,alignItems:'center',flexShrink:0}},
            React.createElement('a',{href:dlUrl('/profiles/'+profileId+'/skills/'+s.name+'/download'),className:'btn btn-ghost',style:{textDecoration:'none'}},'‚¨á'),
            React.createElement('button',{className:'btn btn-ghost',onClick:function(){setCopyModal(s.name);}},'‚ßâ'),
            React.createElement('button',{className:'btn btn-ghost',style:{color:'var(--red)'},onClick:async function(){if(!confirm('Delete "'+s.name+'"?'))return;await api('/profiles/'+profileId+'/skills/'+s.name,{method:'DELETE'});loadTab('skills');}},'üóë'),
            React.createElement('button',{className:'toggle '+(s.enabled?'on':'off'),onClick:async function(){await api('/profiles/'+profileId+'/skills/'+s.name+'/toggle',{method:'POST',body:{enabled:!s.enabled}});loadTab('skills');}},React.createElement('div',{className:'toggle-dot'}))));}));
    }

    if(tab==='ftp'){
      return React.createElement('div',null,
        React.createElement('div',{className:'section-title'},
          React.createElement('h3',null,'üì° FTP / Website Management'),
          React.createElement('button',{className:'btn btn-sm btn-default',onClick:function(){loadTab('ftp');}},'‚Üª')),
        ftpData?React.createElement('div',null,
          React.createElement('div',{className:'card',style:{padding:16,marginBottom:16,borderColor:ftpData.hasCredentials?'rgba(52,211,153,.15)':'var(--border)'}},
            React.createElement('div',{style:{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:14}},
              React.createElement('div',{style:{display:'flex',alignItems:'center',gap:10}},
                React.createElement('div',{style:{fontSize:16,fontWeight:700}},'üåê FTP Connection'),
                ftpData.hasCredentials?React.createElement('span',{className:'badge',style:{color:'var(--green)',background:'var(--green-d)'}},'‚úì Configured'):React.createElement('span',{className:'badge',style:{color:'var(--amber)',background:'var(--amber-d)'}},'Not configured')),
              !ftpEditing&&ftpData.hasCredentials?React.createElement('button',{className:'btn btn-xs btn-default',onClick:function(){setFtpEditing(true);}},'‚úèÔ∏è Edit'):null),
            ftpData.hasCredentials&&!ftpEditing?React.createElement('div',{className:'form-2col',style:{display:'grid',gridTemplateColumns:'1fr 1fr',gap:8}},
              React.createElement('div',{style:{padding:'10px 14px',background:'var(--bg)',borderRadius:8,border:'1px solid var(--border)'}},React.createElement('div',{style:{fontSize:10,color:'var(--dim)',textTransform:'uppercase'}},'Host'),React.createElement('div',{className:'mono trunc',style:{fontSize:13,color:'var(--accent)',marginTop:2}},ftpData.host)),
              React.createElement('div',{style:{padding:'10px 14px',background:'var(--bg)',borderRadius:8,border:'1px solid var(--border)'}},React.createElement('div',{style:{fontSize:10,color:'var(--dim)',textTransform:'uppercase'}},'User'),React.createElement('div',{className:'mono trunc',style:{fontSize:13,color:'var(--accent)',marginTop:2}},ftpData.user)),
              React.createElement('div',{style:{padding:'10px 14px',background:'var(--bg)',borderRadius:8,border:'1px solid var(--border)'}},React.createElement('div',{style:{fontSize:10,color:'var(--dim)',textTransform:'uppercase'}},'Password'),React.createElement('div',{className:'mono trunc',style:{fontSize:13,color:'var(--dim)',marginTop:2}},ftpData.pass)),
              React.createElement('div',{style:{padding:'10px 14px',background:'var(--bg)',borderRadius:8,border:'1px solid var(--border)'}},React.createElement('div',{style:{fontSize:10,color:'var(--dim)',textTransform:'uppercase'}},'Port'),React.createElement('div',{className:'mono',style:{fontSize:13,marginTop:2}},ftpData.port))
            ):null,
            ftpEditing?React.createElement('div',{style:{padding:14,background:'var(--bg)',borderRadius:8,border:'1px solid rgba(34,211,238,.2)',overflow:'hidden'}},
              React.createElement('div',{className:'form-2col',style:{display:'grid',gridTemplateColumns:'1fr 1fr',gap:10,marginBottom:10}},
                React.createElement('div',null,React.createElement('label',{className:'mono',style:{fontSize:10,color:'var(--dim)',display:'block',marginBottom:4}},'FTP_HOST'),React.createElement('input',{className:'input mono',value:ftpForm.host,onChange:function(e){setFtpForm(Object.assign({},ftpForm,{host:e.target.value}));},placeholder:'ftp.example.com'})),
                React.createElement('div',null,React.createElement('label',{className:'mono',style:{fontSize:10,color:'var(--dim)',display:'block',marginBottom:4}},'FTP_USER'),React.createElement('input',{className:'input mono',value:ftpForm.user,onChange:function(e){setFtpForm(Object.assign({},ftpForm,{user:e.target.value}));},placeholder:'user@example.com'})),
                React.createElement('div',null,React.createElement('label',{className:'mono',style:{fontSize:10,color:'var(--dim)',display:'block',marginBottom:4}},'FTP_PASS'),React.createElement('input',{className:'input mono',type:'password',value:ftpForm.pass,onChange:function(e){setFtpForm(Object.assign({},ftpForm,{pass:e.target.value}));},placeholder:'password'})),
                React.createElement('div',null,React.createElement('label',{className:'mono',style:{fontSize:10,color:'var(--dim)',display:'block',marginBottom:4}},'FTP_PORT'),React.createElement('input',{className:'input mono',value:ftpForm.port,onChange:function(e){setFtpForm(Object.assign({},ftpForm,{port:e.target.value}));},placeholder:'21'}))),
              React.createElement('div',{style:{display:'flex',gap:8}},
                React.createElement('button',{className:'btn btn-sm btn-primary',onClick:async function(){await api('/profiles/'+profileId+'/ftp',{method:'PUT',body:ftpForm});toast('FTP credentials saved!','success');setFtpEditing(false);loadTab('ftp');}},'üíæ Save'),
                ftpData.hasCredentials?React.createElement('button',{className:'btn btn-sm btn-default',onClick:function(){setFtpEditing(false);}},'Cancel'):null)
            ):null),
          React.createElement('div',{className:'card',style:{padding:16,marginBottom:16}},
            React.createElement('div',{style:{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:12}},
              React.createElement('div',{style:{fontSize:14,fontWeight:600}},'üîå Test Connection'),
              React.createElement('button',{className:'btn btn-sm '+(ftpData.hasCredentials?'btn-primary':'btn-default'),disabled:!ftpData.hasCredentials||ftpTesting,onClick:async function(){setFtpTesting(true);setFtpTestResult(null);try{var r=await api('/profiles/'+profileId+'/ftp/test',{method:'POST'});setFtpTestResult(r);}catch(e){setFtpTestResult({ok:false,output:e.message});}setFtpTesting(false);}},ftpTesting?React.createElement('span',{className:'spinner'}):'Test')),
            ftpTestResult?React.createElement('div',{style:{padding:12,borderRadius:8,background:ftpTestResult.ok?'var(--green-d)':'var(--red-d)',color:ftpTestResult.ok?'var(--green)':'var(--red)',fontSize:12}},
              React.createElement('span',{className:'mono'},ftpTestResult.output)):null,
            !ftpData.hasCredentials?React.createElement('div',{style:{padding:12,textAlign:'center',color:'var(--dim)',fontSize:12}},'Save FTP credentials first to test connection.'):null),
          React.createElement('div',{className:'card',style:{padding:16}},
            React.createElement('div',{style:{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:8}},
              React.createElement('div',{style:{fontSize:14,fontWeight:600}},'üõ† FTP Deploy Skill'),
              ftpData.hasFtpSkill?React.createElement('span',{className:'badge',style:{color:'var(--green)',background:'var(--green-d)'}},'‚úì Installed'):
                React.createElement('button',{className:'btn btn-xs btn-primary',onClick:async function(){var r=await api('/profiles/'+profileId+'/ftp/install-skill',{method:'POST'});toast(r.message,r.ok?'success':'error');loadTab('ftp');}},'Install')),
            React.createElement('div',{style:{fontSize:12,color:'var(--dim)',lineHeight:1.6}},'The ftp-deploy skill gives the bot commands to list, upload, download, read, and write files on the FTP server. The bot can manage website content directly.')),
          React.createElement('div',{className:'card',style:{padding:16,marginTop:16}},
            React.createElement('div',{style:{display:'flex',justifyContent:'space-between',alignItems:'center'}},
              React.createElement('div',null,React.createElement('div',{style:{fontSize:14,fontWeight:600}},'FTP Enabled'),React.createElement('div',{style:{fontSize:11,color:'var(--dim)'}},'Toggle FTP access for this profile')),
              React.createElement('button',{className:'toggle '+(ftpData.ftpEnabled?'on':'off'),onClick:async function(){var newState=!ftpData.ftpEnabled;await api('/profiles/'+profileId+'/ftp/toggle',{method:'POST',body:{enabled:newState}});toast(newState?'FTP enabled':'FTP disabled','success');loadTab('ftp');}},React.createElement('div',{className:'toggle-dot'}))))
        ):React.createElement('div',{style:{textAlign:'center',padding:20}},React.createElement('span',{className:'spinner'})));
    }
    if(tab==='smtp'){
      return React.createElement('div',null,
        React.createElement('div',{className:'section-title'},
          React.createElement('h3',null,'Email / SMTP Management'),
          React.createElement('button',{className:'btn btn-sm btn-default',onClick:function(){loadTab('smtp');}},'‚Üª')),
        smtpData?React.createElement('div',null,
          React.createElement('div',{className:'card',style:{padding:16,marginBottom:16,borderColor:smtpData.hasCredentials?'rgba(52,211,153,.15)':'var(--border)'}},
            React.createElement('div',{style:{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:14}},
              React.createElement('div',{style:{display:'flex',alignItems:'center',gap:10}},
                IC('mail',18),
                React.createElement('div',{style:{fontSize:16,fontWeight:700}},'SMTP Connection'),
                smtpData.hasCredentials?React.createElement('span',{className:'badge',style:{color:'var(--green)',background:'var(--green-d)'}},'‚úì Configured'):React.createElement('span',{className:'badge',style:{color:'var(--amber)',background:'var(--amber-d)'}},'Not configured')),
              !smtpEditing&&smtpData.hasCredentials?React.createElement('button',{className:'btn btn-xs btn-default',onClick:function(){setSmtpEditing(true);}},'‚úèÔ∏è Edit'):null),
            smtpData.hasCredentials&&!smtpEditing?React.createElement('div',{className:'form-2col',style:{display:'grid',gridTemplateColumns:'1fr 1fr',gap:8}},
              React.createElement('div',{style:{padding:'10px 14px',background:'var(--bg)',borderRadius:8,border:'1px solid var(--border)'}},React.createElement('div',{style:{fontSize:10,color:'var(--dim)',textTransform:'uppercase'}},'Host'),React.createElement('div',{className:'mono trunc',style:{fontSize:13,color:'var(--accent)',marginTop:2}},smtpData.host)),
              React.createElement('div',{style:{padding:'10px 14px',background:'var(--bg)',borderRadius:8,border:'1px solid var(--border)'}},React.createElement('div',{style:{fontSize:10,color:'var(--dim)',textTransform:'uppercase'}},'Port'),React.createElement('div',{className:'mono',style:{fontSize:13,marginTop:2}},smtpData.port)),
              React.createElement('div',{style:{padding:'10px 14px',background:'var(--bg)',borderRadius:8,border:'1px solid var(--border)'}},React.createElement('div',{style:{fontSize:10,color:'var(--dim)',textTransform:'uppercase'}},'User'),React.createElement('div',{className:'mono trunc',style:{fontSize:13,color:'var(--accent)',marginTop:2}},smtpData.user)),
              React.createElement('div',{style:{padding:'10px 14px',background:'var(--bg)',borderRadius:8,border:'1px solid var(--border)'}},React.createElement('div',{style:{fontSize:10,color:'var(--dim)',textTransform:'uppercase'}},'Password'),React.createElement('div',{className:'mono trunc',style:{fontSize:13,color:'var(--dim)',marginTop:2}},smtpData.pass)),
              React.createElement('div',{style:{padding:'10px 14px',background:'var(--bg)',borderRadius:8,border:'1px solid var(--border)'}},React.createElement('div',{style:{fontSize:10,color:'var(--dim)',textTransform:'uppercase'}},'From'),React.createElement('div',{className:'mono trunc',style:{fontSize:13,color:'var(--accent)',marginTop:2}},smtpData.from||'(not set)')),
              React.createElement('div',{style:{padding:'10px 14px',background:'var(--bg)',borderRadius:8,border:'1px solid var(--border)'}},React.createElement('div',{style:{fontSize:10,color:'var(--dim)',textTransform:'uppercase'}},'TLS/SSL'),React.createElement('div',{className:'mono',style:{fontSize:13,color:smtpData.secure?'var(--green)':'var(--dim)',marginTop:2}},smtpData.secure?'Enabled':'Disabled'))
            ):null,
            smtpEditing?React.createElement('div',{style:{padding:14,background:'var(--bg)',borderRadius:8,border:'1px solid rgba(228,228,231,.15)',overflow:'hidden'}},
              React.createElement('div',{className:'form-2col',style:{display:'grid',gridTemplateColumns:'1fr 1fr',gap:10,marginBottom:10}},
                React.createElement('div',null,React.createElement('label',{className:'mono',style:{fontSize:10,color:'var(--dim)',display:'block',marginBottom:4}},'SMTP_HOST'),React.createElement('input',{className:'input mono',value:smtpForm.host,onChange:function(e){setSmtpForm(Object.assign({},smtpForm,{host:e.target.value}));},placeholder:'smtp.gmail.com'})),
                React.createElement('div',null,React.createElement('label',{className:'mono',style:{fontSize:10,color:'var(--dim)',display:'block',marginBottom:4}},'SMTP_PORT'),React.createElement('input',{className:'input mono',value:smtpForm.port,onChange:function(e){setSmtpForm(Object.assign({},smtpForm,{port:e.target.value}));},placeholder:'587'})),
                React.createElement('div',null,React.createElement('label',{className:'mono',style:{fontSize:10,color:'var(--dim)',display:'block',marginBottom:4}},'SMTP_USER'),React.createElement('input',{className:'input mono',value:smtpForm.user,onChange:function(e){setSmtpForm(Object.assign({},smtpForm,{user:e.target.value}));},placeholder:'user@example.com'})),
                React.createElement('div',null,React.createElement('label',{className:'mono',style:{fontSize:10,color:'var(--dim)',display:'block',marginBottom:4}},'SMTP_PASS'),React.createElement('input',{className:'input mono',type:'password',value:smtpForm.pass,onChange:function(e){setSmtpForm(Object.assign({},smtpForm,{pass:e.target.value}));},placeholder:'app password'})),
                React.createElement('div',null,React.createElement('label',{className:'mono',style:{fontSize:10,color:'var(--dim)',display:'block',marginBottom:4}},'SMTP_FROM'),React.createElement('input',{className:'input mono',value:smtpForm.from,onChange:function(e){setSmtpForm(Object.assign({},smtpForm,{from:e.target.value}));},placeholder:'bot@example.com'})),
                React.createElement('div',{style:{display:'flex',alignItems:'center',gap:10,paddingTop:18}},
                  React.createElement('label',{className:'mono',style:{fontSize:10,color:'var(--dim)'}},'TLS/SSL'),
                  React.createElement('button',{className:'toggle '+(smtpForm.secure?'on':'off'),onClick:function(){setSmtpForm(Object.assign({},smtpForm,{secure:!smtpForm.secure}));}},React.createElement('div',{className:'toggle-dot'})))),
              React.createElement('div',{style:{display:'flex',gap:8}},
                React.createElement('button',{className:'btn btn-sm btn-primary',onClick:async function(){await api('/profiles/'+profileId+'/smtp',{method:'PUT',body:smtpForm});toast('SMTP credentials saved!','success');setSmtpEditing(false);loadTab('smtp');}},'üíæ Save'),
                smtpData.hasCredentials?React.createElement('button',{className:'btn btn-sm btn-default',onClick:function(){setSmtpEditing(false);}},'Cancel'):null)
            ):null),
          React.createElement('div',{className:'card',style:{padding:16,marginBottom:16}},
            React.createElement('div',{style:{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:12}},
              React.createElement('div',{style:{fontSize:14,fontWeight:600}},'Test Connection'),
              React.createElement('button',{className:'btn btn-sm '+(smtpData.hasCredentials?'btn-primary':'btn-default'),disabled:!smtpData.hasCredentials||smtpTesting,onClick:async function(){setSmtpTesting(true);setSmtpTestResult(null);try{var r=await api('/profiles/'+profileId+'/smtp/test',{method:'POST'});setSmtpTestResult(r);}catch(e){setSmtpTestResult({ok:false,output:e.message});}setSmtpTesting(false);}},smtpTesting?React.createElement('span',{className:'spinner'}):'Test')),
            smtpTestResult?React.createElement('div',{style:{padding:12,borderRadius:8,background:smtpTestResult.ok?'var(--green-d)':'var(--red-d)',color:smtpTestResult.ok?'var(--green)':'var(--red)',fontSize:12}},
              React.createElement('span',{className:'mono'},smtpTestResult.output)):null,
            !smtpData.hasCredentials?React.createElement('div',{style:{padding:12,textAlign:'center',color:'var(--dim)',fontSize:12}},'Save SMTP credentials first to test connection.'):null),
          React.createElement('div',{className:'card',style:{padding:16}},
            React.createElement('div',{style:{display:'flex',justifyContent:'space-between',alignItems:'center'}},
              React.createElement('div',null,React.createElement('div',{style:{fontSize:14,fontWeight:600}},'Email Enabled'),React.createElement('div',{style:{fontSize:11,color:'var(--dim)'}},'Toggle email sending for this profile')),
              React.createElement('button',{className:'toggle '+(smtpData.smtpEnabled?'on':'off'),onClick:async function(){var newState=!smtpData.smtpEnabled;await api('/profiles/'+profileId+'/smtp/toggle',{method:'POST',body:{enabled:newState}});toast(newState?'SMTP enabled':'SMTP disabled','success');loadTab('smtp');}},React.createElement('div',{className:'toggle-dot'}))))
        ):React.createElement('div',{style:{textAlign:'center',padding:20}},React.createElement('span',{className:'spinner'})));
    }
    if(tab==='auth'){
      var authUrl=authUrlState;var setAuthUrl=setAuthUrlState;

      var discoverAndStart=async function(){setLoading(true);setOauthMsg(null);setOauthStep(1);try{
        var r=await api('/profiles/'+profileId+'/auth/oauth/start',{method:'POST',body:{}});
        if(r.success){setAuthUrl(r.authUrl);setOauthStep(2);}
        else{setOauthMsg({type:'error',text:r.error||'Failed to generate auth URL'});setOauthStep(0);}
      }catch(e){setOauthMsg({type:'error',text:e.message});setOauthStep(0);}setLoading(false);};

      var startWithClientId=async function(cid){if(!cid)return;setLoading(true);setOauthMsg(null);try{
        var r=await api('/profiles/'+profileId+'/auth/oauth/start',{method:'POST',body:{clientId:cid}});
        if(r.success){setAuthUrl(r.authUrl);setOauthStep(2);}
        else{setOauthMsg({type:'error',text:'Failed to start OAuth'});}
      }catch(e){setOauthMsg({type:'error',text:e.message});}setLoading(false);};

      var completeOAuth=async function(){if(!oauthCallbackUrl.trim())return;setLoading(true);setOauthMsg(null);try{
        var r=await api('/profiles/'+profileId+'/auth/oauth/complete',{method:'POST',body:{callbackUrl:oauthCallbackUrl.trim()}});
        if(r.success){setOauthMsg({type:'success',text:r.message});setOauthStep(0);setOauthCallbackUrl('');setAuthUrl('');loadTab('auth');}
        else{setOauthMsg({type:'error',text:r.error||'Failed'});}
      }catch(e){setOauthMsg({type:'error',text:e.message});}setLoading(false);};

      var saveManualTokens=async function(){if(!manualToken.trim())return;setLoading(true);setOauthMsg(null);try{
        var r=await api('/profiles/'+profileId+'/auth/oauth/manual',{method:'POST',body:{accessToken:manualToken.trim(),refreshToken:manualRefresh.trim()||undefined}});
        if(r.success){setOauthMsg({type:'success',text:r.message});setManualMode(false);setManualToken('');setManualRefresh('');loadTab('auth');}
        else{setOauthMsg({type:'error',text:r.error||'Failed'});}
      }catch(e){setOauthMsg({type:'error',text:e.message});}setLoading(false);};

      var cancelOAuth=function(){setOauthStep(0);setAuthUrl('');setOauthCallbackUrl('');api('/profiles/'+profileId+'/auth/oauth/cancel',{method:'POST'}).catch(function(){});};
      var revokeOAuth=async function(){if(!confirm('Disconnect Codex OAuth? Profile will revert to API key.'))return;setLoading(true);try{
        var r=await api('/profiles/'+profileId+'/auth/oauth/revoke',{method:'POST'});setOauthMsg({type:'success',text:r.message});loadTab('auth');
      }catch(e){setOauthMsg({type:'error',text:e.message});}setLoading(false);};

      var toggleAuth=async function(method){if(!confirm('Switch to '+(method==='codex-oauth'?'Codex OAuth (subscription billing)':'API Key (per-token billing)')+'? Gateway will restart.'))return;setLoading(true);try{
        var r=await api('/profiles/'+profileId+'/auth/toggle',{method:'POST',body:{method:method}});
        toast(r.message,'success');loadTab('auth');
      }catch(e){toast(e.message,'error');}setLoading(false);};

      var methodLabel=authData?authData.method==='codex-oauth'?'Codex OAuth (Subscription)':authData.method==='api-key'?'API Key (Per-token)':'Not configured':'...';
      var badgeColor=authData?(authData.method==='codex-oauth'?(authData.oauthValid?'var(--green)':'var(--amber)'):authData.method==='api-key'?'var(--green)':'var(--red)'):'var(--dim)';
      var badgeBg=authData?(authData.method==='codex-oauth'?(authData.oauthValid?'var(--green-d)':'var(--amber-d)'):authData.method==='api-key'?'var(--green-d)':'var(--red-d)'):'var(--border)';
      var hasOAuth=authData&&(authData.oauthValid||authData.method==='codex-oauth');
      var hasApiKey=authData&&authData.hasApiKey;
      return authData?React.createElement('div',null,
        oauthMsg?React.createElement('div',{style:{padding:12,borderRadius:8,marginBottom:16,fontSize:13,background:oauthMsg.type==='success'?'var(--green-d)':'var(--red-d)',color:oauthMsg.type==='success'?'var(--green)':'var(--red)',border:'1px solid '+(oauthMsg.type==='success'?'var(--green)':'var(--red)'),whiteSpace:'pre-wrap'}},oauthMsg.text):null,

        React.createElement('div',{className:'card',style:{padding:20}},
          React.createElement('div',{className:'section-title'},React.createElement('h3',null,IC('shield',14),' Current Authentication'),React.createElement('button',{className:'btn btn-sm btn-default',onClick:function(){loadTab('auth');}},'‚Üª')),
          React.createElement('div',{style:{display:'flex',justifyContent:'space-between',alignItems:'center',padding:14,background:'var(--surface)',borderRadius:8}},
            React.createElement('div',null,
              React.createElement('div',{style:{fontSize:12,color:'var(--dim)'}},'Active Method'),
              React.createElement('div',{style:{fontSize:16,fontWeight:700,marginTop:4}},methodLabel)),
            React.createElement('span',{className:'badge',style:{color:badgeColor,background:badgeBg,fontSize:12}},
              authData.method==='codex-oauth'&&authData.oauthValid?'‚óè Connected':authData.method==='codex-oauth'&&!authData.oauthValid?'‚óè Expired':authData.method==='api-key'?'‚óè Active':'‚óã None')),
          hasOAuth&&hasApiKey?React.createElement('div',{style:{marginTop:14,padding:12,background:'var(--surface)',borderRadius:8,border:'1px solid var(--border)'}},
            React.createElement('div',{style:{fontSize:12,fontWeight:600,marginBottom:8,color:'var(--text)'}},'Switch Auth Method'),
            React.createElement('div',{style:{fontSize:11,color:'var(--dim)',marginBottom:10,lineHeight:1.5}},'Both methods are configured. OAuth uses your ChatGPT subscription (flat rate). API Key uses per-token billing.'),
            React.createElement('div',{style:{display:'flex',gap:8}},
              React.createElement('button',{className:'btn btn-sm '+(authData.method==='codex-oauth'?'btn-primary':'btn-default'),disabled:loading||authData.method==='codex-oauth',onClick:function(){toggleAuth('codex-oauth');}},authData.method==='codex-oauth'?'‚óè OAuth (active)':'Switch to OAuth'),
              React.createElement('button',{className:'btn btn-sm '+(authData.method==='api-key'?'btn-primary':'btn-default'),disabled:loading||authData.method==='api-key',onClick:function(){toggleAuth('api-key');}},authData.method==='api-key'?'‚óè API Key (active)':'Switch to API Key'))):null,
          authData.method==='codex-oauth'?React.createElement('div',{style:{marginTop:12,display:'flex',justifyContent:'space-between',alignItems:'center',flexWrap:'wrap',gap:8}},
            React.createElement('div',{className:'mono',style:{fontSize:11,color:'var(--dim)'}},authData.oauthExpiry?'Expires: '+new Date(authData.oauthExpiry).toLocaleString():'No expiry info'),
            React.createElement('button',{className:'btn btn-sm btn-danger',onClick:revokeOAuth,disabled:loading},IC('x',12),' Remove OAuth Tokens')):null),

        React.createElement('div',{className:'card',style:{padding:20,marginTop:16}},
          React.createElement('div',{className:'section-title'},React.createElement('h3',null,IC('zap',14),' ',authData.method==='codex-oauth'&&authData.oauthValid?'Refresh OAuth':'Connect Codex OAuth')),
          React.createElement('div',{style:{fontSize:13,color:'var(--text)',marginBottom:16,lineHeight:1.6}},'Connect your OpenAI ChatGPT / Codex subscription. Three steps ‚Äî no SSH needed.'),

          oauthStep===0&&!manualMode?React.createElement('div',null,
            React.createElement('button',{className:'btn btn-primary',onClick:discoverAndStart,disabled:loading,style:{marginBottom:12}},IC('zap',14),' ',loading?'Generating...':'Connect OpenAI Account'),
            React.createElement('div',{style:{display:'flex',gap:8,flexWrap:'wrap'}},
              React.createElement('button',{className:'btn btn-sm btn-default',onClick:function(){setManualMode(true);}},'Paste Token Manually'),
              React.createElement('details',{style:{flex:1}},
                React.createElement('summary',{style:{fontSize:11,color:'var(--dim)',cursor:'pointer'}},'Use custom Client ID'),
                React.createElement('div',{style:{display:'flex',gap:6,marginTop:6}},
                  React.createElement('input',{className:'input mono',placeholder:'Client ID from OpenClaw source...',value:customClientId,onChange:function(e){setCustomClientId(e.target.value);},style:{fontSize:11,flex:1}}),
                  React.createElement('button',{className:'btn btn-xs btn-primary',disabled:!customClientId.trim()||loading,onClick:function(){startWithClientId(customClientId.trim());}},'Go'))))):null,

          oauthStep===1?React.createElement('div',{style:{display:'flex',alignItems:'center',gap:10,padding:16}},
            React.createElement('span',{className:'spinner'}),
            React.createElement('div',null,React.createElement('div',{style:{fontSize:14,fontWeight:600}},'Generating auth URL...'),
              React.createElement('div',{style:{fontSize:12,color:'var(--dim)',marginTop:4}},'This should only take a moment'))):null,

          oauthStep===2&&authUrl?React.createElement('div',null,
            React.createElement('div',{style:{padding:16,background:'var(--surface)',borderRadius:10,border:'1px solid var(--border)',marginBottom:16}},
              React.createElement('div',{style:{display:'flex',alignItems:'center',gap:8,marginBottom:12}},
                React.createElement('div',{style:{width:28,height:28,borderRadius:'50%',background:'var(--accent)',color:'#fff',display:'flex',alignItems:'center',justifyContent:'center',fontSize:14,fontWeight:700}},'1'),
                React.createElement('div',{style:{fontSize:14,fontWeight:600}},'Log in to your OpenAI account')),
              React.createElement('div',{style:{padding:12,background:'var(--amber-d)',borderRadius:8,border:'1px solid var(--amber)',marginBottom:12}},
                React.createElement('div',{style:{fontSize:12,fontWeight:700,color:'var(--amber)',marginBottom:4}},'‚ö† Read this first!'),
                React.createElement('div',{style:{fontSize:12,color:'var(--text)',lineHeight:1.6}},'After you log in and approve, your browser will show an error page saying "can\'t connect to server" or "localhost refused." That\'s completely normal! Don\'t close that page ‚Äî you\'ll need to copy the URL from it in the next step.')),
              React.createElement('a',{href:authUrl,target:'_blank',rel:'noopener noreferrer',className:'btn btn-primary',style:{display:'inline-flex',alignItems:'center',gap:6}},IC('link',14),' Open OpenAI Login'),
              React.createElement('div',{style:{marginTop:8}},
                React.createElement('button',{className:'btn btn-xs btn-default',onClick:function(){navigator.clipboard.writeText(authUrl);toast('URL copied!','success');}},IC('clipboard',12),' Copy URL Instead'))),

            React.createElement('div',{style:{padding:16,background:'var(--surface)',borderRadius:10,border:'1px solid var(--border)',marginBottom:16}},
              React.createElement('div',{style:{display:'flex',alignItems:'center',gap:8,marginBottom:12}},
                React.createElement('div',{style:{width:28,height:28,borderRadius:'50%',background:'var(--accent)',color:'#fff',display:'flex',alignItems:'center',justifyContent:'center',fontSize:14,fontWeight:700}},'2'),
                React.createElement('div',{style:{fontSize:14,fontWeight:600}},'Copy the error page URL and paste it here')),
              React.createElement('div',{style:{fontSize:12,color:'var(--dim)',marginBottom:6,lineHeight:1.5}},'On the error page, tap the address bar and copy the full URL. It looks like:'),
              React.createElement('div',{className:'mono',style:{fontSize:11,color:'var(--accent)',background:'var(--bg)',padding:8,borderRadius:6,marginBottom:10,wordBreak:'break-all'}},'http://localhost:1455/auth/callback?code=abc123&state=xyz...'),
              React.createElement('input',{type:'text',value:oauthCallbackUrl,onChange:function(e){setOauthCallbackUrl(e.target.value);},onKeyDown:function(e){if(e.key==='Enter')completeOAuth();},placeholder:'Paste the full URL from the error page here...',className:'mono',style:{width:'100%',padding:'10px 12px',background:'var(--bg)',border:'1px solid var(--border)',borderRadius:8,color:'var(--text)',fontSize:12,boxSizing:'border-box'}})),

            React.createElement('div',{style:{display:'flex',gap:8,marginTop:4}},
              React.createElement('button',{className:'btn btn-primary',onClick:completeOAuth,disabled:loading||!oauthCallbackUrl.trim()},IC('check',14),' ',loading?'Connecting...':'Complete Connection'),
              React.createElement('button',{className:'btn btn-sm btn-default',onClick:cancelOAuth},'Cancel'))):null,

          manualMode?React.createElement('div',{style:{padding:16,background:'var(--surface)',borderRadius:10,border:'1px solid var(--border)'}},
            React.createElement('div',{style:{fontSize:14,fontWeight:600,marginBottom:10}},'Manual Token Entry'),
            React.createElement('div',{style:{fontSize:12,color:'var(--dim)',marginBottom:12,lineHeight:1.5}},'If you have tokens from running the CLI via SSH or another source, paste them here directly.'),
            React.createElement('div',{style:{marginBottom:8}},React.createElement('div',{style:{fontSize:11,color:'var(--dim)',marginBottom:4}},'Access Token *'),React.createElement('input',{className:'input mono',type:'password',placeholder:'eyJ...',value:manualToken,onChange:function(e){setManualToken(e.target.value);},style:{fontSize:12}})),
            React.createElement('div',{style:{marginBottom:12}},React.createElement('div',{style:{fontSize:11,color:'var(--dim)',marginBottom:4}},'Refresh Token (optional)'),React.createElement('input',{className:'input mono',type:'password',placeholder:'Optional ‚Äî for auto-renewal',value:manualRefresh,onChange:function(e){setManualRefresh(e.target.value);},style:{fontSize:12}})),
            React.createElement('div',{style:{display:'flex',gap:8}},
              React.createElement('button',{className:'btn btn-sm btn-primary',disabled:loading||!manualToken.trim(),onClick:saveManualTokens},loading?'Saving...':'Save Tokens'),
              React.createElement('button',{className:'btn btn-sm btn-default',onClick:function(){setManualMode(false);}},'Cancel'))):null),

        authData&&authData.method==='codex-oauth'&&authData.oauthValid?React.createElement('div',{className:'card',style:{padding:20,marginTop:16}},
          React.createElement('div',{className:'section-title'},React.createElement('h3',null,IC('share2',14),' Share OAuth to Other Profiles')),
          React.createElement('div',{style:{fontSize:12,color:'var(--dim)',marginBottom:14,lineHeight:1.6}},'Copy this profile\'s Codex OAuth tokens to other profiles so they all use the same subscription.'),
          React.createElement('div',{style:{display:'flex',gap:8,flexWrap:'wrap'}},
            profiles.filter(function(pr){return pr.id!==profileId;}).map(function(pr){
              return React.createElement('button',{key:pr.id,className:'btn btn-sm btn-default',onClick:async function(){
                if(!confirm('Share OAuth tokens to "'+pr.id+'"?'))return;
                setLoading(true);try{
                  var r=await api('/profiles/'+profileId+'/auth/oauth/share',{method:'POST',body:{targets:[pr.id]}});
                  if(r.success)toast('OAuth shared to '+pr.id,'success');
                }catch(e){toast(e.message,'error');}setLoading(false);
              }},IC('arrowRight',12),' ',pr.name||pr.id);}),
            profiles.filter(function(pr){return pr.id!==profileId;}).length>1?React.createElement('button',{className:'btn btn-sm btn-primary',onClick:async function(){
              var targets=profiles.filter(function(pr){return pr.id!==profileId;}).map(function(pr){return pr.id;});
              if(!confirm('Share to ALL '+targets.length+' other profiles?'))return;
              setLoading(true);try{
                var r=await api('/profiles/'+profileId+'/auth/oauth/share',{method:'POST',body:{targets:targets}});
                if(r.success)toast('OAuth shared to all profiles','success');
              }catch(e){toast(e.message,'error');}setLoading(false);
            }},IC('share2',12),' Share to All'):null)):null,
        React.createElement('div',{style:{marginTop:16,padding:16,border:'1px solid var(--border)',borderRadius:10,opacity:0.7}},
          React.createElement('div',{style:{fontSize:12,fontWeight:600,color:'var(--dim)',marginBottom:8}},IC('info',12),' OAuth vs API Key ‚Äî What\'s the difference?'),
          React.createElement('div',{style:{fontSize:12,color:'var(--dim)',lineHeight:1.7}},
            React.createElement('div',{style:{marginBottom:6}},React.createElement('b',null,'Codex OAuth (Subscription)'),' ‚Äî Uses your ChatGPT Plus/Pro/Team subscription. Flat monthly rate, no per-token charges. Usage is rate-limited based on your plan tier. Best for most users.'),
            React.createElement('div',null,React.createElement('b',null,'API Key (Per-token)'),' ‚Äî Uses your OpenAI Platform API credits. Pay-as-you-go billing based on tokens used. No rate limits but costs can add up. Best for heavy/automated use.'),
            React.createElement('div',{style:{marginTop:6}},'Both methods can coexist. Use the toggle above to switch between them anytime. The permission screen during OAuth is just OpenAI asking which workspace to use ‚Äî it does NOT charge your API credits.')))
      ):React.createElement('div',{style:{textAlign:'center',padding:20}},React.createElement('span',{className:'spinner'}));
    }
    if(tab==='logs'){
      return React.createElement('div',null,
        React.createElement('div',{style:{display:'flex',justifyContent:'flex-end',marginBottom:8}},React.createElement('button',{className:'btn btn-sm btn-default',onClick:function(){loadTab('logs');}},'‚Üª')),
        React.createElement('div',{className:'log-area'},logs||'No logs'));
    }
    return null;
  }

  return React.createElement('div',null,
    copyModal?React.createElement(CopySkillModal,{skill:copyModal,profileId:profileId,profiles:profiles,onClose:function(){setCopyModal(null);},toast:toast}):null,
    memModal?React.createElement(MemoryFileModal,{profileId:profileId,file:memModal,onClose:function(){setMemModal(null);if(tab==='history')loadTab('history');},toast:toast}):null,
    resetModal?React.createElement(ResetProfileModal,{profileId:profileId,onClose:function(){setResetModal(false);},toast:toast}):null,
    cronAddModal?React.createElement(CronAddModal,{profileId:profileId,onClose:function(){setCronAddModal(false);},toast:toast,onAdded:function(){loadTab('cron');}}):null,
    React.createElement('div',{style:{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:16,flexWrap:'wrap',gap:8}},
      React.createElement('div',null,
        React.createElement('button',{className:'btn btn-ghost',onClick:function(){onNav('dashboard');},style:{marginBottom:4,fontSize:12,color:'var(--accent)'}},'‚Üê Back'),
        React.createElement('h2',{style:{fontSize:20,fontWeight:700}},p.name||p.id,
          React.createElement('span',{className:'badge',style:{marginLeft:10,fontSize:11,color:p.status==='running'?'var(--green)':'var(--red)',background:p.status==='running'?'var(--green-d)':'var(--red-d)'}},p.status))),
      React.createElement('div',{style:{display:'flex',gap:6,flexWrap:'wrap'}},
        React.createElement('button',{className:'btn btn-sm btn-default',onClick:function(){setResetModal(true);}},'üîÑ Reset'),
        React.createElement('a',{href:dlUrl('/profiles/'+profileId+'/backup'),className:'btn btn-sm btn-default',style:{textDecoration:'none'}},'‚¨á'),
        React.createElement('button',{className:'btn btn-sm btn-default',onClick:function(){doAction('restart');}},'‚Üª Restart'),
        p.status==='running'?React.createElement('button',{className:'btn btn-sm btn-danger',onClick:function(){doAction('stop');}},'‚èπ Stop'):React.createElement('button',{className:'btn btn-sm btn-green',onClick:function(){doAction('start');}},'‚ñ∂ Start'),
        profileId!=='original'?React.createElement('button',{className:'btn btn-sm btn-danger',onClick:async function(){if(!confirm('Delete "'+profileId+'"?'))return;await api('/profiles/'+profileId,{method:'DELETE'});toast('Removed','success');onNav('dashboard');onNav('refresh');}},'üóë'):null)),
    React.createElement('div',{className:'tab-bar'},tabs.map(function(t){return React.createElement('button',{key:t.id,className:'tab-btn '+(tab===t.id?'active':''),onClick:function(){setTab(t.id);}},t.ic?IC(t.ic,13):null,' ',t.l);})),
    loading?React.createElement('div',{style:{textAlign:'center',padding:20}},React.createElement('span',{className:'spinner'})):null,
    renderTabContent()
  );
}

function PanelUpdates({toast,profileIds}){
  var[cli,setCli]=useState(null);var[wsData,setWsData]=useState({});var[loading,setLoading]=useState('');var[updateOutput,setUpdateOutput]=useState(null);
  var checkCli=async function(){setLoading('cli');try{setCli(await api('/updates/cli'));}catch(e){toast('Failed to check: '+e.message,'error');}setLoading('');};
  useEffect(function(){checkCli();},[]);
  return React.createElement('div',null,
    React.createElement('div',{className:'section-title'},React.createElement('h3',null,'üîÑ Updates')),
    React.createElement('div',{className:'card',style:{padding:14,marginBottom:16}},
      React.createElement('div',{style:{display:'flex',justifyContent:'space-between',alignItems:'center'}},
        React.createElement('div',null,React.createElement('b',null,'OpenClaw CLI'),
          cli?React.createElement('div',{className:'mono',style:{fontSize:12,color:'var(--dim)',marginTop:2}},'Current: '+cli.current+' ¬∑ Latest: ',React.createElement('span',{style:{color:cli.updateAvailable?'var(--amber)':'var(--green)'}},cli.latest)):null),
        React.createElement('div',{style:{display:'flex',gap:6}},
          React.createElement('button',{className:'btn btn-sm btn-default',onClick:checkCli,disabled:!!loading},loading==='cli'?React.createElement('span',{className:'spinner'}):'Check'),
          cli&&cli.updateAvailable?React.createElement('button',{className:'btn btn-sm btn-primary',disabled:loading==='upgrade',onClick:async function(){setLoading('upgrade');setUpdateOutput(null);try{
            var r=await api('/updates/cli/upgrade',{method:'POST'});
            if(r.ok){toast('Updated to '+r.version,'success');setUpdateOutput('Success: v'+r.version);}
            else{toast('Update may have failed','error');setUpdateOutput(r.error||r.output||'Unknown error');}
            checkCli();
          }catch(e){toast('Update failed: '+e.message,'error');setUpdateOutput('Error: '+e.message);}setLoading('');
          }},loading==='upgrade'?React.createElement('span',{className:'spinner'}):'Update'):null)),
      updateOutput?React.createElement('div',{className:'mono',style:{fontSize:11,color:'var(--dim)',marginTop:10,padding:10,background:'var(--bg)',borderRadius:6,whiteSpace:'pre-wrap',maxHeight:100,overflow:'auto'}},updateOutput):null,
      loading==='upgrade'?React.createElement('div',{style:{marginTop:10,display:'flex',alignItems:'center',gap:8,color:'var(--amber)',fontSize:12}},React.createElement('span',{className:'spinner'}),' Installing openclaw@latest... this may take 1-2 minutes'):null),
    React.createElement('div',{className:'section-title'},React.createElement('h3',null,'Workspaces'),React.createElement('span',{className:'mono',style:{fontSize:10,color:'var(--dim)'}},'Click Check individually')),
    profileIds.map(function(id){return React.createElement('div',{key:id,className:'card',style:{padding:14,marginBottom:6}},
      React.createElement('div',{style:{display:'flex',justifyContent:'space-between',alignItems:'center'}},
        React.createElement('div',null,React.createElement('b',null,id),
          wsData[id]&&wsData[id].isGit?React.createElement('span',{className:'badge',style:{marginLeft:6,color:'var(--purple)',background:'var(--purple-d)',fontSize:10}},'git:'+wsData[id].branch):null,
          wsData[id]&&wsData[id].dirty?React.createElement('span',{className:'badge',style:{marginLeft:4,color:'var(--amber)',background:'var(--amber-d)',fontSize:10}},'modified'):null,
          wsData[id]?React.createElement('div',{className:'mono',style:{fontSize:11,color:'var(--dim)',marginTop:4}},wsData[id].lastCommit,wsData[id].behindBy>0?React.createElement('span',{style:{color:'var(--amber)'}},' ¬∑ '+wsData[id].behindBy+' behind'):null):null),
        React.createElement('div',{style:{display:'flex',gap:6}},
          React.createElement('button',{className:'btn btn-sm btn-default',onClick:async function(){setLoading(id);var d={};d[id]=await api('/updates/workspace/'+id);setWsData(Object.assign({},wsData,d));setLoading('');},disabled:loading===id},loading===id?React.createElement('span',{className:'spinner'}):'Check'),
          wsData[id]&&wsData[id].isGit?React.createElement('button',{className:'btn btn-sm btn-default',onClick:async function(){await api('/updates/workspace/'+id+'/pull',{method:'POST'});toast(id+' pulled','success');}},'Pull'):null)));}));
}

function PanelSecurity({toast}){
  var[audit,setAudit]=useState(null);var[loading,setLoading]=useState(false);var[expanded,setExpanded]=useState(null);var[fixing,setFixing]=useState(null);
  var scan=async function(){setLoading(true);setAudit(await api('/security/audit'));setLoading(false);};
  useEffect(function(){scan();},[]);
  if(!audit)return React.createElement('div',{style:{textAlign:'center',padding:40}},React.createElement('span',{className:'spinner'}));
  var sc={pass:'‚úì',warn:'‚ö†',fail:'‚úï',info:'‚Ñπ'};var clr={pass:'var(--green)',warn:'var(--amber)',fail:'var(--red)',info:'var(--accent)'};var bg={pass:'var(--green-d)',warn:'var(--amber-d)',fail:'var(--red-d)',info:'var(--accent-d)'};
  var categories=[];audit.checks.forEach(function(c){if(categories.indexOf(c.category)===-1)categories.push(c.category);});
  var doFix=async function(fixId,checkName){
    setFixing(fixId);
    try{var r=await api('/security/fix',{method:'POST',body:{fixId:fixId}});toast(r.message||'Fix applied','success');scan();}
    catch(e){toast(e.message||'Fix failed','error');}
    setFixing(null);
  };
  return React.createElement('div',null,
    React.createElement('div',{className:'section-title'},React.createElement('h3',null,'üõ° Security Audit'),React.createElement('button',{className:'btn btn-sm btn-default',onClick:scan,disabled:loading},loading?React.createElement('span',{className:'spinner'}):'‚Üª Re-scan')),
    React.createElement('div',{style:{display:'flex',gap:20,alignItems:'center',marginBottom:24,flexWrap:'wrap'}},
      React.createElement('div',{className:'score-ring',style:{border:'4px solid '+(audit.score>=80?'var(--green)':audit.score>=50?'var(--amber)':'var(--red)'),color:audit.score>=80?'var(--green)':audit.score>=50?'var(--amber)':'var(--red)'}},audit.score),
      React.createElement('div',{style:{display:'flex',gap:12}},
        [['pass','Passed'],['warn','Warn'],['fail','Fail'],['info','Info']].map(function(x){return React.createElement('div',{key:x[0],style:{textAlign:'center'}},React.createElement('div',{className:'mono',style:{fontSize:18,fontWeight:700,color:clr[x[0]]}},audit.summary[x[0]]),React.createElement('div',{style:{fontSize:10,color:'var(--dim)',textTransform:'uppercase'}},x[1]));}))),
    categories.map(function(cat){return React.createElement('div',{key:cat,style:{marginBottom:16}},
      React.createElement('div',{className:'mono',style:{fontSize:11,fontWeight:700,color:'var(--muted)',textTransform:'uppercase',marginBottom:8}},cat),
      React.createElement('div',{className:'card',style:{padding:0,overflow:'hidden'}},
        audit.checks.filter(function(c){return c.category===cat;}).map(function(c,i){
          var isExp=expanded===cat+'-'+i;var canFix=c.status==='warn'||c.status==='fail';
          return React.createElement('div',{key:i,style:{borderBottom:'1px solid var(--border)'}},
            React.createElement('div',{style:{display:'flex',gap:10,padding:'12px 14px',alignItems:'flex-start',cursor:canFix?'pointer':'default'},onClick:function(){if(canFix)setExpanded(isExp?null:cat+'-'+i);}},
              React.createElement('div',{style:{width:24,height:24,borderRadius:'50%',display:'flex',alignItems:'center',justifyContent:'center',fontSize:12,flexShrink:0,background:bg[c.status],color:clr[c.status]}},sc[c.status]),
              React.createElement('div',{style:{flex:1}},
                React.createElement('div',{style:{display:'flex',alignItems:'center',gap:6}},
                  React.createElement('b',{style:{fontSize:13}},c.name),
                  React.createElement('span',{className:'badge',style:{color:clr[c.status],background:bg[c.status],fontSize:9}},c.severity)),
                React.createElement('div',{className:'mono',style:{fontSize:11,color:'var(--dim)',marginTop:4}},c.detail)),
              canFix?React.createElement('span',{style:{color:'var(--dim)',fontSize:11,transition:'transform .2s',transform:isExp?'rotate(90deg)':'rotate(0)',flexShrink:0}},'‚ñ∂'):null),
            isExp?React.createElement('div',{style:{padding:'0 14px 14px 48px'}},
              React.createElement('div',{style:{padding:12,background:'var(--bg)',borderRadius:8,border:'1px solid var(--border)'}},
                React.createElement('div',{style:{fontSize:12,fontWeight:600,marginBottom:6,color:clr[c.status]}},'What this means'),
                React.createElement('div',{style:{fontSize:12,color:'var(--dim)',lineHeight:1.6,marginBottom:10}},c.explanation||'This check detected a potential security concern. Review the details above and consider applying the recommended fix.'),
                c.fixId?React.createElement('div',{style:{display:'flex',gap:8,alignItems:'center'}},
                  React.createElement('button',{className:'btn btn-sm btn-primary',disabled:fixing===c.fixId,onClick:function(e){e.stopPropagation();doFix(c.fixId,c.name);}},fixing===c.fixId?React.createElement('span',{className:'spinner'}):'üîß Auto-Fix'),
                  React.createElement('span',{style:{fontSize:11,color:'var(--dim)'}},c.fixDesc||'')):
                c.manualFix?React.createElement('div',null,
                  React.createElement('div',{style:{fontSize:11,fontWeight:600,color:'var(--accent)',marginBottom:4}},'Manual fix:'),
                  React.createElement('pre',{className:'mono',style:{fontSize:11,padding:8,background:'var(--surface)',borderRadius:6,color:'var(--text)',whiteSpace:'pre-wrap'}},c.manualFix)):
                React.createElement('div',{style:{fontSize:11,color:'var(--dim)',fontStyle:'italic'}},'No auto-fix available. Review your server configuration manually.'))):null);})
      ));}));
}

function PanelAntfarm({toast}){
  var[s,setS]=useState(null);var[runs,setRuns]=useState('');var[loading,setLoading]=useState(false);
  var[runWf,setRunWf]=useState('');var[runTask,setRunTask]=useState('');var[running,setRunning]=useState(false);
  var[sq,setSq]=useState('');var[sr,setSr]=useState('');
  var[verInfo,setVerInfo]=useState(null);var[updating,setUpdating]=useState(false);
  var[rollbackVer,setRollbackVer]=useState('');
  var load=async function(){setLoading(true);var st=await api('/antfarm/status');setS(st);if(st.installed){var r=await api('/antfarm/runs');setRuns(r.output||'');}setLoading(false);};
  var checkVersion=async function(){var v=await api('/antfarm/version');setVerInfo(v);};
  useEffect(function(){load();checkVersion();},[]);
  if(!s)return React.createElement('div',{style:{textAlign:'center',padding:40}},React.createElement('span',{className:'spinner'}));
  if(!s.installed)return React.createElement('div',null,React.createElement('div',{className:'section-title'},React.createElement('h3',null,'Antfarm')),React.createElement('div',{className:'card',style:{padding:30,textAlign:'center'}},React.createElement('div',{style:{fontSize:32,marginBottom:8}},IC('grid',32)),React.createElement('div',{style:{color:'var(--dim)',marginBottom:12}},'Not installed'),React.createElement('div',{style:{fontSize:12,color:'var(--muted)',marginBottom:16}},'Install with: npm install -g antfarm')));
  return React.createElement('div',null,
    React.createElement('div',{className:'section-title'},React.createElement('h3',null,'Antfarm'),React.createElement('button',{className:'btn btn-sm btn-default',onClick:load,disabled:loading},loading?React.createElement('span',{className:'spinner'}):'‚Üª')),
    React.createElement('div',{style:{display:'grid',gridTemplateColumns:'repeat(3,1fr)',gap:12,marginBottom:20}},
      React.createElement(StatCard,{value:'‚úì',label:'Installed',color:'var(--green)'}),
      React.createElement(StatCard,{value:s.workflows.length,label:'Workflows',color:'var(--accent)'}),
      React.createElement(StatCard,{value:s.dashboardRunning?'‚óè':'‚óã',label:'Dashboard',color:s.dashboardRunning?'var(--green)':'var(--dim)'})),
    verInfo?React.createElement('div',{className:'card',style:{padding:16,marginBottom:16,borderColor:verInfo.updateAvailable?'rgba(251,191,36,.2)':'var(--border)'}},
      React.createElement('div',{style:{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:8}},
        React.createElement('div',{style:{fontSize:14,fontWeight:600}},'Version & Updates'),
        React.createElement('div',{style:{display:'flex',gap:6}},
          React.createElement('button',{className:'btn btn-xs btn-default',onClick:checkVersion},'Check'),
          verInfo.updateAvailable?React.createElement('button',{className:'btn btn-xs btn-primary',disabled:updating,onClick:async function(){setUpdating(true);var r=await api('/antfarm/update',{method:'POST'});toast(r.ok?'Updated to '+r.version:'Update failed','success');checkVersion();setUpdating(false);}},updating?React.createElement('span',{className:'spinner'}):'Update'):null)),
      React.createElement('div',{className:'mono',style:{fontSize:12,color:'var(--dim)'}},
        'Current: ',React.createElement('span',{style:{color:'var(--accent)'}},verInfo.current||'unknown'),
        verInfo.latest?' ¬∑ Latest: ':null,verInfo.latest?React.createElement('span',{style:{color:verInfo.updateAvailable?'var(--amber)':'var(--green)'}},verInfo.latest):null),
      React.createElement('div',{style:{display:'flex',gap:8,marginTop:10,alignItems:'center'}},
        React.createElement('input',{className:'input mono',value:rollbackVer,onChange:function(e){setRollbackVer(e.target.value);},placeholder:'e.g. 1.2.0',style:{flex:1,maxWidth:200}}),
        React.createElement('button',{className:'btn btn-xs btn-default',disabled:!rollbackVer||updating,onClick:async function(){if(!confirm('Rollback to v'+rollbackVer+'?'))return;setUpdating(true);var r=await api('/antfarm/rollback',{method:'POST',body:{version:rollbackVer}});toast(r.ok?'Rolled back to '+r.version:'Rollback failed',r.ok?'success':'error');checkVersion();setUpdating(false);setRollbackVer('');}},'Rollback'),
        React.createElement('span',{style:{fontSize:10,color:'var(--dim)'}},'Enter version to rollback'))):null,
    React.createElement('div',{className:'card',style:{padding:16,marginBottom:16}},
      React.createElement('div',{style:{fontSize:14,fontWeight:600,marginBottom:12}},'Run Workflow'),
      React.createElement('div',{style:{display:'flex',gap:8,marginBottom:10,flexWrap:'wrap'}},s.workflows.map(function(w){return React.createElement('button',{key:w,className:'btn btn-sm '+(runWf===w?'btn-primary':'btn-default'),onClick:function(){setRunWf(w);}},w);})),
      runWf?React.createElement('div',null,
        React.createElement('textarea',{className:'input mono',value:runTask,onChange:function(e){setRunTask(e.target.value);},placeholder:'Task for '+runWf+'...',style:{minHeight:80,resize:'vertical',marginBottom:8}}),
        React.createElement('button',{className:'btn btn-sm btn-primary',onClick:async function(){setRunning(true);await api('/antfarm/run',{method:'POST',body:{workflow:runWf,task:runTask}});toast('Started','success');setRunTask('');load();setRunning(false);},disabled:running||!runTask},running?React.createElement('span',{className:'spinner'}):null,' Run')):null),
    React.createElement('div',{className:'card',style:{padding:16,marginBottom:16}},
      React.createElement('div',{style:{fontSize:14,fontWeight:600,marginBottom:8}},'Check Status'),
      React.createElement('div',{style:{display:'flex',gap:8}},
        React.createElement('input',{className:'input',value:sq,onChange:function(e){setSq(e.target.value);},placeholder:'Run ID...',style:{flex:1}}),
        React.createElement('button',{className:'btn btn-sm btn-primary',onClick:async function(){var r=await api('/antfarm/runs/'+encodeURIComponent(sq)+'/status');setSr(r.output||'No results');},disabled:!sq},'Check')),
      sr?React.createElement('div',{className:'log-area',style:{marginTop:8,maxHeight:200}},sr):null),
    runs?React.createElement('div',{className:'card',style:{padding:16,marginBottom:16}},React.createElement('div',{style:{fontSize:14,fontWeight:600,marginBottom:8}},'Recent Runs'),React.createElement('div',{className:'log-area',style:{maxHeight:300}},runs)):null,
    React.createElement('div',{className:'card',style:{padding:14}},
      React.createElement('div',{style:{display:'flex',justifyContent:'space-between',alignItems:'center'}},
        React.createElement('div',null,React.createElement('b',null,'Antfarm Dashboard'),React.createElement('div',{className:'mono',style:{fontSize:11,color:'var(--dim)'}},':3333 ¬∑ '+(s.dashboardRunning?'Running':'Stopped'))),
        React.createElement('div',{style:{display:'flex',gap:6}},
          React.createElement('button',{className:'btn btn-sm btn-default',onClick:async function(){await api('/antfarm/dashboard/start',{method:'POST'});toast('Started','success');load();}},'Start'),
          React.createElement('button',{className:'btn btn-sm btn-danger',onClick:async function(){await api('/antfarm/dashboard/stop',{method:'POST'});toast('Stopped','success');load();}},'Stop')))));
}

function PanelNews({toast}){
  var[news,setNews]=useState(null);var[loading,setLoading]=useState(false);var[fetching,setFetching]=useState(false);
  var[view,setView]=useState('all');var[bookmarks,setBookmarks]=useState([]);var[qualityList,setQualityList]=useState([]);
  var[showSources,setShowSources]=useState(false);var[sources,setSources]=useState({});var[newsSearch,setNewsSearch]=useState('');
  var load=function(){setLoading(true);api('/news').then(function(d){setNews(d);if(d.prefs)setSources(d.prefs.sources||{});setLoading(false);}).catch(function(){setLoading(false);});};
  var loadBookmarks=function(){api('/news/bookmarks').then(function(d){setBookmarks(d.bookmarks||[]);}).catch(function(){});};
  var loadQuality=function(){api('/news/quality').then(function(d){setQualityList(d.articles||[]);}).catch(function(){});};
  useEffect(function(){load();loadBookmarks();loadQuality();},[]);
  var fetchNews=async function(random){setFetching(true);try{var d=await api('/news/fetch',{method:'POST',body:{random:!!random}});setNews(d);toast('Fetched '+d.fetchCount+' articles'+(random?' (random)':''),'success');load();}catch(e){toast('Fetch failed','error');}setFetching(false);};
  var feedback=async function(url,action,e){if(e)e.stopPropagation();try{await api('/news/feedback',{method:'POST',body:{url:url,action:action}});load();loadBookmarks();loadQuality();toast(action==='delete'?'Removed':action,'success');}catch(er){toast('Failed','error');}};
  var saveSources=async function(s){setSources(s);try{await api('/news/sources',{method:'PUT',body:{sources:s}});toast('Sources updated','success');}catch(e){toast('Failed','error');}};
  function timeAgo(d){if(!d)return'';var s=Math.floor((Date.now()-new Date(d))/1000);if(s<60)return s+'s';if(s<3600)return Math.floor(s/60)+'m';if(s<86400)return Math.floor(s/3600)+'h';return Math.floor(s/86400)+'d';}
  var srcLabels={hn_ai:'HN: AI/ML',hn_openclaw:'HN: OpenClaw',hn_agents:'HN: AI Agents',hn_llm:'HN: LLM Dev',github:'GitHub Trending',reddit_ai:'Reddit: AI',arxiv:'arXiv Papers',techcrunch:'HN: Startups'};
  function renderArticle(a,i,showFeedback){
    var srcLink=a.hnLink?{href:a.hnLink,label:'HN'}:a.redditLink?{href:a.redditLink,label:'Reddit'}:a.isRepo?{href:a.url,label:'GH'}:a.isPaper?{href:a.url,label:'arXiv'}:null;
    return React.createElement('div',{key:a.url||i,className:'card',style:{padding:14,borderLeft:'3px solid '+(a.isRepo?'var(--purple)':a.isPaper?'var(--blue)':(a.source||'').includes('OpenClaw')?'var(--green)':(a.source||'').includes('Reddit')?'var(--amber)':'var(--accent)'),marginBottom:6,cursor:'pointer',opacity:a.isUseless?.5:1},onClick:function(){window.open(a.url,'_blank');}},
      React.createElement('div',{style:{flex:1,minWidth:0}},
        React.createElement('div',{style:{fontSize:13,fontWeight:600,lineHeight:1.4,marginBottom:4}},a.title),
        React.createElement('div',{style:{display:'flex',gap:6,alignItems:'center',flexWrap:'wrap'}},
          React.createElement('span',{className:'badge',style:{fontSize:9,color:a.isRepo?'var(--purple)':a.isPaper?'var(--blue)':'var(--accent)',background:a.isRepo?'var(--purple-d)':a.isPaper?'var(--blue-d)':'var(--accent-d)'}},a.source),
          a.author?React.createElement('span',{className:'mono',style:{fontSize:10,color:'var(--dim)'}},a.author):null,
          a.points?React.createElement('span',{className:'mono',style:{fontSize:10,color:'var(--amber)'}},a.points+(a.isRepo?' ‚òÖ':' pts')):null,
          a.comments?React.createElement('span',{className:'mono',style:{fontSize:10,color:'var(--dim)'}},a.comments+' cmt'):null,
          a.date?React.createElement('span',{className:'mono',style:{fontSize:10,color:'var(--dim)'}},timeAgo(a.date)):null,
          a.boosted?React.createElement('span',{className:'badge',style:{fontSize:8,color:'var(--amber)',background:'var(--amber-d)'}},'‚òÖ Boosted'):null)),
      React.createElement('div',{style:{display:'flex',justifyContent:'space-between',alignItems:'center',marginTop:8},onClick:function(e){e.stopPropagation();}},
        showFeedback!==false?React.createElement('div',{style:{display:'flex',gap:2,alignItems:'center'}},
          React.createElement('button',{className:'btn btn-ghost',style:{color:a.isQuality?'var(--green)':'var(--dim)',padding:'2px 4px'},title:'Quality',onClick:function(e){feedback(a.url,a.isQuality?'unquality':'quality',e);}},IC('thumbsUp',14)),
          React.createElement('button',{className:'btn btn-ghost',style:{color:a.isUseless?'var(--red)':'var(--dim)',padding:'2px 4px'},title:'Useless',onClick:function(e){feedback(a.url,a.isUseless?'unuseless':'useless',e);}},IC('thumbsDown',14)),
          React.createElement('button',{className:'btn btn-ghost',style:{color:a.isBookmarked?'var(--amber)':'var(--dim)',padding:'2px 4px'},title:'Bookmark',onClick:function(e){feedback(a.url,a.isBookmarked?'unbookmark':'bookmark',e);}},IC('bookmark',14)),
          navigator.share?React.createElement('button',{className:'btn btn-ghost',style:{color:'var(--dim)',padding:'2px 4px'},title:'Share',onClick:function(e){e.stopPropagation();navigator.share({title:a.title,url:a.url}).catch(function(){});}},IC('share',14)):null,
          React.createElement('button',{className:'btn btn-ghost',style:{color:'var(--dim)',padding:'2px 4px'},title:'Remove',onClick:function(e){feedback(a.url,'delete',e);}},IC('trash2',14))):React.createElement('div',null),
        srcLink?React.createElement('a',{href:srcLink.href,target:'_blank',onClick:function(e){e.stopPropagation();},className:'btn btn-xs btn-default',style:{textDecoration:'none'}},srcLink.label):null));
  }
  return React.createElement('div',null,
    React.createElement('div',{className:'news-sticky'},
    React.createElement('div',{className:'section-title'},
      React.createElement('h3',null,'AI & OpenClaw News'),
      React.createElement('div',{style:{display:'flex',gap:6,alignItems:'center',flexWrap:'wrap'}},
        news&&news.lastFetched?React.createElement('span',{className:'mono',style:{fontSize:10,color:'var(--dim)'}},timeAgo(news.lastFetched)+' ago'):null,
        React.createElement('button',{className:'btn btn-sm btn-primary',onClick:function(){fetchNews(false);},disabled:fetching},fetching?React.createElement('span',{className:'spinner'}):'Fetch'),
        React.createElement('button',{className:'btn btn-sm btn-default',onClick:function(){fetchNews(true);},disabled:fetching,title:'Fetch without preference weighting'},'üé≤ Random'),
        React.createElement('button',{className:'btn btn-sm btn-default',onClick:function(){setShowSources(!showSources);},title:'Configure sources'},IC('filter',12)),
        React.createElement('button',{className:'btn btn-sm btn-default',onClick:load,disabled:loading},loading?React.createElement('span',{className:'spinner'}):'‚Üª'))),
    React.createElement('div',{style:{display:'flex',justifyContent:'space-between',alignItems:'center',gap:8,marginBottom:12,flexWrap:'wrap'}},
      React.createElement('div',{style:{display:'flex',gap:4,flexWrap:'wrap'}},
        [['all','All'],['quality','‚òÖ Quality'],['bookmarks','üîñ Saved']].map(function(v){return React.createElement('button',{key:v[0],className:'btn btn-sm '+(view===v[0]?'btn-primary':'btn-default'),onClick:function(){setView(v[0]);if(v[0]==='bookmarks')loadBookmarks();if(v[0]==='quality')loadQuality();}},v[1]);})),
      React.createElement('div',{style:{display:'flex',gap:4}},
        React.createElement('button',{className:'btn btn-xs btn-default',title:'Download articles as JSON',onClick:function(){var arts=(news&&news.articles)||[];var blob=new Blob([JSON.stringify(arts,null,2)],{type:'application/json'});var u=URL.createObjectURL(blob);var a=document.createElement('a');a.href=u;a.download='openclaw-news-'+new Date().toISOString().slice(0,10)+'.json';a.click();URL.revokeObjectURL(u);toast('Downloaded '+arts.length+' articles','success');}},IC('downloadCloud',12),' ‚¨á'),
        React.createElement('button',{className:'btn btn-xs btn-default',title:'Upload articles JSON to restore',onClick:function(){var inp=document.createElement('input');inp.type='file';inp.accept='.json';inp.onchange=async function(ev){var file=ev.target.files[0];if(!file)return;try{var txt=await file.text();var arts=JSON.parse(txt);if(!Array.isArray(arts)){toast('Invalid format ‚Äî expected array','error');return;}var existing=news&&news.articles||[];var merged=[].concat(arts,existing);var seen=new Set();merged=merged.filter(function(a){if(!a.url||seen.has(a.url))return false;seen.add(a.url);return true;});await api('/news',{method:'PUT',body:{articles:merged}});toast('Restored '+arts.length+' articles','success');load();}catch(er){toast('Upload failed: '+er.message,'error');}};inp.click();}},IC('upload',12),' ‚¨Ü'))),
    React.createElement('div',{className:'search-wrap'},
      React.createElement('input',{className:'input',placeholder:'Search articles‚Ä¶',value:newsSearch,onChange:function(e){setNewsSearch(e.target.value);},style:{fontSize:12}}),
      newsSearch?React.createElement('button',{className:'clear-x',onClick:function(){setNewsSearch('');}},'‚úï'):null),
    showSources?React.createElement('div',{className:'card',style:{padding:14,marginBottom:12}},
      React.createElement('div',{style:{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:10}},
        React.createElement('div',{style:{fontSize:13,fontWeight:600}},'News Sources'),
        React.createElement('button',{className:'btn btn-xs btn-primary',onClick:function(){var url=prompt('Enter RSS feed URL or website URL:');if(!url)return;var name=prompt('Short name for this source:','Custom');if(!name)return;var s=Object.assign({},sources);s['custom_'+Date.now()]={url:url,name:name};saveSources(s);toast('Source added! Will be used on next fetch.','success');}},'+  Add Source')),
      React.createElement('div',{style:{display:'grid',gridTemplateColumns:'repeat(auto-fill,minmax(180px,1fr))',gap:8}},
        Object.entries(srcLabels).concat(Object.entries(sources).filter(function(e){return e[0].startsWith('custom_')&&e[1]&&typeof e[1]==='object';}).map(function(e){return[e[0],e[1].name||e[0]];})).map(function(e){var k=e[0],label=e[1];var isCustom=k.startsWith('custom_');return React.createElement('div',{key:k,style:{display:'flex',alignItems:'center',gap:8,padding:'6px 10px',background:'var(--bg)',borderRadius:6,border:'1px solid '+(isCustom?'rgba(196,181,253,.2)':'var(--border)')}},
          React.createElement('button',{className:'toggle '+((isCustom?sources[k]!==false:sources[k]!==false)?'on':'off'),style:{transform:'scale(.65)'},onClick:function(){var s=Object.assign({},sources);if(isCustom){s[k]=sources[k]===false?sources[k]:false;}else{s[k]=sources[k]===false?true:false;}saveSources(s);}},React.createElement('div',{className:'toggle-dot'})),
          React.createElement('span',{style:{fontSize:12,color:isCustom?'var(--purple)':'inherit'}},label),
          isCustom?React.createElement('button',{className:'btn btn-ghost',style:{padding:'0 2px',color:'var(--red)',fontSize:10,marginLeft:'auto'},title:'Remove custom source',onClick:function(){if(!confirm('Remove source "'+label+'"?'))return;var s=Object.assign({},sources);delete s[k];saveSources(s);}},IC('trash2',10)):null);})),
      React.createElement('div',{style:{marginTop:8,fontSize:11,color:'var(--dim)'}},'Toggle sources on/off to customize your news feed. Changes apply on next fetch.')):null,
    ),
    view==='all'?React.createElement(React.Fragment,null,
      loading&&!news?React.createElement('div',{style:{textAlign:'center',padding:40}},React.createElement('span',{className:'spinner'})):null,
      news&&(!news.articles||news.articles.length===0)?React.createElement('div',{className:'card',style:{padding:30,textAlign:'center'}},
        React.createElement('div',{style:{fontSize:32,marginBottom:8}},IC('rss',32)),
        React.createElement('div',{style:{color:'var(--dim)',marginBottom:8}},'No news articles yet'),
        React.createElement('div',{style:{fontSize:12,color:'var(--muted)'}},'Click Fetch to pull the latest articles')):null,
      news&&news.articles&&news.articles.length>0?React.createElement('div',null,
        news.isRandom?React.createElement('div',{style:{padding:'8px 12px',marginBottom:10,background:'var(--amber-d)',borderRadius:8,border:'1px solid rgba(251,191,36,.2)',fontSize:12,color:'var(--amber)'}},'üé≤ Random fetch ‚Äî preference weighting was skipped for this batch'):null,
        news.articles.filter(function(a){if(!newsSearch)return true;var q=newsSearch.toLowerCase();return(a.title||'').toLowerCase().includes(q)||(a.source||'').toLowerCase().includes(q)||(a.author||'').toLowerCase().includes(q);}).map(function(a,i){return renderArticle(a,i,true);})):null):null,
    view==='bookmarks'?React.createElement('div',null,
      bookmarks.length===0?React.createElement('div',{className:'card',style:{padding:30,textAlign:'center',color:'var(--dim)'}},'No bookmarked articles yet. Click üîñ on articles to save them.'):
      bookmarks.map(function(b,i){return React.createElement('div',{key:i,className:'card',style:{padding:14,marginBottom:6,cursor:'pointer',borderLeft:'3px solid var(--amber)'},onClick:function(){window.open(b.url,'_blank');}},
        React.createElement('div',{style:{display:'flex',justifyContent:'space-between',alignItems:'center'}},
          React.createElement('div',{style:{flex:1,minWidth:0}},
            React.createElement('div',{style:{fontSize:13,fontWeight:600}},b.title),
            React.createElement('div',{style:{display:'flex',gap:6,marginTop:4}},
              b.source?React.createElement('span',{className:'badge',style:{fontSize:9,color:'var(--accent)',background:'var(--accent-d)'}},b.source):null,
              React.createElement('span',{className:'mono',style:{fontSize:10,color:'var(--dim)'}},'Saved '+timeAgo(b.savedAt)+' ago'))),
          React.createElement('button',{className:'btn btn-ghost',style:{color:'var(--red)'},onClick:function(e){e.stopPropagation();feedback(b.url,'unbookmark',e);}},IC('trash2',14))));})):null,
    view==='quality'?React.createElement('div',null,
      qualityList.length===0?React.createElement('div',{className:'card',style:{padding:30,textAlign:'center',color:'var(--dim)'}},'No quality-marked articles yet. Click üëç on articles to mark them.'):
      qualityList.filter(function(a){if(!newsSearch)return true;var q=newsSearch.toLowerCase();return(a.title||'').toLowerCase().includes(q)||(a.source||'').toLowerCase().includes(q);}).map(function(a,i){return renderArticle(a,i,true);})):null);
}

function KeyboardHelp({onClose}){
  return React.createElement('div',{className:'modal-overlay',onClick:onClose},
    React.createElement('div',{className:'modal',onClick:function(e){e.stopPropagation();},style:{maxWidth:400}},
      React.createElement('h3',{style:{marginBottom:16}},'‚å®Ô∏è Keyboard Shortcuts'),
      [['1','Dashboard'],['2','Updates'],['3','Security'],['4','Antfarm'],['6','Dashboard Code'],['7','Timeline'],['8','News'],['r','Refresh'],['?','This help'],['Esc','Close modals']].map(function(x){
        return React.createElement('div',{key:x[0],style:{display:'flex',alignItems:'center',gap:12,marginBottom:8}},React.createElement('span',{className:'kbd'},x[0]),React.createElement('span',{style:{fontSize:13}},x[1]));}),
      React.createElement('div',{style:{marginTop:16,textAlign:'right'}},React.createElement('button',{className:'btn btn-sm btn-primary',onClick:onClose},'Got it'))));
}


function PanelTimeline({toast}){
  var[data,setData]=useState(null);var[loading,setLoading]=useState(false);
  var[snapshotLabel,setSnapshotLabel]=useState('');var[snapshotting,setSnapshotting]=useState(false);
  var[editingLabel,setEditingLabel]=useState(null);var[editLabelText,setEditLabelText]=useState('');
  useEffect(function(){loadVersions();},[]);
  function loadVersions(){setLoading(true);api('/versions').then(function(d){setData(d);setLoading(false);}).catch(function(){setLoading(false);});}
  function snapshot(markAsBase){
    if(!snapshotLabel.trim()){toast('Enter a label for this snapshot','error');return;}
    setSnapshotting(true);
    api('/versions/snapshot',{method:'POST',body:{label:snapshotLabel.trim(),markAsBase:!!markAsBase}}).then(function(r){
      toast('Snapshot saved: '+r.version.label,'success');setSnapshotLabel('');setSnapshotting(false);loadVersions();
    }).catch(function(e){toast(e.message,'error');setSnapshotting(false);});
  }
  function activate(id,label){
    if(!confirm('Switch to "'+label+'"? Current state will be auto-saved first.'))return;
    api('/versions/'+id+'/activate',{method:'POST'}).then(function(r){
      toast(r.message,'success');loadVersions();
      if(r.needsRestart&&confirm('Restart dashboard now to apply server changes?')){
        api('/dashboard/restart',{method:'POST'}).then(function(){toast('Restarting...','success');setTimeout(function(){window.location.reload();},5000);});
      }
    }).catch(function(e){toast(e.message,'error');});
  }
  function deleteVersion(id,label){
    if(!confirm('Delete version "'+label+'"? This cannot be undone.'))return;
    api('/versions/'+id,{method:'DELETE'}).then(function(){toast('Deleted','success');loadVersions();}).catch(function(e){toast(e.message,'error');});
  }
  function updateLabel(id){
    api('/versions/'+id,{method:'PUT',body:{label:editLabelText}}).then(function(){setEditingLabel(null);loadVersions();}).catch(function(e){toast(e.message,'error');});
  }
  function toggleBase(id,currentlyBase){
    api('/versions/'+id,{method:'PUT',body:{markAsBase:!currentlyBase}}).then(function(){loadVersions();toast(currentlyBase?'Unmarked as base':'Marked as base stable','success');}).catch(function(e){toast(e.message,'error');});
  }
  function fmtDate(iso){if(!iso)return'?';var d=new Date(iso);return d.toLocaleDateString()+' '+d.toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'});}
  return React.createElement('div',null,
    React.createElement('div',{className:'section-title'},
      React.createElement('h3',null,'‚è≥ Version Timeline'),
      React.createElement('button',{className:'btn btn-sm btn-default',onClick:loadVersions,disabled:loading},loading?React.createElement('span',{className:'spinner'}):'‚Üª')),
    React.createElement('div',{style:{padding:'12px 14px',marginBottom:16,background:'var(--surface2)',borderRadius:8,border:'1px solid var(--border)',fontSize:12,color:'var(--dim)',lineHeight:1.6}},
      'Snapshot the current dashboard state before making changes. Switch between versions to compare. The previous version and base stable are always preserved.'),
    React.createElement('div',{className:'card',style:{padding:16,marginBottom:16}},
      React.createElement('div',{style:{fontSize:14,fontWeight:700,marginBottom:12}},'üì∏ Create Snapshot'),
      React.createElement('div',{style:{display:'flex',gap:8,alignItems:'center',flexWrap:'wrap'}},
        React.createElement('input',{className:'input mono',value:snapshotLabel,onChange:function(e){setSnapshotLabel(e.target.value);},placeholder:'e.g. v2.1 ‚Äî FTP + Code tabs',style:{flex:1,minWidth:200},onKeyDown:function(e){if(e.key==='Enter')snapshot(false);}}),
        React.createElement('button',{className:'btn btn-sm btn-primary',onClick:function(){snapshot(false);},disabled:snapshotting},snapshotting?React.createElement('span',{className:'spinner'}):'üíæ Save Snapshot'),
        React.createElement('button',{className:'btn btn-sm btn-default',onClick:function(){snapshot(true);},disabled:snapshotting,title:'Save and mark as the base stable version'},'üèõ Save as Base'))),
    loading&&!data?React.createElement('div',{style:{textAlign:'center',padding:30}},React.createElement('span',{className:'spinner'})):null,
    data&&data.versions.length===0?React.createElement('div',{className:'card',style:{padding:30,textAlign:'center',color:'var(--dim)'}},'No snapshots yet. Create your first one above!'):null,
    data&&data.versions.length>0?React.createElement('div',null,
      data.versions.slice().reverse().map(function(v){
        var isCurrent=data.current===v.id;
        var isBase=data.baseStable===v.id;
        return React.createElement('div',{key:v.id,className:'card',style:{padding:14,marginBottom:8,borderColor:isCurrent?'rgba(34,211,238,.3)':isBase?'rgba(52,211,153,.2)':'var(--border)',position:'relative'}},
          React.createElement('div',{style:{display:'flex',justifyContent:'space-between',alignItems:'flex-start',gap:8}},
            React.createElement('div',{style:{flex:1}},
              React.createElement('div',{style:{display:'flex',alignItems:'center',gap:8,flexWrap:'wrap',marginBottom:4}},
                editingLabel===v.id?React.createElement('div',{style:{display:'flex',gap:4,flex:1}},
                  React.createElement('input',{className:'input mono',value:editLabelText,onChange:function(e){setEditLabelText(e.target.value);},style:{flex:1,fontSize:12},onKeyDown:function(e){if(e.key==='Enter')updateLabel(v.id);if(e.key==='Escape')setEditingLabel(null);}}),
                  React.createElement('button',{className:'btn btn-xs btn-primary',onClick:function(){updateLabel(v.id);}},'‚úì'),
                  React.createElement('button',{className:'btn btn-xs btn-default',onClick:function(){setEditingLabel(null);}},'‚úï')):
                React.createElement('span',{style:{fontWeight:700,fontSize:14,cursor:'pointer'},onClick:function(){setEditingLabel(v.id);setEditLabelText(v.label||v.id);},title:'Click to edit label'},v.label||v.id),
                isCurrent?React.createElement('span',{className:'badge',style:{color:'var(--accent)',background:'rgba(34,211,238,.1)',fontSize:10}},'‚óè CURRENT'):null,
                isBase?React.createElement('span',{className:'badge',style:{color:'var(--green)',background:'var(--green-d)',fontSize:10}},'üèõ BASE'):null,
                v.isAuto?React.createElement('span',{className:'badge',style:{color:'var(--dim)',background:'var(--surface2)',fontSize:10}},'auto'):null),
              React.createElement('div',{className:'mono',style:{fontSize:11,color:'var(--dim)'}},
                fmtDate(v.timestamp),'  ‚Ä¢  ',v.size||'?','  ‚Ä¢  ',v.fileCount||'?',' files')),
            React.createElement('div',{style:{display:'flex',gap:4,flexShrink:0}},
              !isCurrent?React.createElement('button',{className:'btn btn-xs btn-primary',onClick:function(){activate(v.id,v.label||v.id);},title:'Switch to this version'},'‚Ü∫ Activate'):null,
              React.createElement('button',{className:'btn btn-xs btn-default',onClick:function(){toggleBase(v.id,isBase);},title:isBase?'Unmark as base':'Mark as base stable'},isBase?'‚òÖ':'‚òÜ'),
              React.createElement('a',{href:dlUrl('/versions/'+v.id+'/download'),className:'btn btn-xs btn-default',style:{textDecoration:'none'},title:'Download'},'‚¨á'),
              !isCurrent&&!isBase?React.createElement('button',{className:'btn btn-xs btn-danger',onClick:function(){deleteVersion(v.id,v.label||v.id);},title:'Delete'},'‚úï'):null)));
      })
    ):null);
}

function PanelDashboardCode({toast}){
  var[files,setFiles]=useState(null);var[loading,setLoading]=useState(false);
  var[viewing,setViewing]=useState(null);var[fileContent,setFileContent]=useState(null);
  var[editing,setEditing]=useState(false);var[editContent,setEditContent]=useState('');
  useEffect(function(){loadFiles();},[]);
  function loadFiles(){setLoading(true);api('/dashboard/files').then(function(d){setFiles(d.files||[]);setLoading(false);}).catch(function(){setLoading(false);});}
  function openFile(fp){setLoading(true);setEditing(false);
    api('/dashboard/file?path='+encodeURIComponent(fp)).then(function(d){
      setViewing(fp);setFileContent(d.content);setEditContent(d.content);setLoading(false);
    }).catch(function(e){toast('Read error','error');setLoading(false);});}
  function saveFile(){
    api('/dashboard/file',{method:'PUT',body:{filePath:viewing,content:editContent}}).then(function(){
      toast('Saved! (backup created)','success');setFileContent(editContent);setEditing(false);
    }).catch(function(e){toast(e.message,'error');});}
  function fmtSize(b){if(!b)return'0B';if(b>=1024)return(b/1024).toFixed(1)+'KB';return b+'B';}
  if(viewing&&fileContent!==null){
    var fname=viewing.split('/').pop();
    return React.createElement('div',null,
      React.createElement('div',{style:{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:12,flexWrap:'wrap',gap:8}},
        React.createElement('div',{style:{display:'flex',alignItems:'center',gap:8}},
          React.createElement('button',{className:'btn btn-xs btn-default',onClick:function(){setViewing(null);}},'‚Üê Back'),
          React.createElement('span',{style:{fontWeight:700,fontSize:14}},fname)),
        React.createElement('div',{style:{display:'flex',gap:6}},
          !editing?React.createElement('button',{className:'btn btn-xs btn-default',onClick:function(){setEditing(true);setEditContent(fileContent);}},'‚úèÔ∏è Edit'):null,
          editing?React.createElement('button',{className:'btn btn-xs btn-primary',onClick:saveFile},'üíæ Save'):null,
          editing?React.createElement('button',{className:'btn btn-xs btn-default',onClick:function(){setEditing(false);}},'Cancel'):null)),
      editing?React.createElement('textarea',{value:editContent,onChange:function(e){setEditContent(e.target.value);},className:'mono',style:{width:'100%',minHeight:500,padding:14,background:'var(--bg)',color:'var(--text)',border:'1px solid var(--border)',borderRadius:8,fontSize:12,lineHeight:1.7,resize:'vertical'}}):
      React.createElement('pre',{className:'mono',style:{background:'var(--bg)',border:'1px solid var(--border)',borderRadius:8,padding:14,fontSize:12,lineHeight:1.7,maxHeight:'70vh',overflowY:'auto',whiteSpace:'pre-wrap',wordBreak:'break-word',color:'var(--text)'}},fileContent));}
  return React.createElement('div',null,
    React.createElement('div',{className:'section-title'},
      React.createElement('h3',null,'üíª Dashboard Code'),
      React.createElement('div',{style:{display:'flex',gap:6}},
        React.createElement('a',{href:dlUrl('/dashboard/download'),className:'btn btn-sm btn-default',style:{textDecoration:'none'}},'‚¨á Download All'),
        React.createElement('button',{className:'btn btn-sm btn-danger',onClick:async function(){if(!confirm('Restart the dashboard service? You will briefly lose connection.'))return;await api('/dashboard/restart',{method:'POST'});toast('Restarting... page will reload in 5s','success');setTimeout(function(){window.location.reload();},5000);}},'‚Üª Restart Dashboard'),
        React.createElement('button',{className:'btn btn-sm btn-default',onClick:loadFiles,disabled:loading},loading?React.createElement('span',{className:'spinner'}):'‚Üª'))),
    React.createElement('div',{style:{padding:'10px 14px',marginBottom:16,background:'var(--surface2)',borderRadius:8,border:'1px solid var(--border)',fontSize:12,color:'var(--dim)'}},'Edit dashboard files directly. Backups are created automatically before each save. Restart the dashboard service to apply changes to server.js.'),
    loading&&!files?React.createElement('div',{style:{textAlign:'center',padding:30}},React.createElement('span',{className:'spinner'})):null,
    files?React.createElement('div',{className:'card',style:{padding:0,overflow:'hidden'}},
      files.map(function(f){return React.createElement('div',{key:f.name,className:'file-item',onClick:function(){openFile(f.path);}},
        React.createElement('span',{style:{fontSize:16,width:24,textAlign:'center'}},f.ext==='.js'?'üü®':f.ext==='.html'?'üåê':f.ext==='.json'?'üìã':'üìÑ'),
        React.createElement('span',{style:{flex:1,fontWeight:600,color:'var(--accent)'}},f.name),
        React.createElement('span',{className:'mono',style:{fontSize:10,color:'var(--dim)'}},fmtSize(f.size)),
        React.createElement('span',{className:'mono',style:{fontSize:10,color:'var(--dim)'}},f.modified?f.modified.slice(0,10):''));})):null,
    React.createElement('div',{style:{marginTop:16}},
      React.createElement('div',{className:'section-title'},React.createElement('h3',null,'üîë All API Keys')),
      React.createElement('a',{href:dlUrl('/env/download-all'),className:'btn btn-sm btn-default',style:{textDecoration:'none'}},'‚¨á Download All Keys (.tar.gz)')));
}

function App(){
  var[panel,setPanel]=useState('dashboard');var[profiles,setProfiles]=useState([]);var[system,setSystem]=useState({});
  var[activeProfile,setActiveProfile]=useState(null);var[loading,setLoading]=useState(true);
  var[toastMsg,setToastMsg]=useState(null);var[toastType,setToastType]=useState('info');var[mobileOpen,setMobileOpen]=useState(false);
  var[kbHelp,setKbHelp]=useState(false);
  var toast=function(msg,type){setToastMsg(msg);setToastType(type||'info');setTimeout(function(){setToastMsg(null);},3500);};
  var loadData=async function(){setLoading(true);try{var r=await Promise.all([api('/profiles'),api('/system')]);setProfiles(r[0].profiles||[]);setSystem(r[1]);}catch(e){toast('Connection failed','error');}setLoading(false);};
  useEffect(function(){loadData();},[]);
  useEffect(function(){function h(e){if(e.target.tagName==='INPUT'||e.target.tagName==='TEXTAREA'||e.target.tagName==='SELECT')return;
    if(e.key==='1')nav('dashboard');else if(e.key==='2')nav('updates');else if(e.key==='3')nav('security');else if(e.key==='4')nav('antfarm');else if(e.key==='5')nav('files');else if(e.key==='6')nav('code');else if(e.key==='7')nav('timeline');else if(e.key==='8')nav('news');
    else if(e.key==='r')loadData();else if(e.key==='?')setKbHelp(true);else if(e.key==='Escape')setKbHelp(false);}
    window.addEventListener('keydown',h);return function(){window.removeEventListener('keydown',h);};},[]);
  var nav=function(t,id){if(t==='refresh'){loadData();return;}if(t==='profile'){setActiveProfile(id);setPanel('profile');}else setPanel(t);setMobileOpen(false);};

  return React.createElement('div',{className:'app'},
    kbHelp?React.createElement(KeyboardHelp,{onClose:function(){setKbHelp(false);}}):null,
    React.createElement('div',{className:'mobile-overlay'+(mobileOpen?' open':''),onClick:function(){setMobileOpen(false);}}),
    React.createElement('nav',{className:'sidebar'+(mobileOpen?' open':'')},
      React.createElement('div',{style:{padding:'20px 16px 16px',borderBottom:'1px solid var(--border)',display:'flex',alignItems:'center',gap:10}},
        React.createElement('span',{style:{color:'var(--accent)',fontSize:24}},'‚ö°'),
        React.createElement('div',null,React.createElement('div',{style:{fontSize:16,fontWeight:800,color:'var(--accent)'}},'OpenClaw'),React.createElement('div',{className:'mono',style:{fontSize:10,color:'var(--dim)'}},'COMMAND CENTER v2.5'))),
      React.createElement('div',{style:{padding:'12px 12px 4px'}},
        React.createElement('div',{className:'mono',style:{fontSize:10,color:'var(--muted)',textTransform:'uppercase',marginBottom:6,paddingLeft:4}},'Navigation'),
        [['dashboard','home','Dashboard','1'],['updates','refresh','Updates','2'],['security','shield','Security','3'],['antfarm','grid','Antfarm','4'],['files','folder','Files','5'],['code','code','Code','6'],['timeline','clock','Timeline','7'],['news','rss','News','8']].map(function(x){
          return React.createElement('button',{key:x[0],className:'nav-btn '+(panel===x[0]?'active':''),onClick:function(){nav(x[0]);}},
            IC(x[1],16),React.createElement('span',{style:{marginLeft:2}},x[2]),React.createElement('span',{className:'kbd',style:{marginLeft:'auto'}},x[3]));})),
      React.createElement('div',{style:{padding:'4px 12px'}},
        React.createElement('div',{className:'mono',style:{fontSize:10,color:'var(--muted)',textTransform:'uppercase',marginBottom:6,marginTop:8,paddingLeft:4}},'Profiles'),
        profiles.map(function(p){return React.createElement('button',{key:p.id,className:'nav-btn '+((panel==='profile'&&activeProfile===p.id)?'active':''),onClick:function(){nav('profile',p.id);}},
          React.createElement('span',{style:{width:8,height:8,borderRadius:'50%',flexShrink:0,background:p.status==='running'?'var(--green)':p.status==='failed'?'var(--red)':'var(--muted)'}}),
          p.id,React.createElement('span',{className:'mono',style:{fontSize:10,color:'var(--muted)',marginLeft:'auto'}},':'+p.port));})),
      React.createElement('div',{style:{marginTop:'auto',padding:12,borderTop:'1px solid var(--border)'}},
        React.createElement('div',{style:{padding:10,borderRadius:8,background:'var(--bg)',fontSize:11},className:'mono'},
          React.createElement('div',{style:{color:'var(--dim)',marginBottom:4}},'Server'),
          React.createElement('div',{style:{color:'var(--green)',display:'flex',alignItems:'center',gap:4}},
            React.createElement('span',{style:{width:6,height:6,borderRadius:'50%',background:'var(--green)',display:'inline-block'}}),system.hostname||'...'),
          React.createElement('div',{style:{color:'var(--dim)',marginTop:4,cursor:'pointer'},onClick:function(){setKbHelp(true);}},'‚å®Ô∏è Shortcuts (?)')))),
    React.createElement('div',{className:'main'},
      React.createElement(AlertBanner),
      React.createElement('div',{className:'mobile-header',style:{display:'flex'}},
        React.createElement('button',{style:{background:'none',border:'none',color:'var(--text)',fontSize:18,padding:'8px 10px',flexShrink:0},onClick:function(){setMobileOpen(!mobileOpen);}},'‚ò∞'),
        React.createElement('div',{className:'top-nav'},
          [['dashboard','home','Dashboard'],['updates','refresh','Updates'],['security','shield','Security'],['antfarm','grid','Antfarm'],['files','folder','Files'],['code','code','Code'],['timeline','clock','Timeline'],['news','rss','News']].map(function(x){
            return React.createElement('button',{key:x[0],className:'top-nav-btn '+(panel===x[0]?'active':''),onClick:function(){nav(x[0]);setMobileOpen(false);}},IC(x[1],13),x[2]);}),
          profiles.map(function(p){return React.createElement('button',{key:p.id,className:'top-nav-btn '+((panel==='profile'&&activeProfile===p.id)?'active':''),onClick:function(){nav('profile',p.id);setMobileOpen(false);}},
            React.createElement('span',{style:{width:6,height:6,borderRadius:'50%',flexShrink:0,background:p.status==='running'?'var(--green)':'var(--muted)'}}),p.id);}))),
      React.createElement('div',{className:'content'},
        panel==='dashboard'?React.createElement(PanelDashboard,{profiles:profiles,system:system,loading:loading,onRefresh:loadData,onNav:nav,toast:toast}):null,
        panel==='profile'?React.createElement(PanelProfile,{profileId:activeProfile,profiles:profiles,toast:toast,onNav:nav}):null,
        panel==='updates'?React.createElement(PanelUpdates,{toast:toast,profileIds:profiles.map(function(p){return p.id;})}):null,
        panel==='security'?React.createElement(PanelSecurity,{toast:toast}):null,
        panel==='files'?React.createElement(SystemBrowser,{toast:toast}):null,
        panel==='antfarm'?React.createElement(PanelAntfarm,{toast:toast}):null,
        panel==='code'?React.createElement(PanelDashboardCode,{toast:toast}):null,
        panel==='timeline'?React.createElement(PanelTimeline,{toast:toast}):null,
        panel==='news'?React.createElement(PanelNews,{toast:toast}):null)),
    React.createElement(Toast,{message:toastMsg,type:toastType}));
}
ReactDOM.createRoot(document.getElementById('root')).render(React.createElement(App));
</script>
</body>
</html>
